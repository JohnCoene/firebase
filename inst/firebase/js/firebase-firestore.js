!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(ud){"use strict";try{(function(){ud=ud&&Object.prototype.hasOwnProperty.call(ud,"default")?ud.default:ud;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(t,s,u,a){return new(u=u||Promise)(function(e,n){function r(t){try{o(a.next(t))}catch(t){n(t)}}function i(t){try{o(a.throw(t))}catch(t){n(t)}}function o(t){t.done?e(t.value):function(e){return e instanceof u?e:new u(function(t){t(e)})}(t.value).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,u(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,u(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,u(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,u(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,a=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,u([this,o.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,u([this,o.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,u([this,o.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,u([this,o.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,u([this,o.ERROR],t))},h);function h(t){this.name=t,this._logLevel=i,this._logHandler=n}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,d=(t(y,c=Error),y);function y(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(g.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,r){return t.replace(w,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",u=this.serviceName+": "+s+" ("+i+").",a=new d(i,u),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in a&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),a[f]=r[f])}return a},g);function g(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,b=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},A=T;function S(t){return"string"==typeof t}function D(t){return"number"==typeof t}function k(t,e){t=t.split("."),e=e||A;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function O(){}function R(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function C(t){return"array"==R(t)}function x(t){var e=R(t);return"array"==e||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),_=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function M(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:M).apply(null,arguments)}function F(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var V=Date.now||function(){return+new Date};function G(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[P]||(this[P]=++_)},j.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function H(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t){return/^[\s\xa0]*$/.test(t)}var Y,K=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var $=A.navigator;if($){var Z=$.userAgent;if(Z){Y=Z;break t}}Y=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=O;var ot,st,ut=J(Y,"Opera"),at=J(Y,"Trident")||J(Y,"MSIE"),ht=J(Y,"Edge"),ct=ht||at,ft=J(Y,"Gecko")&&!(J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge"))&&!(J(Y,"Trident")||J(Y,"MSIE"))&&!J(Y,"Edge"),lt=J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge");function pt(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",vt=(st=Y,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(vt&&(dt=vt?vt[1]:""),at){var yt=pt();if(null!=yt&&yt>parseFloat(dt)){ot=String(yt);break t}}ot=dt}var mt,gt={};function wt(u){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(u,function(){for(var t=0,e=K(String(ot)).split("."),n=K(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var bt=A.document;mt=bt&&at?pt()||("CSS1Compat"==bt.compatMode?parseInt(ot,10):5):void 0;var Et=!at||9<=Number(mt),It=at&&!wt("9"),Tt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",O,e),A.removeEventListener("test",O,e)}catch(t){}return t}();function Nt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function At(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Nt.prototype.b=function(){this.Ia=!1},G(At,Nt);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.b=function(){At.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Dt="closure_listenable_"+(1e6*Math.random()|0),kt=0;function Ot(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++kt,this.X=this.Z=!1}function Rt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Ct(t){this.src=t,this.a={},this.b=0}function xt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=B(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Rt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Lt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Ct.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Lt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Ot(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),_t={};function Ut(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(C(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=zt(r);return e&&e[Dt]?e.Aa(n,r,L(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(C(e)){for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);return null}return n=zt(n),t&&t[Dt]?t.za(e,n,L(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=L(i)?!!i.capture:!!i;if(s&&!Et)return null;var u=jt(t);if(u||(t[Pt]=u=new Ct(t)),(n=u.add(e,n,r,s,o)).proxy)return n;if(r=function(){var e=Gt,n=Et?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ft(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!D(t)&&t&&!t.X){var e=t.src;if(e&&e[Dt])xt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ft(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(xt(n,t),0==n.b&&(n.src=null,e[Pt]=null)):Rt(t)}}}function Ft(t){return t in _t?_t[t]:_t[t]="on"+t}function Vt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function Gt(t,e){return!!t.X||(Et?Vt(t,new At(e,this)):Vt(t,e=new At(e||k("window.event"),this)))}function jt(t){return(t=t[Pt])instanceof Ct?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function zt(e){return"function"==R(e)?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function Ht(){j.call(this),this.c=new Ct(this),(this.J=this).B=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var u=s.listener,a=s.da||s.src;s.Z&&xt(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&0!=r.Ia}G(Ht,j),Ht.prototype[Dt]=!0,(I=Ht.prototype).addEventListener=function(t,e,n,r){Ut(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(C(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=zt(r),e&&e[Dt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Lt(s=e.a[n],r,i,o))&&(Rt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Lt(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new Nt(t,n);else if(t instanceof Nt)t.target=t.target||n;else{var i=t;rt(t=new Nt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Wt(s,r,!0,t)&&i}if(i=Wt(s=t.a=n,r,!0,t)&&i,i=Wt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Wt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(Ht.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Rt(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=A.JSON.stringify;function Yt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Kt(){this.b=this.a=null}Yt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Jt,Xt=new Yt(function(){return new $t},function(t){t.reset()});function $t(){this.next=this.b=this.a=null}function Zt(t){A.setTimeout(function(){throw t},0)}function te(t,e){Jt||function(){var t=A.Promise.resolve(void 0);Jt=function(){t.then(re)}}(),ee||(Jt(),ee=!0),ne.add(t,e)}Kt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Kt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Zt(t)}var e=Xt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){Ht.call(this),this.b=t||1,this.a=e||A,this.f=q(this.gb,this),this.g=V()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function se(t,e,n){if("function"==R(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ue(t,e,n){j.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ae(t){t.U=se(t.b,t.c),t.f.apply(null,t.a)}function he(t){j.call(this),this.b=t,this.a={}}G(ie,Ht),(I=ie.prototype).ba=!1,I.L=null,I.gb=function(){if(this.ba){var t=V()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=V())},I.G=function(){ie.N.G.call(this),oe(this),delete this.a},G(ue,j),(I=ue.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ae(this)},I.G=function(){ue.N.G.call(this),this.U&&(A.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,ae(this))},G(he,j);var ce=[];function fe(t,e,n,r){C(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Ut(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function pe(){}he.prototype.G=function(){he.N.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new Ht;function ve(t){Nt.call(this,"serverreachability",t)}function ye(t){de.dispatchEvent(new ve(de,t))}function me(t){Nt.call(this,"statevent",t)}function ge(t){de.dispatchEvent(new me(de,t))}function we(t){Nt.call(this,"timingevent",t)}function be(t,e){if("function"!=R(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}G(ve,Nt),G(me,Nt),G(we,Nt);var Ee={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Ie={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Te(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function Ae(){}Te.prototype.a=null;var Se,De={OPEN:"a",ib:"b",Ma:"c",rb:"d"};function ke(){Nt.call(this,"d")}function Oe(){Nt.call(this,"c")}function Re(){}function Ce(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new he(this),this.O=xe,t=ct?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}G(ke,Nt),G(Oe,Nt),G(Re,Te),Se=new Re;var xe=45e3,Le={},Pe={};function _e(t,e,n){t.F=1,t.f=un(Ze(e)),t.l=n,t.H=!0,Me(t,null)}function Ue(t,e,n,r){t.F=1,t.f=un(Ze(e)),t.l=null,t.H=n,Me(t,r)}function Me(t,e){t.v=V(),Ve(t),t.D=Ze(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ue(q(t.Ja,t,t.a),t.J)),fe(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ye(1)}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Fe(t,n);if(i==Pe){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Le){t.c=4,ge(15),r=!1;break}He(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(ze(t),Be(t))}function Fe(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Le:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.A=r+n,e))}function Ve(t){t.R=V()+t.O,Ge(t,t.O)}function Ge(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=be(q(t.ab,t),e)}function je(t){t.i&&(A.clearTimeout(t.i),t.i=null)}function Be(t){t.g.Ca()||t.m||t.g.na(t)}function ze(t){je(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),le(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function He(t,e){try{t.g.Fa(t,e),ye(4)}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||S(t))z(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(x(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ye(t,e){Je(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ke(t))}function Ke(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Je(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=Ce.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Zn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Zn(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ct&&!this.a.aa())){this.m||4!=e||7==n||ye(8==n||r<=0?3:2),je(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=tr(this.a,"X-HTTP-Initial-Response");if(s&&!Q(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.c=3,ge(12),ze(this),Be(this);break t}this.s=!0,He(this,u)}this.H?(qe(this,e,o),ct&&this.b&&3==e&&(fe(this.I,this.P,"tick",this.bb),this.P.start())):He(this,o),4==e&&ze(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ve(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),ze(this),Be(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Zn(this.a),e=this.a.aa();this.A<e.length&&(je(this),qe(this,t,e),this.b&&4!=t&&Ve(this))}},I.cancel=function(){this.m=!0,ze(this)},I.ab=function(){this.i=null;var t=V();0<=t-this.R?(2!=this.F&&(ye(3),ge(17)),ze(this),this.c=2,Be(this)):Ge(this,this.R-t)},(I=Qe.prototype).C=function(){Ke(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Ke(this),this.a.concat()},I.get=function(t,e){return Je(this.b,t)?this.b[t]:e},I.set=function(t,e){Je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,En(t.c)),this.g=t.g):t&&(n=String(t).match(Xe))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=an(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=an(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=an(n[7]||"")):(this.h=!!e,this.c=new yn(null,this.h))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?an(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?an(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof yn?(t.c=e,function(t,e){e&&!t.f&&(mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=hn(e,dn)),t.c=new yn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){C(n)||(n=[String(n)]),bn(t.c,e,n)}function un(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^V()).toString(36)),t}function an(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,vn)),t.join("")},$e.prototype.resolve=function(t){var e=Ze(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(J(i,"./")||J(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var u=i[s++];"."==u?r&&s==i.length&&o.push(""):".."==u?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(u),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,En(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,vn=/#/g;function yn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new Qe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){mn(t),e=In(t,e),Je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ye(t.a,e))}function wn(t,e){return mn(t),e=In(t,e),Je(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),W(n)),t.b+=n.length)}function En(t){var e=new yn;return e.c=t.c,t.a&&(e.a=new Qe(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Tn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Nn(t){var e=t.a.F.a;if(null!=e)ge(4),e?(ge(10),lr(t.a,t,!1)):(ge(11),lr(t.a,t,!0));else{t.b=new Ce(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),ge(4),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Ue(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function Sn(){this.a=new Qe}function Dn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[P]||(t[P]=++_)):e.charAt(0)+t}function kn(t,e){this.b=t,this.a=e}function On(t){this.g=t||Rn,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ka&&A.ka.Da&&A.ka.Da()&&A.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Sn),this.b=null,this.c=[]}(I=yn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){z(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=H(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},G(function(){},function(){}),(I=Tn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void vr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,vr(e,2)}else 1==this.M&&(this.g?ge(6):"11111"==e?(ge(5),this.g=!0,(!at||10<=Number(mt))&&(this.c=200,this.b.cancel(),ge(11),lr(this.a,this,!0))):(ge(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Nn(this)):1==this.M&&(this.g?(ge(11),lr(this.a,this,!0)):(ge(10),lr(this.a,this,!1)));else{0==this.M?ge(8):1==this.M&&ge(9);var t=this.a;t.m=this.c,vr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},Sn.prototype.add=function(t){this.a.set(Dn(t),t)},Sn.prototype.C=function(){return this.a.C()};var Rn=10;function Cn(t,e){!t.a&&(J(e,"spdy")||J(e,"quic")||J(e,"h2"))&&(t.f=t.g,t.a=new Sn,t.b&&(_n(t,t.b),t.b=null))}function xn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Ln(t){return t.b?1:t.a?t.a.a.c:0}function Pn(t,e){return t=t.b?t.b==e:!!t.a&&(e=Dn(e),Je(t.a.a.b,e))}function _n(t,e){t.a?t.a.add(e):t.b=e}function Un(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Dn(e),n=Je(t.a.a.b,n)),n&&Ye(t.a.a,Dn(e)))}function Mn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return W(t.c);var e=t.c;return z(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function Fn(){this.a=new qn}function Vn(t,r,e){var i=e||"";try{We(t,function(t,e){var n=t;L(t)&&(n=Qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}On.prototype.cancel=function(){this.c=Mn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(z(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var jn=A.JSON.parse;function Bn(t){Ht.call(this),this.headers=new Qe,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=zn,this.D=this.F=!1}G(Bn,Ht);var zn="",Hn=/^https?$/i,Wn=["POST","PUT"];function Qn(t){return"content-type"==t.toLowerCase()}function Yn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Kn(t),Xn(t)}function Kn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Jn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=Zn(t)||2!=t.T()))if(t.l&&4==Zn(t))se(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Xe)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!Hn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Zn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.T()+"]",Kn(t)}}finally{Xn(t)}}}function Xn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?O:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Zn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!k("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=k("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=k("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=k("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=k("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new On(t&&t.concurrentRequestLimit),this.ja=new Fn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Ze(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ar(t,n),(e=new Ce(t,e,void 0)).F=2,e.f=un(Ze(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=V(),Ve(e)}yr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(A.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(D(t.h)&&A.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new kn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){xn(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function ur(t,e){var n;n=e?e.W:t.P++;var r=Ze(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ar(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new Ce(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),_n(t.b,n),_e(n,r,e)}function ar(t,n){t.c&&We({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Vn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=be(q(t.Ga,t),dr(t,t.v)),t.v++,!0)}function lr(t,e,n){var r=e.l;r&&Cn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function vr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||tn(n,"https"),un(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=F(Gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=F(Gn,n,r,"TestLoadImage: error",!1,e),r.onabort=F(Gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=F(Gn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.ta(e),yr(t),ir(t)}function yr(t){t.u=0,t.m=-1,t.c&&(0==Mn(t.b).length&&0==t.f.length||(t.b.c.length=0,W(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r=function(t){return t instanceof $e?Ze(t):new $e(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=A.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new $e(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ar(t,r),r}function gr(){}function wr(){if(at&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function br(t,e){Ht.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.fb?e.fb:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Q(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Q(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Tr(this)}function Er(t){ke.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Oe.call(this),this.status=1}function Tr(t){this.a=t}(I=Bn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ne(this.H):Ne(Se),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Yn(this,t)}t=n||"";var i=new Qe(this.headers);r&&We(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Qn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(i.K()),n=A.FormData&&t instanceof A.FormData,0<=B(Wn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=function(t){return at&&wt(9)&&D(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=se(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Yn(this,t)}},I.Ba=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Xn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Xn(this,!0)),Bn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Jn(this):this.Za())},I.Za=function(){Jn(this)},I.T=function(){try{return 2<Zn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),jn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Ce(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ar(this,i),this.g&&r&&er(i,this.g,r),_n(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,_e(n,i,null)):_e(n,i,e),this.u=2}}else 3==this.u&&(t?ur(this,t):0==this.f.length||xn(this.b)||ur(this))},I.Ga=function(){this.l=null,this.a=new Ce(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ze(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ar(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ue(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Pn(this.b,t)))if(this.m=t.o,!t.s&&Pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(C(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),ge(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=be(q(this.Ya,this),6e3));if(Ln(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else vr(this,11)}else if(!t.s&&this.a!=t||pr(this),!Q(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&D(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&Cn(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Un(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(je(r),Ve(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||vr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?vr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),ge(19))},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Pn(this.b,t))return;e=t.j,Un(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=V()-t.v,de.dispatchEvent(new we(de,t.l?t.l.length:0,e,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Ln(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=be(q(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:vr(this,5);break;case 4:vr(this,10);break;case 3:vr(this,6);break;default:vr(this,2)}}},I.eb=function(t){ge(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Bn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},G(br,Ht),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ge(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Tn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),ge(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Nn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new Ce(t,void 0,void 0),t.b.h=t.h,Ue(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Qt(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},G(Er,ke),G(Ir,Oe),G(Tr,gr),Tr.prototype.va=function(){this.a.dispatchEvent("a")},Tr.prototype.ua=function(t){this.a.dispatchEvent(new Er(t))},Tr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Tr.prototype.sa=function(){this.a.dispatchEvent("b")};var Nr=F(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ae.EventType=De).OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",Ht.prototype.listen=Ht.prototype.za,Bn.prototype.listenOnce=Bn.prototype.Aa,Bn.prototype.getLastError=Bn.prototype.Xa,Bn.prototype.getLastErrorCode=Bn.prototype.ya,Bn.prototype.getStatus=Bn.prototype.T,Bn.prototype.getResponseJson=Bn.prototype.Ua,Bn.prototype.getResponseText=Bn.prototype.aa,Bn.prototype.send=Bn.prototype.ca;var Ar={createWebChannelTransport:Nr,ErrorCode:Ee,EventType:Ie,WebChannel:Ae,XhrIo:Bn},Sr=Ar.createWebChannelTransport,Dr=Ar.ErrorCode,kr=Ar.EventType,Or=Ar.WebChannel,Rr=Ar.XhrIo,Cr=ud.SDK_VERSION,xr=new a("@firebase/firestore");function Lr(){return xr.logLevel===o.DEBUG?0:xr.logLevel===o.SILENT?2:1}function Pr(t){switch(t){case 0:xr.logLevel=o.DEBUG;break;case 1:xr.logLevel=o.ERROR;break;case 2:xr.logLevel=o.SILENT;break;default:xr.error("Firestore ("+Cr+"): Invalid value passed to `setLogLevel`")}}function _r(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(xr.logLevel<=o.DEBUG){var i=n.map(Mr);xr.debug.apply(xr,s(["Firestore ("+Cr+") ["+t+"]: "+e],i))}}function Ur(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(xr.logLevel<=o.ERROR){var r=e.map(Mr);xr.error.apply(xr,s(["Firestore ("+Cr+"): "+t],r))}}function Mr(t){if("string"==typeof t)return t;var e=Na.t();try{return e.i(t)}catch(e){return t}}function qr(t){var e="FIRESTORE ("+Cr+") INTERNAL ASSERTION FAILED: "+t;throw Ur(e),new Error(e)}function Fr(t,e){t||qr(e)}var Vr=(Gr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Fr(20===e.length,"Invalid auto ID: "+e),e},Gr);function Gr(){}function jr(t,e){return t<e?-1:e<t?1:0}function Br(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function zr(t){return t+"\0"}function Hr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}function Wr(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t}var Qr,Yr=(Object.defineProperty(ai.prototype,"o",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),ai.prototype.isEqual=function(t){return t instanceof ai&&t.projectId===this.projectId&&t.database===this.database},ai.prototype.h=function(t){return jr(this.projectId,t.projectId)||jr(this.database,t.database)},ai),Kr=(ui.prototype.l=function(){return null!=this.uid},ui.prototype.v=function(){return this.l()?"uid:"+this.uid:"anonymous-user"},ui.prototype.isEqual=function(t){return t.uid===this.uid},ui.UNAUTHENTICATED=new ui(null),ui.m=new ui("google-credentials-uid"),ui.p=new ui("first-party-uid"),ui),Jr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Xr=(t(si,Qr=Error),si),$r=(oi.prototype.getToken=function(){return Promise.resolve(null)},oi.prototype.I=function(){},oi.prototype.T=function(t){Fr(!this._,"Can only call setChangeListener() once."),(this._=t)(Kr.UNAUTHENTICATED)},oi.prototype.D=function(){Fr(null!==this._,"removeChangeListener() when no listener registered"),this._=null},oi),Zr=(ii.prototype.getToken=function(){var e=this;Fr(null!=this.S,"getToken cannot be called after listener removed.");var n=this.C,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.C!==n)throw new Xr(Jr.ABORTED,"getToken aborted due to token change.");return t?(Fr("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Wr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ii.prototype.I=function(){this.forceRefresh=!0},ii.prototype.T=function(t){Fr(!this._,"Can only call setChangeListener() once."),this._=t,this.R&&t(this.currentUser)},ii.prototype.D=function(){Fr(null!=this.S,"removeChangeListener() called twice"),Fr(null!==this._,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.S),this.S=null,this._=null},ii.prototype.A=function(){var t=this.auth&&this.auth.getUid();return Fr(null===t||"string"==typeof t,"Received invalid UID: "+t),new Kr(t)},ii),ti=(Object.defineProperty(ri.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.k},e=this.P.auth.N([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),ri),ei=(ni.prototype.getToken=function(){return Promise.resolve(new ti(this.P,this.k))},ni.prototype.T=function(t){t(Kr.p)},ni.prototype.D=function(){},ni.prototype.I=function(){},ni);function ni(t,e){this.P=t,this.k=e}function ri(t,e){this.P=t,this.k=e,this.type="FirstParty",this.user=Kr.p}function ii(t){var e=this;this.S=null,this.currentUser=Kr.UNAUTHENTICATED,this.R=!1,this.C=0,this._=null,this.forceRefresh=!1,this.S=function(){e.C++,e.currentUser=e.A(),e.R=!0,e._&&e._(e.currentUser)},this.C=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.S):(this.S(null),t.get().then(function(t){e.auth=t,e.S&&e.auth.addAuthTokenListener(e.S)},function(){}))}function oi(){this._=null}function si(t,e){var n=Qr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ui(t){this.uid=t}function ai(t,e){this.projectId=t,this.database=e||"(default)"}function hi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ci(t,e){return void 0!==t?t:e}function fi(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function li(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function pi(t){for(var e in Fr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function di(t,e){if(0!==e.length)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ci(e.length,"argument")+".")}function vi(t,e,n){if(e.length!==n)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires "+Ci(n,"argument")+", but was called with "+Ci(e.length,"argument")+".")}function yi(t,e,n){if(e.length<n)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ci(n,"argument")+", but was called with "+Ci(e.length,"argument")+".")}function mi(t,e,n,r){if(e.length<n||e.length>r)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ci(e.length,"argument")+".")}function gi(t,e,n,r){Ti(t,e,Ri(n)+" argument",r)}function wi(t,e,n,r){void 0!==r&&gi(t,e,n,r)}function bi(t,e,n,r){Ti(t,e,n+" option",r)}function Ei(t,e,n,r){void 0!==r&&bi(t,e,n,r)}function Ii(t,e,n,r,h){void 0!==r&&function(t,e,n,r){for(var i=[],o=0,s=h;o<s.length;o++){var u=s[o];if(u===r)return;i.push(Ai(u))}var a=Ai(r);throw new Xr(Jr.INVALID_ARGUMENT,"Invalid value "+a+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+i.join(", "))}(t,0,n,r)}function Ti(t,e,n,r){if(!("object"===e?Ni(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ai(r);throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Ni(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ai(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":qr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Si(t,e,n){if(void 0===n)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Ri(e)+" argument, but it was undefined.")}function Di(n,t,r){li(t,function(t,e){if(r.indexOf(t)<0)throw new Xr(Jr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function ki(t,e,n,r){var i=Ai(r);return new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Ri(n)+" argument to be a "+e+", but it was: "+i)}function Oi(t,e,n){if(n<=0)throw new Xr(Jr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Ri(e)+" argument to be a positive number, but it was: "+n+".")}function Ri(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ci(t,e){return t+" "+e+(1===t?"":"s")}var xi,Li,Pi=(Object.defineProperty(no.prototype,"latitude",{get:function(){return this.F},enumerable:!0,configurable:!0}),Object.defineProperty(no.prototype,"longitude",{get:function(){return this.V},enumerable:!0,configurable:!0}),no.prototype.isEqual=function(t){return this.F===t.F&&this.V===t.V},no.prototype.U=function(t){return jr(this.F,t.F)||jr(this.V,t.V)},no),_i=(eo.now=function(){return eo.fromMillis(Date.now())},eo.fromDate=function(t){return eo.fromMillis(t.getTime())},eo.fromMillis=function(t){var e=Math.floor(t/1e3);return new eo(e,1e6*(t-1e3*e))},eo.prototype.toDate=function(){return new Date(this.toMillis())},eo.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},eo.prototype.U=function(t){return this.seconds===t.seconds?jr(this.nanoseconds,t.nanoseconds):jr(this.seconds,t.seconds)},eo.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},eo.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},eo.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},eo),Ui=(to.j=function(t){var e=Math.floor(t/1e6);return new to(new _i(e,t%1e6*1e3))},to.L=function(t){return new to(t)},to.q=function(){return to.MIN},to.prototype.h=function(t){return this.timestamp.U(t.timestamp)},to.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},to.prototype.B=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},to.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},to.prototype.M=function(){return this.timestamp},to.MIN=new to(new _i(0,0)),to),Mi=(Object.defineProperty(Zi.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Zi.prototype.isEqual=function(t){return 0===Zi.G(this,t)},Zi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Zi?t.forEach(function(t){e.push(t)}):e.push(t),this.W(e)},Zi.prototype.limit=function(){return this.offset+this.length},Zi.prototype.K=function(t){return t=void 0===t?1:t,Fr(this.length>=t,"Can't call popFirst() with less segments"),this.W(this.segments,this.offset+t,this.length-t)},Zi.prototype.H=function(){return Fr(!this.J(),"Can't call popLast() on empty path"),this.W(this.segments,this.offset,this.length-1)},Zi.prototype.Y=function(){return Fr(!this.J(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Zi.prototype.X=function(){return this.get(this.length-1)},Zi.prototype.get=function(t){return Fr(t<this.length,"Index out of range"),this.segments[this.offset+t]},Zi.prototype.J=function(){return 0===this.length},Zi.prototype.$=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Zi.prototype.Z=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Zi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Zi.prototype.tt=function(){return this.segments.slice(this.offset,this.limit())},Zi.G=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Zi),qi=(t($i,Li=Mi),$i.prototype.W=function(t,e,n){return new $i(t,e,n)},$i.prototype.nt=function(){return this.tt().join("/")},$i.prototype.toString=function(){return this.nt()},$i.it=function(t){if(0<=t.indexOf("//"))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new $i(t.split("/").filter(function(t){return 0<t.length}))},$i.et=new $i([]),$i),Fi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Vi=(t(Xi,xi=Mi),Xi.prototype.W=function(t,e,n){return new Xi(t,e,n)},Xi.rt=function(t){return Fi.test(t)},Xi.prototype.nt=function(){return this.tt().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Xi.rt(t)||(t="`"+t+"`"),t}).join(".")},Xi.prototype.toString=function(){return this.nt()},Xi.prototype.ut=function(){return 1===this.length&&"__name__"===this.get(0)},Xi.st=function(){return new Xi(["__name__"])},Xi.ot=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Xr(Jr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Xr(Jr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Xr(Jr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Xi(e)},Xi.et=new Xi([]),Xi),Gi=(Ji.prototype.ct=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ji.prototype.isEqual=function(t){return null!==t&&0===qi.G(this.path,t.path)},Ji.prototype.toString=function(){return this.path.toString()},Ji.G=function(t,e){return qi.G(t.path,e.path)},Ji.ht=function(t){return t.length%2==0},Ji.at=function(t){return new Ji(new qi(t.slice()))},Ji.ft=function(t){return new Ji(qi.it(t))},Ji.EMPTY=new Ji(new qi([])),Ji),ji=(Ki.prototype.lt=function(t,e){return new Ki(this.G,this.root.lt(t,e,this.G).copy(null,null,zi.dt,null,null))},Ki.prototype.remove=function(t){return new Ki(this.G,this.root.remove(t,this.G).copy(null,null,zi.dt,null,null))},Ki.prototype.get=function(t){for(var e=this.root;!e.J();){var n=this.G(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ki.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.J();){var r=this.G(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ki.prototype.J=function(){return this.root.J()},Object.defineProperty(Ki.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Ki.prototype.vt=function(){return this.root.vt()},Ki.prototype.wt=function(){return this.root.wt()},Ki.prototype.pt=function(t){return this.root.pt(t)},Ki.prototype.forEach=function(n){this.pt(function(t,e){return n(t,e),!1})},Ki.prototype.toString=function(){var n=[];return this.pt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Ki.prototype.gt=function(t){return this.root.gt(t)},Ki.prototype.bt=function(){return new Bi(this.root,null,this.G,!1)},Ki.prototype.yt=function(t){return new Bi(this.root,t,this.G,!1)},Ki.prototype._t=function(){return new Bi(this.root,null,this.G,!0)},Ki.prototype.It=function(t){return new Bi(this.root,t,this.G,!0)},Ki),Bi=(Yi.prototype.Dt=function(){Fr(0<this.Et.length,"getNext() called on iterator when hasNext() is false.");var t=this.Et.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.J();)this.Et.push(t),t=t.right;else for(t=t.right;!t.J();)this.Et.push(t),t=t.left;return e},Yi.prototype.St=function(){return 0<this.Et.length},Yi.prototype.Rt=function(){if(0===this.Et.length)return null;var t=this.Et[this.Et.length-1];return{key:t.key,value:t.value}},Yi),zi=(Qi.prototype.copy=function(t,e,n,r,i){return new Qi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Qi.prototype.J=function(){return!1},Qi.prototype.pt=function(t){return this.left.pt(t)||t(this.key,this.value)||this.right.pt(t)},Qi.prototype.gt=function(t){return this.right.gt(t)||t(this.key,this.value)||this.left.gt(t)},Qi.prototype.min=function(){return this.left.J()?this:this.left.min()},Qi.prototype.vt=function(){return this.min().key},Qi.prototype.wt=function(){return this.right.J()?this.key:this.right.wt()},Qi.prototype.lt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.lt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.lt(t,e,n))).Ct()},Qi.prototype.At=function(){if(this.left.J())return Qi.EMPTY;var t=this;return t.left.Pt()||t.left.left.Pt()||(t=t.kt()),(t=t.copy(null,null,null,t.left.At(),null)).Ct()},Qi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.J()||r.left.Pt()||r.left.left.Pt()||(r=r.kt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Pt()&&(r=r.Nt()),r.right.J()||r.right.Pt()||r.right.left.Pt()||(r=r.Ot()),0===e(t,r.key)){if(r.right.J())return Qi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.At())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Ct()},Qi.prototype.Pt=function(){return this.color},Qi.prototype.Ct=function(){var t=this;return t.right.Pt()&&!t.left.Pt()&&(t=t.Ft()),t.left.Pt()&&t.left.left.Pt()&&(t=t.Nt()),t.left.Pt()&&t.right.Pt()&&(t=t.Vt()),t},Qi.prototype.kt=function(){var t=this.Vt();return t.right.left.Pt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Nt())).Ft()).Vt()),t},Qi.prototype.Ot=function(){var t=this.Vt();return t.left.left.Pt()&&(t=(t=t.Nt()).Vt()),t},Qi.prototype.Ft=function(){var t=this.copy(null,null,Qi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Qi.prototype.Nt=function(){var t=this.copy(null,null,Qi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Qi.prototype.Vt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Qi.prototype.Ut=function(){var t=this.xt();return Math.pow(2,t)<=this.size+1},Qi.prototype.xt=function(){if(this.Pt()&&this.left.Pt())throw qr("Red node has red child("+this.key+","+this.value+")");if(this.right.Pt())throw qr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.xt();if(t!==this.right.xt())throw qr("Black depths differ");return t+(this.Pt()?0:1)},Qi.EMPTY=null,Qi.RED=!0,Qi.dt=!1,Qi),Hi=(Object.defineProperty(Wi.prototype,"key",{get:function(){throw qr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Wi.prototype,"value",{get:function(){throw qr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Wi.prototype,"color",{get:function(){throw qr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Wi.prototype,"left",{get:function(){throw qr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Wi.prototype,"right",{get:function(){throw qr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Wi.prototype.copy=function(t,e,n,r,i){return this},Wi.prototype.lt=function(t,e,n){return new zi(t,e)},Wi.prototype.remove=function(t,e){return this},Wi.prototype.J=function(){return!0},Wi.prototype.pt=function(t){return!1},Wi.prototype.gt=function(t){return!1},Wi.prototype.vt=function(){return null},Wi.prototype.wt=function(){return null},Wi.prototype.Pt=function(){return!1},Wi.prototype.Ut=function(){return!0},Wi.prototype.xt=function(){return 0},Wi);function Wi(){this.size=0}function Qi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Qi.RED,this.left=null!=r?r:Qi.EMPTY,this.right=null!=i?i:Qi.EMPTY,this.size=this.left.size+1+this.right.size}function Yi(t,e,n,r){this.Tt=r,this.Et=[];for(var i=1;!t.J();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Tt?t.left:t.right;else{if(0===i){this.Et.push(t);break}this.Et.push(t),t=this.Tt?t.right:t.left}}function Ki(t,e){this.G=t,this.root=e||zi.EMPTY}function Ji(t){this.path=t,Fr(Ji.ht(t),"Invalid DocumentKey with an odd number of segments: "+t.tt().join("/"))}function Xi(){return null!==xi&&xi.apply(this,arguments)||this}function $i(){return null!==Li&&Li.apply(this,arguments)||this}function Zi(t,e,n){void 0===e?e=0:e>t.length&&qr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&qr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function to(t){this.timestamp=t}function eo(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Xr(Jr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Xr(Jr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Xr(Jr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Xr(Jr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function no(t,e){if(vi("GeoPoint",arguments,2),gi("GeoPoint","number",1,t),gi("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Xr(Jr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Xr(Jr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.F=t,this.V=e}zi.EMPTY=new Hi;var ro=(vo.jt=function(t){var e=new vo(t.G);return t.forEach(function(t){e=e.add(t)}),e},vo.prototype.has=function(t){return null!==this.data.get(t)},vo.prototype.first=function(){return this.data.vt()},vo.prototype.last=function(){return this.data.wt()},Object.defineProperty(vo.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),vo.prototype.indexOf=function(t){return this.data.indexOf(t)},vo.prototype.forEach=function(n){this.data.pt(function(t,e){return n(t),!1})},vo.prototype.Lt=function(t,e){for(var n=this.data.yt(t[0]);n.St();){var r=n.Dt();if(0<=this.G(r.key,t[1]))return;e(r.key)}},vo.prototype.qt=function(t,e){var n;for(n=void 0!==e?this.data.yt(e):this.data.bt();n.St();)if(!t(n.Dt().key))return},vo.prototype.Bt=function(t){var e=this.data.yt(t);return e.St()?e.Dt().key:null},vo.prototype.bt=function(){return new io(this.data.bt())},vo.prototype.yt=function(t){return new io(this.data.yt(t))},vo.prototype.add=function(t){return this.copy(this.data.remove(t).lt(t,!0))},vo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},vo.prototype.J=function(){return this.data.J()},vo.prototype.Mt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},vo.prototype.isEqual=function(t){if(!(t instanceof vo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.bt(),n=t.data.bt();e.St();){var r=e.Dt().key,i=n.Dt().key;if(0!==this.G(r,i))return!1}return!0},vo.prototype.tt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},vo.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},vo.prototype.copy=function(t){var e=new vo(this.G);return e.data=t,e},vo),io=(po.prototype.Dt=function(){return this.Qt.Dt().key},po.prototype.St=function(){return this.Qt.St()},po),oo=(lo.prototype.Gt=function(t,e){return new gs(e,t)},lo.prototype.Wt=function(t,e){return e},lo.prototype.zt=function(t){return null},lo.prototype.isEqual=function(t){return t instanceof lo},lo.instance=new lo,lo),so=(fo.prototype.Gt=function(t,e){return this.apply(t)},fo.prototype.Wt=function(t,e){return this.apply(t)},fo.prototype.apply=function(t){for(var n=yo(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Ns(n)},fo.prototype.zt=function(t){return null},fo.prototype.isEqual=function(t){return t instanceof fo&&Br(t.elements,this.elements)},fo),uo=(co.prototype.Gt=function(t,e){return this.apply(t)},co.prototype.Wt=function(t,e){return this.apply(t)},co.prototype.apply=function(t){for(var n=yo(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Ns(n)},co.prototype.zt=function(t){return null},co.prototype.isEqual=function(t){return t instanceof co&&Br(t.elements,this.elements)},co),ao=(ho.prototype.Gt=function(t,e){var n=this.zt(t);if(n instanceof ds&&this.Kt instanceof ds){var r=n.Ht+this.Kt.Ht;return new ds(r)}return r=n.Ht+this.Kt.Ht,new vs(r)},ho.prototype.Wt=function(t,e){return Fr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},ho.prototype.zt=function(t){return t instanceof Fo?t:new ds(0)},ho.prototype.isEqual=function(t){return t instanceof ho&&this.Kt.isEqual(t.Kt)},ho);function ho(t){this.Kt=t}function co(t){this.elements=t}function fo(t){this.elements=t}function lo(){}function po(t){this.Qt=t}function vo(t){this.G=t,this.data=new ji(this.G)}function yo(t){return t instanceof Ns?t.Ht.slice():[]}function mo(t,e){this.version=t,this.transformResults=e}var go,wo,bo,Eo,Io,To,No,Ao,So=(Zo.Jt=function(t){return new Zo(t)},Zo.Yt=function(t){var e=new ro(Vi.G);return t.forEach(function(t){return e=e.add(t)}),new Zo(e)},Zo.prototype.Xt=function(e){var n=!1;return this.fields.forEach(function(t){t.$(e)&&(n=!0)}),n},Zo.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Zo),Do=($o.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},$o),ko=(Xo.exists=function(t){return new Xo(void 0,t)},Xo.updateTime=function(t){return new Xo(t)},Object.defineProperty(Xo.prototype,"$t",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Xo.prototype.Zt=function(t){return void 0!==this.updateTime?t instanceof Ss&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ss:(Fr(this.$t,"Precondition should be empty"),!0)},Xo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},Xo.NONE=new Xo,Xo),Oo=(Jo.prototype.tn=function(t){null!=t&&Fr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Jo.nn=function(t){return t instanceof Ss?t.version:Ui.MIN},Jo),Ro=(t(Ko,Ao=Oo),Ko.prototype.Wt=function(t,e){this.tn(t),Fr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ss(this.key,n,{hasCommittedMutations:!0},this.value)},Ko.prototype.Gt=function(t,e,n){if(this.tn(t),!this.in.Zt(t))return t;var r=Oo.nn(t);return new Ss(this.key,r,{en:!0},this.value)},Ko.prototype.rn=function(t){return null},Ko.prototype.isEqual=function(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.in.isEqual(t.in)},Ko),Co=(t(Yo,No=Oo),Yo.prototype.Wt=function(t,e){if(this.tn(t),Fr(null==e.transformResults,"Transform results received by PatchMutation."),!this.in.Zt(t))return new ks(this.key,e.version);var n=this.sn(t);return new Ss(this.key,e.version,{hasCommittedMutations:!0},n)},Yo.prototype.Gt=function(t,e,n){if(this.tn(t),!this.in.Zt(t))return t;var r=Oo.nn(t),i=this.sn(t);return new Ss(this.key,r,{en:!0},i)},Yo.prototype.rn=function(t){return null},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.un.isEqual(t.un)&&this.in.isEqual(t.in)},Yo.prototype.sn=function(t){var e;return e=t instanceof Ss?t.data():Is.EMPTY,this.on(e)},Yo.prototype.on=function(t){var n=this,r=t.hn();return this.un.fields.forEach(function(t){if(!t.J()){var e=n.data.field(t);null!==e?r.set(t,e):r.delete(t)}}),r.cn()},Yo),xo=(t(Qo,To=Oo),Qo.prototype.Wt=function(t,e){if(this.tn(t),Fr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.in.Zt(t))return new ks(this.key,e.version);var n=this.an(t),r=this.fn(t,e.transformResults),i=e.version,o=this.ln(n.data(),r);return new Ss(this.key,i,{hasCommittedMutations:!0},o)},Qo.prototype.Gt=function(t,e,n){if(this.tn(t),!this.in.Zt(t))return t;var r=this.an(t),i=this.dn(n,t,e),o=this.ln(r.data(),i);return new Ss(this.key,r.version,{en:!0},o)},Qo.prototype.rn=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ss?t.field(i.field):void 0,s=i.transform.zt(o||null);null!=s&&(e=null==e?Is.vn().set(i.field,s):e.set(i.field,s))}return e?e.cn():null},Qo.prototype.isEqual=function(t){return t instanceof Qo&&this.key.isEqual(t.key)&&Br(this.fieldTransforms,t.fieldTransforms)&&this.in.isEqual(t.in)},Qo.prototype.an=function(t){return Fr(t instanceof Ss,"Unknown MaybeDocument type "+t),Fr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},Qo.prototype.fn=function(t,e){var n=[];Fr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Ss&&(s=t.field(i.field)),n.push(o.Wt(s,e[r]))}return n},Qo.prototype.dn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof Ss&&(a=e.field(s.field)),null===a&&n instanceof Ss&&(a=n.field(s.field)),r.push(u.Gt(a,t))}return r},Qo.prototype.ln=function(t,e){Fr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=t.hn(),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.cn()},Qo),Lo=(t(Wo,Io=Oo),Wo.prototype.Wt=function(t,e){return this.tn(t),Fr(null==e.transformResults,"Transform results received by DeleteMutation."),new Ds(this.key,e.version,{hasCommittedMutations:!0})},Wo.prototype.Gt=function(t,e,n){return this.tn(t),this.in.Zt(t)?(t&&Fr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ds(this.key,Ui.q())):t},Wo.prototype.rn=function(t){return null},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&this.in.isEqual(t.in)},Wo),Po=(t(Ho,Eo=Oo),Ho.prototype.Wt=function(t,e){qr("VerifyMutation should only be used in Transactions.")},Ho.prototype.Gt=function(t,e,n){qr("VerifyMutation should only be used in Transactions.")},Ho.prototype.rn=function(t){qr("VerifyMutation should only be used in Transactions.")},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.in.isEqual(t.in)},Ho),_o=(zo.mn=function(t,e){switch(t.serverTimestamps){case"estimate":return new zo(1,e);case"previous":return new zo(2,e);case"none":case void 0:return new zo(0,e);default:return qr("fromSnapshotOptions() called with invalid options.")}},zo),Uo=(Bo.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Bo.prototype.pn=function(t){return Fr(this.gn!==t.gn,"Default compareTo should not be used for values of same type."),jr(this.gn,t.gn)},Bo),Mo=(t(jo,bo=Uo),jo.prototype.value=function(t){return null},jo.prototype.isEqual=function(t){return t instanceof jo},jo.prototype.h=function(t){return t instanceof jo?0:this.pn(t)},jo.prototype.bn=function(){return 4},jo.yn=new jo,jo),qo=(t(Go,wo=Uo),Go.prototype.value=function(t){return this.Ht},Go.prototype.isEqual=function(t){return t instanceof Go&&this.Ht===t.Ht},Go.prototype.h=function(t){return t instanceof Go?jr(this.Ht,t.Ht):this.pn(t)},Go.prototype.bn=function(){return 4},Go.of=function(t){return t?Go._n:Go.In},Go._n=new Go(!0),Go.In=new Go(!1),Go),Fo=(t(Vo,go=Uo),Vo.prototype.value=function(t){return this.Ht},Vo.prototype.h=function(t){return t instanceof Vo?(e=this.Ht)<(n=t.Ht)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.pn(t);var e,n},Vo.prototype.bn=function(){return 8},Vo);function Vo(t){var e=go.call(this)||this;return e.Ht=t,e.gn=2,e}function Go(t){var e=wo.call(this)||this;return e.Ht=t,e.gn=1,e}function jo(){var t=bo.call(this)||this;return t.gn=0,t.Ht=null,t}function Bo(){}function zo(t,e){this.wn=t,this.timestampsInSnapshots=e}function Ho(t,e){var n=Eo.call(this)||this;return n.key=t,n.in=e,n.type=4,n}function Wo(t,e){var n=Io.call(this)||this;return n.key=t,n.in=e,n.type=3,n}function Qo(t,e){var n=To.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=2,n.in=ko.exists(!0),n}function Yo(t,e,n,r){var i=No.call(this)||this;return i.key=t,i.data=e,i.un=n,i.in=r,i.type=1,i}function Ko(t,e,n){var r=Ao.call(this)||this;return r.key=t,r.value=e,r.in=n,r.type=0,r}function Jo(){}function Xo(t,e){this.updateTime=t,this.exists=e,Fr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}function $o(t,e){this.field=t,this.transform=e}function Zo(t){this.fields=t}function ts(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var es,ns,rs,is,os,ss,us,as,hs,cs,fs,ls,ps,ds=(t(Qs,ps=Fo),Qs.prototype.isEqual=function(t){return t instanceof Qs&&ts(this.Ht,t.Ht)},Qs),vs=(t(Ws,ls=Fo),Ws.prototype.isEqual=function(t){return t instanceof Ws&&ts(this.Ht,t.Ht)},Ws.Tn=new Ws(NaN),Ws.POSITIVE_INFINITY=new Ws(1/0),Ws.NEGATIVE_INFINITY=new Ws(-1/0),Ws),ys=(t(Hs,fs=Uo),Hs.prototype.value=function(t){return this.Ht},Hs.prototype.isEqual=function(t){return t instanceof Hs&&this.Ht===t.Ht},Hs.prototype.h=function(t){return t instanceof Hs?jr(this.Ht,t.Ht):this.pn(t)},Hs.prototype.bn=function(){return 2*this.Ht.length},Hs),ms=(t(zs,cs=Uo),zs.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Ht:this.Ht.toDate()},zs.prototype.isEqual=function(t){return t instanceof zs&&this.Ht.isEqual(t.Ht)},zs.prototype.h=function(t){return t instanceof zs?this.Ht.U(t.Ht):t instanceof gs?-1:this.pn(t)},zs.prototype.bn=function(){return 16},zs),gs=(t(Bs,hs=Uo),Bs.prototype.value=function(t){return t&&1===t.wn?new ms(this.En).value(t):t&&2===t.wn&&this.previousValue?this.previousValue.value(t):null},Bs.prototype.isEqual=function(t){return t instanceof Bs&&this.En.isEqual(t.En)},Bs.prototype.h=function(t){return t instanceof Bs?this.En.U(t.En):t instanceof ms?1:this.pn(t)},Bs.prototype.toString=function(){return"<ServerTimestamp localTime="+this.En.toString()+">"},Bs.prototype.bn=function(){return 16+(this.previousValue?this.previousValue.bn():0)},Bs),ws=(t(js,as=Uo),js.prototype.value=function(t){return this.Ht},js.prototype.isEqual=function(t){return t instanceof js&&this.Ht.isEqual(t.Ht)},js.prototype.h=function(t){return t instanceof js?this.Ht.U(t.Ht):this.pn(t)},js.prototype.bn=function(){return this.Ht.Dn()},js),bs=(t(Gs,us=Uo),Gs.prototype.value=function(t){return this.key},Gs.prototype.isEqual=function(t){return t instanceof Gs&&this.key.isEqual(t.key)&&this.s.isEqual(t.s)},Gs.prototype.h=function(t){if(t instanceof Gs){var e=this.s.h(t.s);return 0!==e?e:Gi.G(this.key,t.key)}return this.pn(t)},Gs.prototype.bn=function(){return this.s.projectId.length+this.s.database.length+this.key.toString().length},Gs),Es=(t(Vs,ss=Uo),Vs.prototype.value=function(t){return this.Ht},Vs.prototype.isEqual=function(t){return t instanceof Vs&&this.Ht.isEqual(t.Ht)},Vs.prototype.h=function(t){return t instanceof Vs?this.Ht.U(t.Ht):this.pn(t)},Vs.prototype.bn=function(){return 16},Vs),Is=(t(Fs,os=Uo),Fs.vn=function(){return new Ts(Fs.EMPTY.Ht)},Fs.prototype.value=function(n){var r={};return this.Ht.pt(function(t,e){r[t]=e.value(n)}),r},Fs.prototype.forEach=function(t){this.Ht.pt(t)},Fs.prototype.isEqual=function(t){if(t instanceof Fs){for(var e=this.Ht.bt(),n=t.Ht.bt();e.St()&&n.St();){var r=e.Dt(),i=n.Dt();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.St()&&!n.St()}return!1},Fs.prototype.h=function(t){if(t instanceof Fs){for(var e=this.Ht.bt(),n=t.Ht.bt();e.St()&&n.St();){var r=e.Dt(),i=n.Dt(),o=jr(r.key,i.key)||r.value.h(i.value);if(o)return o}return jr(e.St(),n.St())}return this.pn(t)},Fs.prototype.contains=function(t){return null!==this.field(t)},Fs.prototype.field=function(t){Fr(!t.J(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Fs?e.Ht.get(t):null}),e},Fs.prototype.un=function(){var i=new ro(Vi.G);return this.Ht.forEach(function(t,e){var n=new Vi([t]);if(e instanceof Fs){var r=e.un().fields;r.J()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),So.Jt(i)},Fs.prototype.bn=function(){var n=0;return this.Ht.pt(function(t,e){n+=t.length+e.bn()}),n},Fs.prototype.toString=function(){return this.Ht.toString()},Fs.prototype.hn=function(){return new Ts(this.Ht)},Fs.EMPTY=new Fs(new ji(jr)),Fs),Ts=(qs.prototype.set=function(t,e){Fr(!t.J(),"Cannot set field for empty path on ObjectValue");var n=t.Y();if(1===t.length)this.Ht=this.Ht.lt(n,e);else{var r=this.Ht.get(n),i=(r instanceof Is?r:Is.EMPTY).hn().set(t.K(),e).cn();this.Ht=this.Ht.lt(n,i)}return this},qs.prototype.delete=function(t){Fr(!t.J(),"Cannot delete field for empty path on ObjectValue");var e=t.Y();if(1===t.length)this.Ht=this.Ht.remove(e);else{var n=this.Ht.get(e);if(n instanceof Is){var r=n.hn().delete(t.K()).cn();this.Ht=this.Ht.lt(t.Y(),r)}}return this},qs.prototype.cn=function(){return new Is(this.Ht)},qs),Ns=(t(Ms,is=Uo),Ms.prototype.value=function(e){return this.Ht.map(function(t){return t.value(e)})},Ms.prototype.contains=function(t){for(var e=0,n=this.Ht;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Ms.prototype.forEach=function(t){this.Ht.forEach(t)},Ms.prototype.isEqual=function(t){if(t instanceof Ms){if(this.Ht.length!==t.Ht.length)return!1;for(var e=0;e<this.Ht.length;e++)if(!this.Ht[e].isEqual(t.Ht[e]))return!1;return!0}return!1},Ms.prototype.h=function(t){if(t instanceof Ms){for(var e=Math.min(this.Ht.length,t.Ht.length),n=0;n<e;n++){var r=this.Ht[n].h(t.Ht[n]);if(r)return r}return jr(this.Ht.length,t.Ht.length)}return this.pn(t)},Ms.prototype.bn=function(){return this.Ht.reduce(function(t,e){return t+e.bn()},0)},Ms.prototype.toString=function(){return"["+this.Ht.map(function(t){return t.toString()}).join(",")+"]"},Ms),As=(Us.Sn=function(t,e){return Gi.G(t.key,e.key)},Us),Ss=(t(_s,rs=As),_s.prototype.field=function(t){if(this.Rn)return this.Rn.field(t);this.Cn||(this.Cn=new Map);var e=t.nt(),n=this.Cn.get(e);if(void 0===n){var r=this.An(t);n=void 0===r?null:this.converter(r),this.Cn.set(e,n)}return n},_s.prototype.data=function(){var n=this;if(!this.Rn){var r=Is.vn();li(this.proto.fields||{},function(t,e){r.set(new Vi([t]),n.converter(e))}),this.Rn=r.cn(),this.Cn=void 0}return this.Rn},_s.prototype.value=function(){return this.data().value()},_s.prototype.isEqual=function(t){return t instanceof _s&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.en===t.en&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},_s.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.en+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(_s.prototype,"hasPendingWrites",{get:function(){return this.en||this.hasCommittedMutations},enumerable:!0,configurable:!0}),_s.prototype.An=function(t){Fr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.Y()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},_s.Pn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.h(i):qr("Trying to compare documents on fields that don't exist")},_s),Ds=(t(Ps,ns=As),Ps.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ps.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ps.prototype.isEqual=function(t){return t instanceof Ps&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ps),ks=(t(Ls,es=As),Ls.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ls.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ls.prototype.isEqual=function(t){return t instanceof Ls&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ls),Os=Number,Rs=Os.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Cs=Os.MAX_SAFE_INTEGER||Math.pow(2,53)-1,xs=Os.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Ls(){return null!==es&&es.apply(this,arguments)||this}function Ps(t,e,n){var r=ns.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function _s(t,e,n,r,i,o){var s=rs.call(this,t,e)||this;return s.Rn=r,s.proto=i,s.converter=o,Fr(void 0!==s.Rn||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.en=!!n.en,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function Us(t,e){this.key=t,this.version=e}function Ms(t){var e=is.call(this)||this;return e.Ht=t,e.gn=8,e}function qs(t){this.Ht=t}function Fs(t){var e=os.call(this)||this;return e.Ht=t,e.gn=9,e}function Vs(t){var e=ss.call(this)||this;return e.Ht=t,e.gn=7,e}function Gs(t,e){var n=us.call(this)||this;return n.s=t,n.key=e,n.gn=6,n}function js(t){var e=as.call(this)||this;return e.Ht=t,e.gn=5,e}function Bs(t,e){var n=hs.call(this)||this;return n.En=t,n.previousValue=e,n.gn=3,n}function zs(t){var e=cs.call(this)||this;return e.Ht=t,e.gn=3,e}function Hs(t){var e=fs.call(this)||this;return e.Ht=t,e.gn=4,e}function Ws(){return null!==ls&&ls.apply(this,arguments)||this}function Qs(){return null!==ps&&ps.apply(this,arguments)||this}function Ys(t){return null==t}function Ks(t){return xs(t)&&t<=Cs&&Rs<=t}var Js,Xs,$s,Zs,tu,eu,nu=(Ou.prototype.canonicalId=function(){if(null===this.kn){var t=this.path.nt();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Ys(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.kn=t}return this.kn},Ou.prototype.toString=function(){var t=this.path.nt();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Ys(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Ou.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Ou.prototype.Nn=function(){return Gi.ht(this.path)&&null===this.collectionGroup&&0===this.filters.length},Ou),ru=(ku.jn=function(t){return new ku(t)},Object.defineProperty(ku.prototype,"orderBy",{get:function(){if(null===this.Vn){var t=this.Ln(),e=this.qn();if(null!==t&&null===e)t.ut()?this.Vn=[du]:this.Vn=[new pu(t),du];else{Fr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.Vn=[]),r=0,i=this.On;r<i.length;r++){var o=i[r];this.Vn.push(o),o.field.ut()&&(n=!0)}if(!n){var s=0<this.On.length?this.On[this.On.length-1].dir:fu.ASCENDING;this.Vn.push(s===fu.ASCENDING?du:vu)}}}return this.Vn},enumerable:!0,configurable:!0}),ku.prototype.Bn=function(t){Fr(null==this.Ln()||!(t instanceof ou)||!t.Mn()||t.field.isEqual(this.Ln()),"Query must only have one inequality field."),Fr(!this.Nn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new ku(this.path,this.collectionGroup,this.On.slice(),e,this.limit,this.Fn,this.startAt,this.endAt)},ku.prototype.Qn=function(t){Fr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.On.concat([t]);return new ku(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Fn,this.startAt,this.endAt)},ku.prototype.Gn=function(t){return new ku(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},ku.prototype.Wn=function(t){return new ku(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},ku.prototype.zn=function(t){return new ku(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),this.limit,this.Fn,t,this.endAt)},ku.prototype.Kn=function(t){return new ku(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),this.limit,this.Fn,this.startAt,t)},ku.prototype.Hn=function(t){return new ku(t,null,this.On.slice(),this.filters.slice(),this.limit,this.Fn,this.startAt,this.endAt)},ku.prototype.Jn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.On.length||1===this.On.length&&this.On[0].field.ut())},ku.prototype.canonicalId=function(){return this.Yn().canonicalId()+"|lt:"+this.Fn},ku.prototype.toString=function(){return"Query(target="+this.Yn().toString()+"; limitType="+this.Fn+")"},ku.prototype.isEqual=function(t){return this.Yn().isEqual(t.Yn())&&this.Fn===t.Fn},ku.prototype.Xn=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.ut()}return Fr(n,"orderBy used that doesn't compare on key field"),0},ku.prototype.matches=function(t){return this.$n(t)&&this.Zn(t)&&this.ti(t)&&this.ni(t)},ku.prototype.ii=function(){return!Ys(this.limit)&&"F"===this.Fn},ku.prototype.ei=function(){return!Ys(this.limit)&&"L"===this.Fn},ku.prototype.qn=function(){return 0<this.On.length?this.On[0].field:null},ku.prototype.Ln=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof ou&&n.Mn())return n.field}return null},ku.prototype.ri=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof ou&&0<=t.indexOf(r.op))return r.op}return null},ku.prototype.Nn=function(){return this.Yn().Nn()},ku.prototype.ui=function(){return null!==this.collectionGroup},ku.prototype.Yn=function(){if(!this.Un)if("F"===this.Fn)this.Un=new nu(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===fu.DESCENDING?fu.ASCENDING:fu.DESCENDING;t.push(new pu(r.field,i))}var o=this.endAt?new lu(this.endAt.position,!this.endAt.before):null,s=this.startAt?new lu(this.startAt.position,!this.startAt.before):null;this.Un=new nu(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Un},ku.prototype.$n=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.ct(this.collectionGroup)&&this.path.$(e):Gi.ht(this.path)?this.path.isEqual(e):this.path.Z(e)},ku.prototype.Zn=function(t){for(var e=0,n=this.On;e<n.length;e++){var r=n[e];if(!r.field.ut()&&null===t.field(r.field))return!1}return!0},ku.prototype.ti=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},ku.prototype.ni=function(t){return!(this.startAt&&!this.startAt.si(this.orderBy,t)||this.endAt&&this.endAt.si(this.orderBy,t))},ku.prototype.xn=function(t){Fr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},ku),iu=(Du.it=function(t){switch(t){case"<":return Du.LESS_THAN;case"<=":return Du.LESS_THAN_OR_EQUAL;case"==":return Du.EQUAL;case">=":return Du.GREATER_THAN_OR_EQUAL;case">":return Du.GREATER_THAN;case"array-contains":return Du.ARRAY_CONTAINS;case"in":return Du.IN;case"array-contains-any":return Du.ARRAY_CONTAINS_ANY;default:return qr("Unknown FieldFilter operator: "+t)}},Du.prototype.toString=function(){return this.name},Du.prototype.isEqual=function(t){return this.name===t.name},Du.LESS_THAN=new Du("<"),Du.LESS_THAN_OR_EQUAL=new Du("<="),Du.EQUAL=new Du("=="),Du.GREATER_THAN=new Du(">"),Du.GREATER_THAN_OR_EQUAL=new Du(">="),Du.ARRAY_CONTAINS=new Du("array-contains"),Du.IN=new Du("in"),Du.ARRAY_CONTAINS_ANY=new Du("array-contains-any"),Du),ou=(t(Su,eu=function(){}),Su.create=function(t,e,n){if(t.ut())return e===iu.IN?(Fr(n instanceof Ns,"Comparing on key with IN, but filter value not an ArrayValue"),Fr(n.Ht.every(function(t){return t instanceof bs}),"Comparing on key with IN, but an array value was not a RefValue"),new uu(t,n)):(Fr(n instanceof bs,"Comparing on key, but filter value not a RefValue"),Fr(e!==iu.ARRAY_CONTAINS&&e!==iu.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new su(t,e,n));if(n.isEqual(Mo.yn)){if(e!==iu.EQUAL)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Su(t,e,n)}if(n.isEqual(vs.Tn)){if(e!==iu.EQUAL)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Su(t,e,n)}return e===iu.ARRAY_CONTAINS?new au(t,n):e===iu.IN?(Fr(n instanceof Ns,"IN filter has invalid value: "+n.toString()),new hu(t,n)):e===iu.ARRAY_CONTAINS_ANY?(Fr(n instanceof Ns,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new cu(t,n)):new Su(t,e,n)},Su.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.gn===e.gn&&this.oi(e.h(this.value))},Su.prototype.oi=function(t){switch(this.op){case iu.LESS_THAN:return t<0;case iu.LESS_THAN_OR_EQUAL:return t<=0;case iu.EQUAL:return 0===t;case iu.GREATER_THAN:return 0<t;case iu.GREATER_THAN_OR_EQUAL:return 0<=t;default:return qr("Unknown FieldFilter operator: "+this.op)}},Su.prototype.Mn=function(){return 0<=[iu.LESS_THAN,iu.LESS_THAN_OR_EQUAL,iu.GREATER_THAN,iu.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Su.prototype.canonicalId=function(){return this.field.nt()+this.op.toString()+this.value.toString()},Su.prototype.isEqual=function(t){return t instanceof Su&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Su.prototype.toString=function(){return this.field.nt()+" "+this.op+" "+this.value.value()},Su),su=(t(Au,tu=ou),Au.prototype.matches=function(t){var e=this.value,n=Gi.G(t.key,e.key);return this.oi(n)},Au),uu=(t(Nu,Zs=ou),Nu.prototype.matches=function(e){return this.value.Ht.some(function(t){return e.key.isEqual(t.key)})},Nu),au=(t(Tu,$s=ou),Tu.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Ns&&e.contains(this.value)},Tu),hu=(t(Iu,Xs=ou),Iu.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},Iu),cu=(t(Eu,Js=ou),Eu.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Ns&&n.Ht.some(function(t){return e.value.contains(t)})},Eu),fu=(bu.prototype.toString=function(){return this.name},bu.ASCENDING=new bu("asc"),bu.DESCENDING=new bu("desc"),bu),lu=(wu.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},wu.prototype.si=function(t,e){Fr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.ut())Fr(o instanceof bs,"Bound has a non-key value where the key path is being used."),n=Gi.G(o.key,e.key);else{var s=e.field(i.field);Fr(null!==s,"Field should exist since document matched the orderBy already."),n=o.h(s)}if(i.dir===fu.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},wu.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},wu),pu=(gu.prototype.compare=function(t,e){var n=this.hi?Ss.Sn(t,e):Ss.Pn(this.field,t,e);switch(this.dir){case fu.ASCENDING:return n;case fu.DESCENDING:return-1*n;default:return qr("Unknown direction: "+this.dir)}},gu.prototype.canonicalId=function(){return this.field.nt()+this.dir.toString()},gu.prototype.toString=function(){return this.field.nt()+" ("+this.dir+")"},gu.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},gu),du=new pu(Vi.st(),fu.ASCENDING),vu=new pu(Vi.st(),fu.DESCENDING),yu=(mu.fromBase64String=function(t){return new mu(Na.t().atob(t))},mu.fromUint8Array=function(t){return new mu(Ru(t))},mu.prototype.toBase64=function(){return Na.t().btoa(this.ci)},mu.prototype.toUint8Array=function(){return Cu(this.ci)},mu.prototype.bn=function(){return 2*this.ci.length},mu.prototype.isEqual=function(t){return this.ci===t.ci},mu.ai=new mu(""),mu);function mu(t){this.ci=t}function gu(t,e){this.field=t,void 0===e&&(e=fu.ASCENDING),this.dir=e,this.hi=t.ut()}function wu(t,e){this.position=t,this.before=e}function bu(t){this.name=t}function Eu(t,e){var n=Js.call(this,t,iu.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function Iu(t,e){var n=Xs.call(this,t,iu.IN,e)||this;return n.value=e,n}function Tu(t,e){return $s.call(this,t,iu.ARRAY_CONTAINS,e)||this}function Nu(t,e){var n=Zs.call(this,t,iu.IN,e)||this;return n.value=e,n}function Au(){return null!==tu&&tu.apply(this,arguments)||this}function Su(t,e,n){var r=eu.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function Du(t){this.name=t}function ku(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.On=n,this.filters=r,this.limit=i,this.Fn=o,this.startAt=s,this.endAt=u,this.Vn=null,this.Un=null,this.startAt&&this.xn(this.startAt),this.endAt&&this.xn(this.endAt)}function Ou(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.kn=null}function Ru(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}function Cu(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}var xu,Lu,Pu=(Mu.prototype.di=function(t){return new Mu(this.target,this.targetId,this.fi,t,this.li,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Mu.prototype.vi=function(t,e){return new Mu(this.target,this.targetId,this.fi,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Mu.prototype.wi=function(t){return new Mu(this.target,this.targetId,this.fi,this.sequenceNumber,this.li,t,this.resumeToken)},Mu.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.fi===t.fi&&this.sequenceNumber===t.sequenceNumber&&this.li.isEqual(t.li)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},Mu),_u=(Uu.prototype.isEqual=function(t){return t&&t.count===this.count},Uu);function Uu(t){this.count=t}function Mu(t,e,n,r,i,o,s){void 0===i&&(i=Ui.MIN),void 0===o&&(o=Ui.MIN),void 0===s&&(s=yu.ai),this.target=t,this.targetId=e,this.fi=n,this.sequenceNumber=r,this.li=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function qu(t){switch(t){case Jr.OK:return qr("Treated status OK as error");case Jr.CANCELLED:case Jr.UNKNOWN:case Jr.DEADLINE_EXCEEDED:case Jr.RESOURCE_EXHAUSTED:case Jr.INTERNAL:case Jr.UNAVAILABLE:case Jr.UNAUTHENTICATED:return!1;case Jr.INVALID_ARGUMENT:case Jr.NOT_FOUND:case Jr.ALREADY_EXISTS:case Jr.PERMISSION_DENIED:case Jr.FAILED_PRECONDITION:case Jr.ABORTED:case Jr.OUT_OF_RANGE:case Jr.UNIMPLEMENTED:case Jr.DATA_LOSS:return!0;default:return qr("Unknown status code: "+t)}}function Fu(t){if(void 0===t)return Ur("GRPC error has no .code"),Jr.UNKNOWN;switch(t){case xu.OK:return Jr.OK;case xu.CANCELLED:return Jr.CANCELLED;case xu.UNKNOWN:return Jr.UNKNOWN;case xu.DEADLINE_EXCEEDED:return Jr.DEADLINE_EXCEEDED;case xu.RESOURCE_EXHAUSTED:return Jr.RESOURCE_EXHAUSTED;case xu.INTERNAL:return Jr.INTERNAL;case xu.UNAVAILABLE:return Jr.UNAVAILABLE;case xu.UNAUTHENTICATED:return Jr.UNAUTHENTICATED;case xu.INVALID_ARGUMENT:return Jr.INVALID_ARGUMENT;case xu.NOT_FOUND:return Jr.NOT_FOUND;case xu.ALREADY_EXISTS:return Jr.ALREADY_EXISTS;case xu.PERMISSION_DENIED:return Jr.PERMISSION_DENIED;case xu.FAILED_PRECONDITION:return Jr.FAILED_PRECONDITION;case xu.ABORTED:return Jr.ABORTED;case xu.OUT_OF_RANGE:return Jr.OUT_OF_RANGE;case xu.UNIMPLEMENTED:return Jr.UNIMPLEMENTED;case xu.DATA_LOSS:return Jr.DATA_LOSS;default:return qr("Unknown status code: "+t)}}(Lu=xu=xu||{})[Lu.OK=0]="OK",Lu[Lu.CANCELLED=1]="CANCELLED",Lu[Lu.UNKNOWN=2]="UNKNOWN",Lu[Lu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Lu[Lu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Lu[Lu.NOT_FOUND=5]="NOT_FOUND",Lu[Lu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Lu[Lu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Lu[Lu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Lu[Lu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Lu[Lu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Lu[Lu.ABORTED=10]="ABORTED",Lu[Lu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Lu[Lu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Lu[Lu.INTERNAL=13]="INTERNAL",Lu[Lu.UNAVAILABLE=14]="UNAVAILABLE",Lu[Lu.DATA_LOSS=15]="DATA_LOSS";var Vu=new ji(Gi.G);function Gu(){return Vu}function ju(){return Gu()}var Bu=new ji(Gi.G);function zu(){return Bu}var Hu=new ji(Gi.G);function Wu(){return Hu}var Qu=new ro(Gi.G);function Yu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Qu,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ku=new ro(jr);function Ju(){return Ku}function Xu(t,e,n,r){this.Ui=t,this.removedTargetIds=e,this.key=n,this.xi=r}function $u(t,e){this.targetId=t,this.ji=e}function Zu(t,e,n,r){void 0===n&&(n=yu.ai),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ta=(pa.gi=function(t){return new pa(t.G)},pa.prototype.has=function(t){return null!=this.mi.get(t)},pa.prototype.get=function(t){return this.mi.get(t)},pa.prototype.first=function(){return this.pi.vt()},pa.prototype.last=function(){return this.pi.wt()},pa.prototype.J=function(){return this.pi.J()},pa.prototype.indexOf=function(t){var e=this.mi.get(t);return e?this.pi.indexOf(e):-1},Object.defineProperty(pa.prototype,"size",{get:function(){return this.pi.size},enumerable:!0,configurable:!0}),pa.prototype.forEach=function(n){this.pi.pt(function(t,e){return n(t),!1})},pa.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.mi.lt(t.key,t),e.pi.lt(t,null))},pa.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.mi.remove(t),this.pi.remove(e)):this},pa.prototype.isEqual=function(t){if(!(t instanceof pa))return!1;if(this.size!==t.size)return!1;for(var e=this.pi.bt(),n=t.pi.bt();e.St();){var r=e.Dt().key,i=n.Dt().key;if(!r.isEqual(i))return!1}return!0},pa.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},pa.prototype.copy=function(t,e){var n=new pa;return n.G=this.G,n.mi=t,n.pi=e,n},pa),ea=(la.prototype.track=function(t){var e=t.doc.key,n=this.bi.get(e);n?0!==t.type&&3===n.type?this.bi=this.bi.lt(e,t):3===t.type&&1!==n.type?this.bi=this.bi.lt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.bi=this.bi.lt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.bi=this.bi.lt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.bi=this.bi.remove(e):1===t.type&&2===n.type?this.bi=this.bi.lt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.bi=this.bi.lt(e,{type:2,doc:t.doc}):qr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.bi=this.bi.lt(e,t)},la.prototype.yi=function(){var n=[];return this.bi.pt(function(t,e){n.push(e)}),n},la),na=(fa.Di=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new fa(t,e,ta.gi(e),i,n,r,!0,!1)},Object.defineProperty(fa.prototype,"hasPendingWrites",{get:function(){return!this.Ii.J()},enumerable:!0,configurable:!0}),fa.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Ti===t.Ti&&this.Ii.isEqual(t.Ii)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this._i.isEqual(t._i)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},fa),ra=(ca.Pi=function(t,e){var n,r=((n={})[t]=ia.ki(t,e),n);return new ca(Ui.MIN,r,Ju(),Gu(),Yu())},ca),ia=(ha.ki=function(t,e){return new ha(yu.ai,e,Yu(),Yu(),Yu())},ha),oa=(Object.defineProperty(aa.prototype,"Ni",{get:function(){return this.Mi},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"resumeToken",{get:function(){return this.Bi},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"Gi",{get:function(){return 0!==this.Li},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"Wi",{get:function(){return this.Qi},enumerable:!0,configurable:!0}),aa.prototype.zi=function(t){0<t.bn()&&(this.Qi=!0,this.Bi=t)},aa.prototype.Ki=function(){var n=Yu(),r=Yu(),i=Yu();return this.qi.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:qr("Encountered invalid change type: "+e)}}),new ia(this.Bi,this.Mi,n,r,i)},aa.prototype.Hi=function(){this.Qi=!1,this.qi=va()},aa.prototype.Ji=function(t,e){this.Qi=!0,this.qi=this.qi.lt(t,e)},aa.prototype.Yi=function(t){this.Qi=!0,this.qi=this.qi.remove(t)},aa.prototype.Xi=function(){this.Li+=1},aa.prototype.$i=function(){this.Li-=1},aa.prototype.Zi=function(){this.Qi=!0,this.Mi=!0},aa),sa=(ua.prototype.ue=function(t){for(var e=0,n=t.Ui;e<n.length;e++){var r=n[e];t.xi instanceof Ss?this.se(r,t.xi):t.xi instanceof Ds&&this.oe(r,t.key,t.xi)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.oe(r,t.key,t.xi)},ua.prototype.he=function(n){var r=this;this.ce(n,function(t){var e=r.ae(t);switch(n.state){case 0:r.fe(t)&&e.zi(n.resumeToken);break;case 1:e.$i(),e.Gi||e.Hi(),e.zi(n.resumeToken);break;case 2:e.$i(),e.Gi||r.removeTarget(t),Fr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:r.fe(t)&&(e.Zi(),e.zi(n.resumeToken));break;case 4:r.fe(t)&&(r.le(t),e.zi(n.resumeToken));break;default:qr("Unknown target watch change state: "+n.state)}})},ua.prototype.ce=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):fi(this.ne,e)},ua.prototype.de=function(t){var e=t.targetId,n=t.ji.count,r=this.ve(e);if(r){var i=r.target;if(i.Nn())if(0===n){var o=new Gi(i.path);this.oe(e,o,new Ds(o,Ui.q()))}else Fr(1===n,"Single document existence filter with count: "+n);else this.we(e)!==n&&(this.le(e),this.re=this.re.add(e))}},ua.prototype.me=function(i){var o=this,s={};fi(this.ne,function(t,e){var n=o.ve(t);if(n){if(e.Ni&&n.target.Nn()){var r=new Gi(n.target.path);null!==o.ie.get(r)||o.pe(t,r)||o.oe(t,r,new Ds(r,i))}e.Wi&&(s[t]=e.Ki(),e.Hi())}});var r=Yu();this.ee.forEach(function(t,e){var n=!0;e.qt(function(t){var e=o.ve(t);return!e||2===e.fi||(n=!1)}),n&&(r=r.add(t))});var t=new ra(i,s,this.re,this.ie,r);return this.ie=Gu(),this.ee=da(),this.re=new ro(jr),t},ua.prototype.se=function(t,e){if(this.fe(t)){var n=this.pe(t,e.key)?2:0;this.ae(t).Ji(e.key,n),this.ie=this.ie.lt(e.key,e),this.ee=this.ee.lt(e.key,this.ge(e.key).add(t))}},ua.prototype.oe=function(t,e,n){if(this.fe(t)){var r=this.ae(t);this.pe(t,e)?r.Ji(e,1):r.Yi(e),this.ee=this.ee.lt(e,this.ge(e).delete(t)),n&&(this.ie=this.ie.lt(e,n))}},ua.prototype.removeTarget=function(t){delete this.ne[t]},ua.prototype.we=function(t){var e=this.ae(t).Ki();return this.te.be(t).size+e.Oi.size-e.Vi.size},ua.prototype.Xi=function(t){this.ae(t).Xi()},ua.prototype.ae=function(t){return this.ne[t]||(this.ne[t]=new oa),this.ne[t]},ua.prototype.ge=function(t){var e=this.ee.get(t);return e||(e=new ro(jr),this.ee=this.ee.lt(t,e)),e},ua.prototype.fe=function(t){var e=null!==this.ve(t);return e||_r("WatchChangeAggregator","Detected inactive target",t),e},ua.prototype.ve=function(t){var e=this.ne[t];return e&&e.Gi?null:this.te.ye(t)},ua.prototype.le=function(e){var n=this;Fr(!this.ne[e].Gi,"Should only reset active targets"),this.ne[e]=new oa,this.te.be(e).forEach(function(t){n.oe(e,t,null)})},ua.prototype.pe=function(t,e){return this.te.be(t).has(e)},ua);function ua(t){this.te=t,this.ne={},this.ie=Gu(),this.ee=da(),this.re=new ro(jr)}function aa(){this.Li=0,this.qi=va(),this.Bi=yu.ai,this.Mi=!1,this.Qi=!0}function ha(t,e,n,r,i){this.resumeToken=t,this.Ni=e,this.Oi=n,this.Fi=r,this.Vi=i}function ca(t,e,n,r,i){this.li=t,this.Si=e,this.Ri=n,this.Ci=r,this.Ai=i}function fa(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this._i=n,this.docChanges=r,this.Ii=i,this.fromCache=o,this.Ti=s,this.Ei=u}function la(){this.bi=new ji(Gi.G)}function pa(n){this.G=n?function(t,e){return n(t,e)||Gi.G(t.key,e.key)}:function(t,e){return Gi.G(t.key,e.key)},this.mi=zu(),this.pi=new ji(this.G)}function da(){return new ji(Gi.G)}function va(){return new ji(Gi.G)}var ya,ma,ga=((ya={})[fu.ASCENDING.name]="ASCENDING",ya[fu.DESCENDING.name]="DESCENDING",ya),wa=((ma={})[iu.LESS_THAN.name]="LESS_THAN",ma[iu.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",ma[iu.GREATER_THAN.name]="GREATER_THAN",ma[iu.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",ma[iu.EQUAL.name]="EQUAL",ma[iu.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",ma[iu.IN.name]="IN",ma[iu.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",ma),ba=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ea(t,e){Fr(!Ys(t),e+" is missing")}function Ia(t){return"number"==typeof t?t:"string"==typeof t?Number(t):qr("can't parse "+t)}var Ta=(Sa.prototype._e=function(t){var e=void 0===t.code?Jr.UNKNOWN:Fu(t.code);return new Xr(e,t.message||"")},Sa.prototype.Ie=function(t){return this.options.Te||Ys(t)?t:{value:t}},Sa.prototype.Ee=function(t){var e;return Ys(e="object"==typeof t?t.value:t)?null:e},Sa.prototype.M=function(t){return this.options.Te?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Sa.prototype.L=function(t){if("string"==typeof t)return this.De(t);Fr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Ia(t.seconds||"0"),n=t.nanos||0;return new _i(e,n)},Sa.prototype.De=function(t){var e=0,n=ba.exec(t);if(Fr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new _i(o,e)},Sa.prototype.Se=function(t){return this.options.Te?t.toBase64():t.toUint8Array()},Sa.prototype.Re=function(t){return this.options.Te?(Fr(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),yu.fromBase64String(t||"")):(Fr(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),yu.fromUint8Array(t||new Uint8Array))},Sa.prototype.Ce=function(t){return"string"==typeof t?(Fr(this.options.Te,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ca.fromBase64String(t)):(Fr(!this.options.Te,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ca.fromUint8Array(t))},Sa.prototype.toVersion=function(t){return this.M(t.M())},Sa.prototype.fromVersion=function(t){return Fr(!!t,"Trying to deserialize version that isn't set"),Ui.L(this.L(t))},Sa.prototype.Ae=function(t,e){return this.Pe(t).child("documents").child(e).nt()},Sa.prototype.ke=function(t){var e=qi.it(t);return Fr(this.Ne(e),"Tried to deserialize invalid key "+e.toString()),e},Sa.prototype.Oe=function(t){return this.Ae(this.s,t.path)},Sa.prototype.Fe=function(t){var e=this.ke(t);return Fr(e.get(1)===this.s.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.s.projectId),Fr(!e.get(3)&&!this.s.database||e.get(3)===this.s.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.s.database),new Gi(this.Ve(e))},Sa.prototype.Ue=function(t){return this.Ae(this.s,t)},Sa.prototype.xe=function(t){var e=this.ke(t);return 4===e.length?qi.et:this.Ve(e)},Object.defineProperty(Sa.prototype,"je",{get:function(){return new qi(["projects",this.s.projectId,"databases",this.s.database]).nt()},enumerable:!0,configurable:!0}),Sa.prototype.Pe=function(t){return new qi(["projects",t.projectId,"databases",t.database])},Sa.prototype.Ve=function(t){return Fr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.K(5)},Sa.prototype.Ne=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Sa.prototype.Le=function(t){if(t instanceof Mo)return{nullValue:"NULL_VALUE"};if(t instanceof qo)return{booleanValue:t.value()};if(t instanceof ds)return{integerValue:""+t.value()};if(t instanceof vs){var e=t.value();if(this.options.Te){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof ys?{stringValue:t.value()}:t instanceof Is?{mapValue:this.qe(t)}:t instanceof Ns?{arrayValue:this.Be(t)}:t instanceof ms?{timestampValue:this.M(t.Ht)}:t instanceof Es?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof ws?{bytesValue:this.Se(t.value())}:t instanceof bs?{referenceValue:this.Ae(t.s,t.key.path)}:qr("Unknown FieldValue "+JSON.stringify(t))},Sa.prototype.Me=function(t){var e=this;if("nullValue"in t)return Mo.yn;if("booleanValue"in t)return qo.of(t.booleanValue);if("integerValue"in t)return new ds(Ia(t.integerValue));if("doubleValue"in t){if(this.options.Te){if("NaN"===t.doubleValue)return vs.Tn;if("Infinity"===t.doubleValue)return vs.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return vs.NEGATIVE_INFINITY}return new vs(t.doubleValue)}if("stringValue"in t)return new ys(t.stringValue);if("mapValue"in t)return this.Qe(t.mapValue.fields||{});if("arrayValue"in t){Ea(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Ns(n.map(function(t){return e.Me(t)}))}if("timestampValue"in t)return Ea(t.timestampValue,"timestampValue"),new ms(this.L(t.timestampValue));if("geoPointValue"in t){Ea(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Es(new Pi(r,i))}if("bytesValue"in t){Ea(t.bytesValue,"bytesValue");var o=this.Ce(t.bytesValue);return new ws(o)}if("referenceValue"in t){Ea(t.referenceValue,"referenceValue");var s=this.ke(t.referenceValue),u=new Yr(s.get(1),s.get(3)),a=new Gi(this.Ve(s));return new bs(u,a)}return qr("Unknown Value proto "+JSON.stringify(t))},Sa.prototype.Ge=function(t,e){return{name:this.Oe(t),fields:this.We(e)}},Sa.prototype.ze=function(t){return Fr(!t.en,"Can't serialize documents with mutations."),{name:this.Oe(t.key),fields:this.We(t.data()),updateTime:this.M(t.version.M())}},Sa.prototype.Ke=function(t,e){var n=this,r=this.Fe(t.name),i=this.fromVersion(t.updateTime);return new Ss(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.Me(t)})},Sa.prototype.We=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.Le(e)}),r},Sa.prototype.Qe=function(t){var n=this,e=t,r=Is.vn();return li(e,function(t,e){r.set(new Vi([t]),n.Me(e))}),r.cn()},Sa.prototype.qe=function(t){return{fields:this.We(t)}},Sa.prototype.Be=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.Le(t))}),{values:n}},Sa.prototype.He=function(t){var e=this;Fr(!!t.found,"Tried to deserialize a found document from a missing document."),Ea(t.found.name,"doc.found.name"),Ea(t.found.updateTime,"doc.found.updateTime");var n=this.Fe(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ss(n,r,{},void 0,t.found,function(t){return e.Me(t)})},Sa.prototype.Je=function(t){Fr(!!t.missing,"Tried to deserialize a missing document from a found document."),Fr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.Fe(t.missing),n=this.fromVersion(t.readTime);return new Ds(e,n)},Sa.prototype.Ye=function(t){return"found"in t?this.He(t):"missing"in t?this.Je(t):qr("invalid batch get response: "+JSON.stringify(t))},Sa.prototype.Xe=function(t){switch(t){case 1:return"ADD";case 3:return"CURRENT";case 0:return"NO_CHANGE";case 2:return"REMOVE";case 4:return"RESET";default:return qr("Unknown WatchTargetChangeState: "+t)}},Sa.prototype.$e=function(t){if(t instanceof $u)return{filter:{count:t.ji.count,targetId:t.targetId}};if(t instanceof Xu){if(t.xi instanceof Ss){var e=t.xi;return{documentChange:{document:{name:this.Oe(e.key),fields:this.We(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.Ui,removedTargetIds:t.removedTargetIds}}}if(t.xi instanceof Ds)return e=t.xi,{documentDelete:{document:this.Oe(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.xi)return{documentRemove:{document:this.Oe(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Zu){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return xu.OK;switch(t){case Jr.OK:return xu.OK;case Jr.CANCELLED:return xu.CANCELLED;case Jr.UNKNOWN:return xu.UNKNOWN;case Jr.DEADLINE_EXCEEDED:return xu.DEADLINE_EXCEEDED;case Jr.RESOURCE_EXHAUSTED:return xu.RESOURCE_EXHAUSTED;case Jr.INTERNAL:return xu.INTERNAL;case Jr.UNAVAILABLE:return xu.UNAVAILABLE;case Jr.UNAUTHENTICATED:return xu.UNAUTHENTICATED;case Jr.INVALID_ARGUMENT:return xu.INVALID_ARGUMENT;case Jr.NOT_FOUND:return xu.NOT_FOUND;case Jr.ALREADY_EXISTS:return xu.ALREADY_EXISTS;case Jr.PERMISSION_DENIED:return xu.PERMISSION_DENIED;case Jr.FAILED_PRECONDITION:return xu.FAILED_PRECONDITION;case Jr.ABORTED:return xu.ABORTED;case Jr.OUT_OF_RANGE:return xu.OUT_OF_RANGE;case Jr.UNIMPLEMENTED:return xu.UNIMPLEMENTED;case Jr.DATA_LOSS:return xu.DATA_LOSS;default:return qr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Xe(t.state),targetIds:t.targetIds,resumeToken:this.Se(t.resumeToken),cause:n}}}return qr("Unrecognized watch change: "+JSON.stringify(t))},Sa.prototype.Ze=function(t){var e,n=this;if("targetChange"in t){Ea(t.targetChange,"targetChange");var r=this.tr(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=this.Re(t.targetChange.resumeToken),s=t.targetChange.cause,u=s&&this._e(s);e=new Zu(r,i,o,u||null)}else if("documentChange"in t){Ea(t.documentChange,"documentChange");var a=t.documentChange;Ea(a.document,"documentChange.name"),Ea(a.document.name,"documentChange.document.name"),Ea(a.document.updateTime,"documentChange.document.updateTime");var h=this.Fe(a.document.name),c=this.fromVersion(a.document.updateTime),f=new Ss(h,c,{},void 0,a.document,function(t){return n.Me(t)}),l=a.targetIds||[],p=a.removedTargetIds||[];e=new Xu(l,p,f.key,f)}else if("documentDelete"in t){Ea(t.documentDelete,"documentDelete");var d=t.documentDelete;Ea(d.document,"documentDelete.document"),h=this.Fe(d.document),c=d.readTime?this.fromVersion(d.readTime):Ui.q(),f=new Ds(h,c),p=d.removedTargetIds||[],e=new Xu([],p,f.key,f)}else if("documentRemove"in t){Ea(t.documentRemove,"documentRemove");var v=t.documentRemove;Ea(v.document,"documentRemove"),h=this.Fe(v.document),p=v.removedTargetIds||[],e=new Xu([],p,h,null)}else{if(!("filter"in t))return qr("Unknown change type "+JSON.stringify(t));Ea(t.filter,"filter");var y=t.filter;Ea(y.targetId,"filter.targetId");var m=y.count||0,g=new _u(m),w=y.targetId;e=new $u(w,g)}return e},Sa.prototype.tr=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:qr("Got unexpected TargetChange.state: "+t)},Sa.prototype.nr=function(t){if(!("targetChange"in t))return Ui.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ui.MIN:e.readTime?this.fromVersion(e.readTime):Ui.MIN},Sa.prototype.ir=function(t){var e,n=this;if(t instanceof Ro)e={update:this.Ge(t.key,t.value)};else if(t instanceof Lo)e={delete:this.Oe(t.key)};else if(t instanceof Co)e={update:this.Ge(t.key,t.data),updateMask:this.er(t.un)};else if(t instanceof xo)e={transform:{document:this.Oe(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.rr(t)})}};else{if(!(t instanceof Po))return qr("Unknown mutation type "+t.type);e={verify:this.Oe(t.key)}}return t.in.$t||(e.currentDocument=this.ur(t.in)),e},Sa.prototype.sr=function(t){var e=this,n=t.currentDocument?this.or(t.currentDocument):ko.NONE;if(t.update){Ea(t.update.name,"name");var r=this.Fe(t.update.name),i=this.Qe(t.update.fields||{});if(t.updateMask){var o=this.hr(t.updateMask);return new Co(r,i,o,n)}return new Ro(r,i,n)}if(t.delete)return r=this.Fe(t.delete),new Lo(r,n);if(t.transform){r=this.Fe(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.cr(t)});return Fr(!0===n.exists,'Transforms only support precondition "exists == true"'),new xo(r,s)}return t.verify?(r=this.Fe(t.verify),new Po(r,n)):qr("unknown mutation proto: "+JSON.stringify(t))},Sa.prototype.ur=function(t){return Fr(!t.$t,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:qr("Unknown precondition")},Sa.prototype.or=function(t){return void 0!==t.updateTime?ko.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ko.exists(t.exists):ko.NONE},Sa.prototype.ar=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Ui.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.Me(t)})),new mo(r,i)},Sa.prototype.lr=function(t,e){var n=this;return t&&0<t.length?(Fr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.ar(t,e)})):[]},Sa.prototype.rr=function(t){var e=this,n=t.transform;if(n instanceof oo)return{fieldPath:t.field.nt(),setToServerValue:"REQUEST_TIME"};if(n instanceof so)return{fieldPath:t.field.nt(),appendMissingElements:{values:n.elements.map(function(t){return e.Le(t)})}};if(n instanceof uo)return{fieldPath:t.field.nt(),removeAllFromArray:{values:n.elements.map(function(t){return e.Le(t)})}};if(n instanceof ao)return{fieldPath:t.field.nt(),increment:this.Le(n.Kt)};throw qr("Unknown transform: "+t.transform)},Sa.prototype.cr=function(t){var e=this,n=null;if("setToServerValue"in t)Fr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=oo.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new so(r.map(function(t){return e.Me(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new uo(r.map(function(t){return e.Me(t)}));else if("increment"in t){var i=this.Me(t.increment);Fr(i instanceof Fo,"NUMERIC_ADD transform requires a NumberValue"),n=new ao(i)}else qr("Unknown transform proto: "+JSON.stringify(t));var o=Vi.ot(t.fieldPath);return new Do(o,n)},Sa.prototype.dr=function(t){return{documents:[this.Ue(t.path)]}},Sa.prototype.vr=function(t){var e=t.documents.length;Fr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return ru.jn(this.xe(n)).Yn()},Sa.prototype.wr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Fr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.Ue(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Fr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.Ue(n.H()),e.structuredQuery.from=[{collectionId:n.X()}]);var r=this.mr(t.filters);r&&(e.structuredQuery.where=r);var i=this.pr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.Ie(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.gr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.gr(t.endAt)),e},Sa.prototype.br=function(t){var e=this.xe(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Fr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.yr(n.where));var u=[];n.orderBy&&(u=this._r(n.orderBy));var a=null;n.limit&&(a=this.Ee(n.limit));var h=null;n.startAt&&(h=this.Ir(n.startAt));var c=null;return n.endAt&&(c=this.Ir(n.endAt)),new ru(e,i,u,s,a,"F",h,c).Yn()},Sa.prototype.Tr=function(t){var e=this.Er(t.fi);return null==e?null:{"goog-listen-tags":e}},Sa.prototype.Er=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return qr("Unrecognized query purpose: "+t)}},Sa.prototype.Yn=function(t){var e,n=t.target;return(e=n.Nn()?{documents:this.dr(n)}:{query:this.wr(n)}).targetId=t.targetId,0<t.resumeToken.bn()&&(e.resumeToken=this.Se(t.resumeToken)),e},Sa.prototype.mr=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof ou?e.Dr(t):qr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Sa.prototype.yr=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Sr(t)]:void 0!==t.fieldFilter?[this.Rr(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.yr(t)}).reduce(function(t,e){return t.concat(e)}):qr("Unknown filter: "+JSON.stringify(t)):[]},Sa.prototype.pr=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Cr(t)})},Sa.prototype._r=function(t){var e=this;return t.map(function(t){return e.Ar(t)})},Sa.prototype.gr=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.Le(t)})}},Sa.prototype.Ir=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.Me(t)});return new lu(r,n)},Sa.prototype.Pr=function(t){return ga[t.name]},Sa.prototype.kr=function(t){switch(t){case"ASCENDING":return fu.ASCENDING;case"DESCENDING":return fu.DESCENDING;default:return}},Sa.prototype.Nr=function(t){return wa[t.name]},Sa.prototype.Or=function(t){switch(t){case"EQUAL":return iu.EQUAL;case"GREATER_THAN":return iu.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return iu.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return iu.LESS_THAN;case"LESS_THAN_OR_EQUAL":return iu.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return iu.ARRAY_CONTAINS;case"IN":return iu.IN;case"ARRAY_CONTAINS_ANY":return iu.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return qr("Unspecified operator");default:return qr("Unknown operator")}},Sa.prototype.Fr=function(t){return{fieldPath:t.nt()}},Sa.prototype.Vr=function(t){return Vi.ot(t.fieldPath)},Sa.prototype.Cr=function(t){return{field:this.Fr(t.field),direction:this.Pr(t.dir)}},Sa.prototype.Ar=function(t){return new pu(this.Vr(t.field),this.kr(t.direction))},Sa.prototype.Rr=function(t){return ou.create(this.Vr(t.fieldFilter.field),this.Or(t.fieldFilter.op),this.Me(t.fieldFilter.value))},Sa.prototype.Dr=function(t){if(t.op===iu.EQUAL){if(t.value.isEqual(vs.Tn))return{unaryFilter:{field:this.Fr(t.field),op:"IS_NAN"}};if(t.value.isEqual(Mo.yn))return{unaryFilter:{field:this.Fr(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.Fr(t.field),op:this.Nr(t.op),value:this.Le(t.value)}}},Sa.prototype.Sr=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.Vr(t.unaryFilter.field);return ou.create(e,iu.EQUAL,vs.Tn);case"IS_NULL":var n=this.Vr(t.unaryFilter.field);return ou.create(n,iu.EQUAL,Mo.yn);case"OPERATOR_UNSPECIFIED":return qr("Unspecified filter");default:return qr("Unknown filter")}},Sa.prototype.er=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.nt())}),{fieldPaths:e}},Sa.prototype.hr=function(t){var e=(t.fieldPaths||[]).map(function(t){return Vi.ot(t)});return So.Yt(e)},Sa),Na=(Aa.Ur=function(t){Aa.platform&&qr("Platform already defined"),Aa.platform=t},Aa.t=function(){return Aa.platform||qr("Platform not set"),Aa.platform},Aa);function Aa(){}function Sa(t,e){this.s=t,this.options=e}function Da(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Xr(Jr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function ka(){if("undefined"==typeof Uint8Array)throw new Xr(Jr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Oa(){if(!Na.t().xr)throw new Xr(Jr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Ra(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Ca=(Fa.fromBase64String=function(t){vi("Blob.fromBase64String",arguments,1),gi("Blob.fromBase64String","string",1,t),Oa();try{return new Fa(Na.t().atob(t))}catch(t){throw new Xr(Jr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Fa.fromUint8Array=function(t){if(vi("Blob.fromUint8Array",arguments,1),ka(),!(t instanceof Uint8Array))throw ki("Blob.fromUint8Array","Uint8Array",1,t);return new Fa(Ru(t))},Fa.prototype.toBase64=function(){return vi("Blob.toBase64",arguments,0),Oa(),Na.t().btoa(this.ci)},Fa.prototype.toUint8Array=function(){return vi("Blob.toUint8Array",arguments,0),ka(),Cu(this.ci)},Fa.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Fa.prototype.isEqual=function(t){return this.ci===t.ci},Fa.prototype.Dn=function(){return 2*this.ci.length},Fa.prototype.U=function(t){return jr(this.ci,t.ci)},Fa),xa=Da(Ca,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),La=(qa.prototype.Lr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},qa.prototype.next=function(){var t=++this.previousValue;return this.qr&&this.qr(t),t},qa.Mr=-1,qa),Pa=(Ma.Hr=function(t,e,n,r,i){var o=new Ma(t,e,Date.now()+n,r,i);return o.start(n),o},Ma.prototype.start=function(t){var e=this;this.Jr=setTimeout(function(){return e.Yr()},t)},Ma.prototype.Xr=function(){return this.Yr()},Ma.prototype.cancel=function(t){null!==this.Jr&&(this.clearTimeout(),this.Kr.reject(new Xr(Jr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ma.prototype.Yr=function(){var e=this;this.Qr.$r(function(){return null!==e.Jr?(e.clearTimeout(),e.op().then(function(t){return e.Kr.resolve(t)})):Promise.resolve()})},Ma.prototype.clearTimeout=function(){null!==this.Jr&&(this.zr(this),clearTimeout(this.Jr),this.Jr=null)},Ma),_a=(Object.defineProperty(Ua.prototype,"uu",{get:function(){return this.tu},enumerable:!0,configurable:!0}),Ua.prototype.$r=function(t){this.enqueue(t)},Ua.prototype.su=function(t){this.ou(),this.hu(t)},Ua.prototype.cu=function(t){return this.ou(),this.hu(t)},Ua.prototype.au=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ou(),this.tu?[3,2]:(this.tu=!0,[4,this.cu(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ua.prototype.enqueue=function(t){return this.ou(),this.tu?new Promise(function(t){}):this.hu(t)},Ua.prototype.hu=function(t){var n=this,e=this.Zr.then(function(){return n.eu=!0,t().catch(function(t){n.iu=t,n.eu=!1;var e=t.stack||t.message||"";throw Ur("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.eu=!1,t})});return this.Zr=e},Ua.prototype.fu=function(t,e,n){var r=this;this.ou(),Fr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.ru.indexOf(t)&&(e=0);var i=Pa.Hr(this,t,e,n,function(t){return r.lu(t)});return this.nu.push(i),i},Ua.prototype.ou=function(){this.iu&&qr("AsyncQueue is already failed: "+(this.iu.stack||this.iu.message))},Ua.prototype.du=function(){Fr(this.eu,"verifyOpInProgress() called when no op in progress on this queue.")},Ua.prototype.vu=function(){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Zr];case 1:t.sent(),t.label=2;case 2:if(e!==this.Zr)return[3,0];t.label=3;case 3:return[2]}})})},Ua.prototype.wu=function(t){for(var e=0,n=this.nu;e<n.length;e++)if(n[e].Gr===t)return!0;return!1},Ua.prototype.mu=function(r){var i=this;return this.vu().then(function(){Fr("all"===r||i.wu(r),"Attempted to drain to missing operation "+r),i.nu.sort(function(t,e){return t.Wr-e.Wr});for(var t=0,e=i.nu;t<e.length;t++){var n=e[t];if(n.Xr(),"all"!==r&&n.Gr===r)break}return i.vu()})},Ua.prototype.pu=function(t){this.ru.push(t)},Ua.prototype.lu=function(t){var e=this.nu.indexOf(t);Fr(0<=e,"Delayed operation not found."),this.nu.splice(e,1)},Ua);function Ua(){this.Zr=Promise.resolve(),this.tu=!1,this.nu=[],this.iu=null,this.eu=!1,this.ru=[]}function Ma(t,e,n,r,i){this.Qr=t,this.Gr=e,this.Wr=n,this.op=r,this.zr=i,this.Kr=new Ra,this.then=this.Kr.promise.then.bind(this.Kr.promise),this.catch=this.Kr.promise.catch.bind(this.Kr.promise),this.Kr.promise.catch(function(t){})}function qa(t,e){var n=this;this.previousValue=t,e&&(e.jr=function(t){return n.Lr(t)},this.qr=function(t){return e.Br(t)})}function Fa(t){Oa(),this.ci=t}function Va(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=ja(e)),e=Ga(t.get(n),e);return ja(e)}function Ga(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function ja(t){return t+""}function Ba(t){var e=t.length;if(Fr(2<=e,"Invalid path "+t),2===e)return Fr(""===t.charAt(0)&&""===t.charAt(1),"Non-empty path "+t+" had length 2"),qi.et;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&qr('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:qr('Invalid encoded resource path: "'+t+'"')}o=s+2}return new qi(r)}var za=(dh.prototype.Wt=function(t,e,n){e&&Fr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.gu;Fr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Wt(e,s)}}return e},dh.prototype.Gt=function(t,e){e&&Fr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(u=r[n]).key.isEqual(t)&&(e=u.Gt(e,e,this.En));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var u;(u=s[o]).key.isEqual(t)&&(e=u.Gt(e,i,this.En))}return e},dh.prototype.bu=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Gt(t.key,n.get(t.key));e&&(i=i.lt(t.key,e))}),i},dh.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Yu())},dh.prototype.isEqual=function(t){return this.batchId===t.batchId&&Br(this.mutations,t.mutations)&&Br(this.baseMutations,t.baseMutations)},dh),Ha=(ph.from=function(t,e,n,r){Fr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=Wu(),o=t.mutations,s=0;s<o.length;s++)i=i.lt(o[s].key,n[s].version);return new ph(t,e,n,r,i)},ph),Wa=(lh.prototype.J=function(){return this.Iu.J()},lh.prototype.Du=function(t,e){var n=new Qa(t,e);this.Iu=this.Iu.add(n),this.Tu=this.Tu.add(n)},lh.prototype.Su=function(t,e){var n=this;t.forEach(function(t){return n.Du(t,e)})},lh.prototype.Ru=function(t,e){this.Cu(new Qa(t,e))},lh.prototype.Au=function(t,e){var n=this;t.forEach(function(t){return n.Ru(t,e)})},lh.prototype.Pu=function(t){var e=this,n=Gi.EMPTY,r=new Qa(n,t),i=new Qa(n,t+1),o=[];return this.Tu.Lt([r,i],function(t){e.Cu(t),o.push(t.key)}),o},lh.prototype.ku=function(){var e=this;this.Iu.forEach(function(t){return e.Cu(t)})},lh.prototype.Cu=function(t){this.Iu=this.Iu.delete(t),this.Tu=this.Tu.delete(t)},lh.prototype.Nu=function(t){var e=Gi.EMPTY,n=new Qa(e,t),r=new Qa(e,t+1),i=Yu();return this.Tu.Lt([n,r],function(t){i=i.add(t.key)}),i},lh.prototype.Ou=function(t){var e=new Qa(t,0),n=this.Iu.Bt(e);return null!==n&&t.isEqual(n.key)},lh),Qa=(fh.Sn=function(t,e){return Gi.G(t.key,e.key)||jr(t.Fu,e.Fu)},fh.Eu=function(t,e){return jr(t.Fu,e.Fu)||Gi.G(t.key,e.key)},fh),Ya=(ch.prototype.get=function(t){var e=this.Vu(t),n=this.Uu[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},ch.prototype.has=function(t){return void 0!==this.get(t)},ch.prototype.set=function(t,e){var n=this.Vu(t),r=this.Uu[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Uu[n]=[[t,e]]},ch.prototype.delete=function(t){var e=this.Vu(t),n=this.Uu[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Uu[e]:n.splice(r,1),!0;return!1},ch.prototype.forEach=function(u){li(this.Uu,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},ch.prototype.J=function(){return pi(this.Uu)},ch),Ka=(hh.prototype.catch=function(t){return this.next(void 0,t)},hh.prototype.next=function(r,i){var o=this;return this.qu&&qr("Called next() or catch() twice for PersistencePromise"),this.qu=!0,this.Lu?this.error?this.Bu(i,this.error):this.Mu(r,this.result):new hh(function(e,n){o.xu=function(t){o.Mu(r,t).next(e,n)},o.ju=function(t){o.Bu(i,t).next(e,n)}})},hh.prototype.Qu=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},hh.prototype.Gu=function(t){try{var e=t();return e instanceof hh?e:hh.resolve(e)}catch(t){return hh.reject(t)}},hh.prototype.Mu=function(t,e){return t?this.Gu(function(){return t(e)}):hh.resolve(e)},hh.prototype.Bu=function(t,e){return t?this.Gu(function(){return t(e)}):hh.reject(e)},hh.resolve=function(n){return new hh(function(t,e){t(n)})},hh.reject=function(n){return new hh(function(t,e){e(n)})},hh.Wu=function(t){return new hh(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},hh.zu=function(t){for(var n=hh.resolve(!1),e=function(e){n=n.next(function(t){return t?hh.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},hh.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Wu(i)},hh),Ja=(Object.defineProperty(ah.prototype,"readTime",{get:function(){return Fr(void 0!==this.Ju,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.Ju},set:function(t){Fr(void 0===this.Ju||this.Ju.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.Ju=t},enumerable:!0,configurable:!0}),ah.prototype.Yu=function(t,e){this.Xu(),this.readTime=e,this.Ku.set(t.key,t)},ah.prototype.$u=function(t,e){this.Xu(),e&&(this.readTime=e),this.Ku.set(t,null)},ah.prototype.Zu=function(t,e){this.Xu();var n=this.Ku.get(e);return void 0!==n?Ka.resolve(n):this.ts(t,e)},ah.prototype.getEntries=function(t,e){return this.ns(t,e)},ah.prototype.apply=function(t){return this.Xu(),this.Hu=!0,this.es(t)},ah.prototype.Xu=function(){Fr(!this.Hu,"Changes have already been applied.")},ah),Xa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$a=(uh.prototype.us=function(t){this.rs.push(t)},uh.prototype.ss=function(){this.rs.forEach(function(t){return t()})},uh),Za=(sh.hs=function(o,t,s){return Fr(sh.cs(),"IndexedDB not supported in current environment."),_r("SimpleDb","Opening database:",o),new Ka(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new sh(e))},i.onblocked=function(){r(new Xr(Jr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Xr(Jr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){_r("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,sc).next(function(){_r("SimpleDb","Database upgrade to version "+sc+" complete")})}}).Qu()},sh.delete=function(t){return _r("SimpleDb","Removing database:",t),vh(window.indexedDB.deleteDatabase(t)).Qu()},sh.cs=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(sh.as())return!0;if(void 0===window.navigator)return!1;var t=l(),e=sh.os(t),n=0<e&&e<10,r=sh.fs(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},sh.as=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.ls)},sh.ds=function(t,e){return t.store(e)},sh.os=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},sh.fs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},sh.prototype.vs=function(e){this.db.onversionchange=function(t){return e(t)}},sh.prototype.runTransaction=function(r,h,c){return p(this,void 0,void 0,function(){var o,s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),s=r.endsWith("idempotent"),u=0,e=function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:++u,e=eh.open(a.db,o?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=c(e).catch(function(t){return e.abort(t),Ka.reject(t)}).Qu()).catch(function(){}),[4,e.ws];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=s&&"FirebaseError"!==r.name&&u<3,_r("SimpleDb","Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},sh.prototype.close=function(){this.db.close()},sh),th=(Object.defineProperty(oh.prototype,"Lu",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"bs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"cursor",{set:function(t){this.ms=t},enumerable:!0,configurable:!0}),oh.prototype.done=function(){this.ps=!0},oh.prototype.ys=function(t){this.gs=t},oh.prototype.delete=function(){return vh(this.ms.delete())},oh),eh=(ih.open=function(t,e,n){return new ih(t.transaction(n,e))},Object.defineProperty(ih.prototype,"ws",{get:function(){return this._s.promise},enumerable:!0,configurable:!0}),ih.prototype.abort=function(t){t&&this._s.reject(t),this.aborted||(_r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},ih.prototype.store=function(t){var e=this.transaction.objectStore(t);return Fr(!!e,"Object store not part of transaction: "+t),new nh(e)},ih),nh=(rh.prototype.put=function(t,e){return vh(void 0!==e?(_r("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(_r("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},rh.prototype.add=function(t){return _r("SimpleDb","ADD",this.store.name,t,t),vh(this.store.add(t))},rh.prototype.get=function(e){var n=this;return vh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),_r("SimpleDb","GET",n.store.name,e,t),t})},rh.prototype.delete=function(t){return _r("SimpleDb","DELETE",this.store.name,t),vh(this.store.delete(t))},rh.prototype.count=function(){return _r("SimpleDb","COUNT",this.store.name),vh(this.store.count())},rh.prototype.Is=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ts(n,function(t,e){r.push(e)}).next(function(){return r})},rh.prototype.Es=function(t,e){_r("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ds=!1;var r=this.cursor(n);return this.Ts(r,function(t,e,n){return n.delete()})},rh.prototype.Ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ts(r,e)},rh.prototype.Rs=function(i){var t=this.cursor({});return new Ka(function(n,r){t.onerror=function(t){var e=mh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},rh.prototype.Ts=function(t,s){var u=[];return new Ka(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new th(e),r=s(e.primaryKey,e.value,n);if(r instanceof Ka){var i=r.catch(function(t){return n.done(),Ka.reject(t)});u.push(i)}n.Lu?o():null===n.bs?e.continue():e.continue(n.bs)}else o()}}).next(function(){return Ka.Wu(u)})},rh.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Fr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},rh.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ds?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},rh);function rh(t){this.store=t}function ih(t){var n=this;this.transaction=t,this.aborted=!1,this._s=new Ra,this.transaction.oncomplete=function(){n._s.resolve()},this.transaction.onabort=function(){t.error?n._s.reject(t.error):n._s.resolve()},this.transaction.onerror=function(t){var e=mh(t.target.error);n._s.reject(e)}}function oh(t){this.ms=t,this.ps=!1,this.gs=null}function sh(t){this.db=t,12.2===sh.os(l())&&Ur("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function uh(){this.rs=[]}function ah(){this.Ku=new Ya(function(t){return t.toString()}),this.Hu=!1}function hh(t){var e=this;this.xu=null,this.ju=null,this.result=void 0,this.error=void 0,this.Lu=!1,this.qu=!1,t(function(t){e.Lu=!0,e.result=t,e.xu&&e.xu(t)},function(t){e.Lu=!0,e.error=t,e.ju&&e.ju(t)})}function ch(t){this.Vu=t,this.Uu={}}function fh(t,e){this.key=t,this.Fu=e}function lh(){this.Iu=new ro(Qa.Sn),this.Tu=new ro(Qa.Eu)}function ph(t,e,n,r,i){this.batch=t,this.yu=e,this.gu=n,this.streamToken=r,this._u=i}function dh(t,e,n,r){this.batchId=t,this.En=e,this.baseMutations=n,Fr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function vh(t){return new Ka(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=mh(t.target.error);r(e)}})}var yh=!1;function mh(t){var e=Za.os(l());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Xr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return yh||(yh=!0,setTimeout(function(){throw r},0)),r}}return t}var gh=(wh.ks=function(t,e,n,r){return Fr(""!==t.uid,"UserID must not be an empty string."),new wh(t.l()?t.uid:"",e,n,r)},wh.prototype.Ns=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ih(t).Ss({index:vc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},wh.prototype.Os=function(e,t,n){return this.Fs(e).next(function(t){return t.lastStreamToken=n.toBase64(),Nh(e).put(t)})},wh.prototype.Vs=function(t){return this.Fs(t).next(function(t){return yu.fromBase64String(t.lastStreamToken)})},wh.prototype.Us=function(e,n){return this.Fs(e).next(function(t){return t.lastStreamToken=n.toBase64(),Nh(e).put(t)})},wh.prototype.xs=function(h,c,f,l){var p=this,d=Th(h),v=Ih(h);return v.add({}).next(function(t){Fr("number"==typeof t,"Auto-generated key is not a number");for(var e=new za(t,c,f,l),n=p.serializer.js(p.userId,e),r=[],i=new ro(function(t,e){return jr(t.nt(),e.nt())}),o=0,s=l;o<s.length;o++){var u=s[o],a=gc.key(p.userId,u.key.path,t);i=i.add(u.key.path.H()),r.push(v.put(n)),r.push(d.put(a,gc.PLACEHOLDER))}return i.forEach(function(t){r.push(p.Cs.Ls(h,t))}),h.us(function(){p.Ps[t]=e.keys()}),Ka.Wu(r).next(function(){return e})})},wh.prototype.qs=function(t,e){var n=this;return Ih(t).get(e).next(function(t){return t?(Fr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.Bs(t)):null})},wh.prototype.Ms=function(t,n){var r=this;return this.Ps[n]?Ka.resolve(this.Ps[n]):this.qs(t,n).next(function(t){if(t){var e=t.keys();return r.Ps[n]=e}return null})},wh.prototype.Qs=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Ih(t).Ss({index:vc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Fr(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.Bs(e)),n.done()}).next(function(){return o})},wh.prototype.Gs=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ih(t).Ss({index:vc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},wh.prototype.Ws=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ih(t).Is(vc.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Bs(t)})})},wh.prototype.zs=function(u,a){var h=this,t=gc.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return Th(u).Ss({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=Ba(i);if(r===h.userId&&a.path.isEqual(s))return Ih(u).get(o).next(function(t){if(!t)throw qr("Dangling document-mutation reference found: "+e+" which points to "+o);Fr(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.Bs(t))});n.done()}).next(function(){return c})},wh.prototype.Ks=function(r,t){var a=this,h=new ro(jr),i=[];return t.forEach(function(u){var t=gc.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Th(r).Ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ba(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),Ka.Wu(i).next(function(){return a.Hs(r,h)})},wh.prototype.Js=function(t,e){var u=this;Fr(!e.Nn(),"Document queries shouldn't go down this path"),Fr(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=e.path,h=a.length+1,n=gc.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new ro(jr);return Th(t).Ss({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ba(i);r===u.userId&&a.$(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.Hs(t,c)})},wh.prototype.Hs=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Ih(t).get(e).next(function(t){if(null===t)throw qr("Dangling document-mutation reference found, which points to "+e);Fr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.Bs(t))}))}),Ka.Wu(i).next(function(){return r})},wh.prototype.Ys=function(e,n){var r=this;return Eh(e.Xs,this.userId,n).next(function(t){return e.us(function(){r.$s(n.batchId)}),Ka.forEach(t,function(t){return r.As.Zs(e,t)})})},wh.prototype.$s=function(t){delete this.Ps[t]},wh.prototype.to=function(n){var o=this;return this.Ns(n).next(function(t){if(!t)return Ka.resolve();var e=IDBKeyRange.lowerBound(gc.prefixForUser(o.userId)),i=[];return Th(n).Ss({range:e},function(t,e,n){if(t[0]===o.userId){var r=Ba(t[1]);i.push(r)}else n.done()}).next(function(){Fr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.nt()}))})})},wh.prototype.Ou=function(t,e){return bh(t,this.userId,e)},wh.prototype.Fs=function(t){var e=this;return Nh(t).get(this.userId).next(function(t){return t||new dc(e.userId,-1,"")})},wh);function wh(t,e,n,r){this.userId=t,this.serializer=e,this.Cs=n,this.As=r,this.Ps={}}function bh(t,o,e){var n=gc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Th(t).Ss({range:r,Ds:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Eh(t,e,n){var r=t.store(vc.store),i=t.store(gc.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Ss({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Fr(1===u,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=gc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return Ka.Wu(o).next(function(){return h})}function Ih(t){return Wc.ds(t,vc.store)}function Th(t){return Wc.ds(t,gc.store)}function Nh(t){return Wc.ds(t,dc.store)}var Ah=(xh.prototype.next=function(){var t=this.eo;return this.eo+=2,t},xh.prototype.after=function(t){return this.io(t+2),this.next()},xh.prototype.io=function(t){Fr((1&t)===this.no,"Cannot supply target ID from different generator ID"),this.eo=t},xh.ro=function(){return new xh(0,2)},xh.uo=function(){return new xh(1)},xh),Sh=(Ch.prototype.ho=function(e,n){var r=this;return this.oo.zs(e,n).next(function(t){return r.co(e,n,t)})},Ch.prototype.co=function(t,r,i){return this.so.Zu(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Gt(r,t);return t})},Ch.prototype.ao=function(t,e,i){var o=ju();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Gt(t,e);o=o.lt(t,e)}),o},Ch.prototype.fo=function(e,t){var n=this;return this.so.getEntries(e,t).next(function(t){return n.lo(e,t)})},Ch.prototype.lo=function(r,i){var o=this;return this.oo.Ks(r,i).next(function(t){var e=o.ao(r,i,t),n=Gu();return e.forEach(function(t,e){e=e||new Ds(t,Ui.q()),n=n.lt(t,e)}),n})},Ch.prototype.do=function(t,e,n){return e.Nn()?this.vo(t,e.path):e.ui()?this.wo(t,e,n):this.mo(t,e,n)},Ch.prototype.vo=function(t,e){return this.ho(t,new Gi(e)).next(function(t){var e=zu();return t instanceof Ss&&(e=e.lt(t.key,t)),e})},Ch.prototype.wo=function(n,r,i){var o=this;Fr(r.path.J(),"Currently we only support collection group queries at the root.");var s=r.collectionGroup,u=zu();return this.Cs.po(n,s).next(function(t){return Ka.forEach(t,function(t){var e=r.Hn(t.child(s));return o.mo(n,e,i).next(function(t){t.forEach(function(t,e){u=u.lt(t,e)})})}).next(function(){return u})})},Ch.prototype.mo=function(e,n,t){var c,f,r=this;return this.so.do(e,n,t).next(function(t){return c=t,r.oo.Js(e,n)}).next(function(t){return f=t,r.bo(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.Gt(a,a,r.En);c=h instanceof Ss?c.lt(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},Ch.prototype.bo=function(t,e,n){for(var r=Yu(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Co&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.so.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ss&&(h=h.lt(t,e))}),h})},Ch),Dh=(Rh.Io=function(t,e){for(var n=Yu(),r=Yu(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Rh(t,e.fromCache,n,r)},Rh),kh=(Oh.prototype.start=function(){return this.jo()},Oh.prototype.Lo=function(i){return p(this,void 0,void 0,function(){var e,y,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.oo,y=this.Vo,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var v;return r.oo.Ws(d).next(function(t){return v=t,e=r.persistence.Po(i),y=new Sh(r.ko,e,r.persistence.Uo()),e.Ws(d)}).next(function(t){for(var e=[],n=[],r=Yu(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++){var h=a[u];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){s=f[c],n.push(s.batchId);for(var l=0,p=s.mutations;l<p.length;l++)h=p[l],r=r.add(h.key)}return y.fo(d,r).next(function(t){return{qo:t,Bo:e,Mo:n}})})})];case 1:return n=t.sent(),this.oo=e,this.Vo=y,this.To.xo(this.Vo),[2,n]}})})},Oh.prototype.Qo=function(u){var a,h=this,c=_i.now(),t=u.reduce(function(t,e){return t.add(e.key)},Yu());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(s){return h.Vo.fo(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.rn(a.get(i.key));null!=o&&e.push(new Co(i.key,o,o.un(),ko.exists(!0)))}return h.oo.xs(s,c,e,u)})}).then(function(t){var e=t.bu(a);return{batchId:t.batchId,Ku:e}})},Oh.prototype.Go=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.oo.Ms(e,t).next(function(t){return t?n.Vo.fo(e,t):Ka.resolve(null)})})},Oh.prototype.Os=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.ko.Wo({zo:!0});return i.oo.Os(t,r.batch,r.streamToken).next(function(){return i.Ko(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.oo.to(t)}).next(function(){return i.Vo.fo(t,e)})})},Oh.prototype.Ho=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.oo.qs(e,t).next(function(t){return Fr(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.oo.Ys(e,t)}).next(function(){return r.oo.to(e)}).next(function(){return r.Vo.fo(e,n)})})},Oh.prototype.Gs=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.oo.Gs(t)})},Oh.prototype.Vs=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.oo.Vs(t)})},Oh.prototype.Us=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.oo.Us(t,e)})},Oh.prototype.Jo=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.Oo.Jo(t)})},Oh.prototype.Yo=function(a){var h=this,c=a.li,f=this.Do;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=h.ko.Wo({zo:!0});f=h.Do;var s=[];fi(a.Si,function(t,e){var n=f.get(t);if(n){s.push(h.Oo.Xo(o,e.Vi,t).next(function(){return h.Oo.$o(o,e.Oi,t)}));var r=e.resumeToken;if(0<r.bn()){var i=n.vi(r,c).di(o.Zo);f=f.lt(t,i),Oh.th(n,i,e)&&s.push(h.Oo.nh(o,i))}}});var u=Gu(),n=Yu();if(a.Ci.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.Ci.forEach(function(t,e){var n=r.get(t);e instanceof Ds&&e.version.isEqual(Ui.MIN)?(i.$u(t,c),u=u.lt(t,e)):null==n||0<e.version.h(n.version)||0===e.version.h(n.version)&&n.hasPendingWrites?(Fr(!Ui.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),i.Yu(e,c),u=u.lt(t,e)):_r("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Ai.has(t)&&s.push(h.persistence.As.ih(o,t))})})),!c.isEqual(Ui.MIN)){var t=h.Oo.Jo(o).next(function(t){return Fr(0<=c.h(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h.Oo.eh(o,o.Zo,c)});s.push(t)}return Ka.Wu(s).next(function(){return i.apply(o)}).next(function(){return h.Vo.lo(o,u)})}).then(function(t){return h.Do=f,t})},Oh.th=function(t,e,n){return Fr(0<e.resumeToken.bn(),"Attempted to persist target data with no resume token"),0===t.resumeToken.bn()||e.li.B()-t.li.B()>=this.rh||0<n.Oi.size+n.Fi.size+n.Vi.size},Oh.prototype.uh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.Eo.Su(i.yo,o),this.Eo.Au(i._o,o),!i.fromCache){var s=this.Do.get(o);Fr(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var u=s.li,a=s.wi(u);this.Do=this.Do.lt(o,a)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Ka.forEach(t,function(t){return Ka.forEach(t._o,function(t){return n.persistence.As.Ru(e,t)})})})},Oh.prototype.sh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.oo.Qs(t,e)})},Oh.prototype.oh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.Vo.ho(t,e)})},Oh.prototype.hh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.Oo.ah(e,r).next(function(t){return t?(n=t,Ka.resolve(n)):i.Oo.fh(e).next(function(t){return n=new Pu(r,t,0,e.Zo),i.Oo.lh(e,n).next(function(){return n})})})}).then(function(t){return null===i.Do.get(t.targetId)&&(i.Do=i.Do.lt(t.targetId,t),i.So.set(r,t.targetId)),t})},Oh.prototype.ah=function(t,e){var n=this.So.get(e);return void 0!==n?Ka.resolve(this.Do.get(n)):this.Oo.ah(t,e)},Oh.prototype.dh=function(n,r){var i=this,o=this.Do.get(n);Fr(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.Eo.Pu(n);return r?Ka.resolve():Ka.forEach(t,function(t){return i.persistence.As.Ru(e,t)}).next(function(){i.persistence.As.removeTarget(e,o)})}).then(function(){i.Do=i.Do.remove(n),i.So.delete(o.target)})},Oh.prototype.vh=function(t,n){var r=this,i=Ui.MIN,o=Yu();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.ah(e,t.Yn()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Oo.wh(e,t.targetId).next(function(t){o=t})}).next(function(){return r.To.do(e,t,n?i:Ui.MIN,n?o:Yu())}).next(function(t){return{documents:t,mh:o}})})},Oh.prototype.ph=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.Oo.wh(t,e)})},Oh.prototype.gh=function(){return this.persistence.gh()},Oh.prototype.bh=function(t){this.oo.$s(t)},Oh.prototype.yh=function(t){this.persistence.yh(t)},Oh.prototype.Ko=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=Ka.resolve();return n.forEach(function(r){u=u.next(function(){return o.Zu(t,r)}).next(function(t){var e=t,n=i._u.get(r);Fr(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.h(n)<0)&&((e=s.Wt(r,e,i))?o.Yu(e,i.yu):Fr(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),u.next(function(){return e.oo.Ys(t,s)})},Oh.prototype._h=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.Ih(t,n.Do)})},Oh.prototype.Th=function(e){var n=this,t=this.Do.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.Oo.ye(t,e).next(function(t){return t?t.target:null})})},Oh.prototype.Eh=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.ko.Eh(t,r.Ro)}).then(function(t){var e=t.Dh,n=t.readTime;return r.Ro=n,e})},Oh.prototype.jo=function(){return p(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.ko.Sh(t)})];case 1:return e.Ro=t.sent(),[2]}})})},Oh.rh=3e8,Oh);function Oh(t,e,n){this.persistence=t,this.To=e,this.Eo=new Wa,this.Do=new ji(jr),this.So=new Ya(function(t){return t.canonicalId()}),this.Ro=Ui.MIN,Fr(t.Co,"LocalStore was passed an unstarted persistence implementation"),this.persistence.As.Ao(this.Eo),this.oo=t.Po(n),this.ko=t.No(),this.Oo=t.Fo(),this.Vo=new Sh(this.ko,this.oo,this.persistence.Uo()),this.To.xo(this.Vo)}function Rh(t,e,n,r){this.targetId=t,this.fromCache=e,this.yo=n,this._o=r}function Ch(t,e,n){this.so=t,this.oo=e,this.Cs=n}function xh(t,e){Fr((1&(this.no=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.io(void 0!==e?e:this.no)}function Lh(e){return p(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Jr.FAILED_PRECONDITION||e.message!==Xa)throw e;return _r("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ph(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=jr(n,i);return 0===s?jr(r,o):s}var _h=(Hh.prototype.Ah=function(){return++this.Ch},Hh.prototype.Ph=function(t){var e=[t,this.Ah()];if(this.buffer.size<this.Rh)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ph(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Hh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Hh),Uh={kh:!1,Nh:0,Oh:0,Fh:0},Mh=(zh.jh=function(t){return new zh(t,zh.Lh,zh.qh)},zh.Bh=-1,zh.Mh=1048576,zh.Gh=new zh(zh.Qh=41943040,zh.Lh=10,zh.qh=1e3),zh.DISABLED=new zh(zh.Bh,0,0),zh),qh=(Bh.prototype.start=function(){Fr(null===this.Hh,"Cannot start an already started LruScheduler"),this.Wh.params.Vh!==Mh.Bh&&this.Jh()},Bh.prototype.stop=function(){this.Hh&&(this.Hh.cancel(),this.Hh=null)},Object.defineProperty(Bh.prototype,"Co",{get:function(){return null!==this.Hh},enumerable:!0,configurable:!0}),Bh.prototype.Jh=function(){var t=this;Fr(null===this.Hh,"Cannot schedule GC while a task is pending");var e=this.Kh?3e5:6e4;_r("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Hh=this.Qr.fu("lru_garbage_collection",e,function(){return t.Hh=null,t.Kh=!0,t.zh._h(t.Wh).then(function(){return t.Jh()}).catch(Lh)})},Bh),Fh=(jh.prototype.Xh=function(t,e){return this.Yh.$h(t).next(function(t){return Math.floor(e/100*t)})},jh.prototype.Zh=function(t,e){var n=this;if(0===e)return Ka.resolve(La.Mr);var r=new _h(e);return this.Yh.ce(t,function(t){return r.Ph(t.sequenceNumber)}).next(function(){return n.Yh.tc(t,function(t){return r.Ph(t)})}).next(function(){return r.maxValue})},jh.prototype.nc=function(t,e,n){return this.Yh.nc(t,e,n)},jh.prototype.ic=function(t,e){return this.Yh.ic(t,e)},jh.prototype.Ih=function(e,n){var r=this;return this.params.Vh===Mh.Bh?(_r("LruGarbageCollector","Garbage collection skipped; disabled"),Ka.resolve(Uh)):this.ec(e).next(function(t){return t<r.params.Vh?(_r("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Vh),Uh):r.rc(e,n)})},jh.prototype.ec=function(t){return this.Yh.ec(t)},jh.prototype.rc=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Xh(e,this.params.Uh).next(function(t){return i=t>c.params.xh?(_r("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.xh+" from "+t),c.params.xh):t,s=Date.now(),c.Zh(e,i)}).next(function(t){return r=t,u=Date.now(),c.nc(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.ic(e,r)}).next(function(t){return h=Date.now(),Lr()<=0&&_r("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),Ka.resolve({kh:!0,Nh:i,Oh:o,Fh:t})})},jh),Vh=(Gh.prototype.fh=function(e){var n=this;return this.sc(e).next(function(t){return t.highestTargetId=n.uc.after(t.highestTargetId),n.oc(e,t).next(function(){return t.highestTargetId})})},Gh.prototype.Jo=function(t){return this.sc(t).next(function(t){return Ui.L(new _i(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Gh.prototype.hc=function(t){return Yh(t.Xs)},Gh.prototype.eh=function(e,n,r){var i=this;return this.sc(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.M()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.oc(e,t)})},Gh.prototype.lh=function(e,n){var r=this;return this.cc(e,n).next(function(){return r.sc(e).next(function(t){return t.targetCount+=1,r.ac(n,t),r.oc(e,t)})})},Gh.prototype.nh=function(t,e){return this.cc(t,e)},Gh.prototype.fc=function(e,t){var n=this;return this.lc(e,t.targetId).next(function(){return Wh(e).delete(t.targetId)}).next(function(){return n.sc(e)}).next(function(t){return Fr(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.oc(e,t)})},Gh.prototype.nc=function(r,i,o){var s=this,u=0,a=[];return Wh(r).Ss(function(t,e){var n=s.serializer.dc(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.fc(r,n)))}).next(function(){return Ka.Wu(a)}).next(function(){return u})},Gh.prototype.ce=function(t,r){var i=this;return Wh(t).Ss(function(t,e){var n=i.serializer.dc(e);r(n)})},Gh.prototype.sc=function(t){return Qh(t.Xs)},Gh.prototype.oc=function(t,e){return(n=t,Wc.ds(n,kc.store)).put(kc.key,e);var n},Gh.prototype.cc=function(t,e){return Wh(t).put(this.serializer.vc(e))},Gh.prototype.ac=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Gh.prototype.wc=function(t){return this.sc(t).next(function(t){return t.targetCount})},Gh.prototype.ah=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Wh(t).Ss({range:n,index:Sc.queryTargetsIndexName},function(t,e,n){var r=o.serializer.dc(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Gh.prototype.$o=function(n,t,r){var i=this,o=[],s=Kh(n);return t.forEach(function(t){var e=Va(t.path);o.push(s.put(new Dc(r,e))),o.push(i.As.Du(n,t))}),Ka.Wu(o)},Gh.prototype.Xo=function(n,t,r){var i=this,o=Kh(n);return Ka.forEach(t,function(t){var e=Va(t.path);return Ka.Wu([o.delete([r,e]),i.As.Ru(n,t)])})},Gh.prototype.lc=function(t,e){var n=Kh(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Gh.prototype.wh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Kh(t),o=Yu();return r.Ss({range:n,Ds:!0},function(t,e,n){var r=Ba(t[1]),i=new Gi(r);o=o.add(i)}).next(function(){return o})},Gh.prototype.Ou=function(t,e){var n=Va(e.path),r=IDBKeyRange.bound([n],[zr(n)],!1,!0),i=0;return Kh(t).Ss({index:Dc.documentTargetsIndex,Ds:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Gh.prototype.ye=function(t,e){var n=this;return Wh(t).get(e).next(function(t){return t?n.serializer.dc(t):null})},Gh);function Gh(t,e){this.As=t,this.serializer=e,this.uc=Ah.ro()}function jh(t,e){this.Yh=t,this.params=e}function Bh(t,e,n){this.Wh=t,this.Qr=e,this.zh=n,this.Kh=!1,this.Hh=null}function zh(t,e,n){this.Vh=t,this.Uh=e,this.xh=n}function Hh(t){this.Rh=t,this.buffer=new ro(Ph),this.Ch=0}function Wh(t){return Wc.ds(t,Sc.store)}function Qh(t){return Za.ds(t,kc.store).get(kc.key).next(function(t){return Fr(null!==t,"Missing metadata row."),t})}function Yh(t){return Qh(t).next(function(t){return t.highestListenSequenceNumber})}function Kh(t){return Wc.ds(t,Dc.store)}var Jh,Xh=($h.prototype.Yu=function(t,e,n){return ec(t).put(nc(e),n)},$h.prototype.$u=function(t,e){var n=ec(t),r=nc(e);return n.delete(r)},$h.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.mc(e,t)})},$h.prototype.Zu=function(t,e){var n=this;return ec(t).get(nc(e)).next(function(t){return n.pc(t)})},$h.prototype.gc=function(t,e){var n=this;return ec(t).get(nc(e)).next(function(t){var e=n.pc(t);return e?{bc:e,size:rc(t)}:null})},$h.prototype.getEntries=function(t,e){var r=this,i=ju();return this.yc(t,e,function(t,e){var n=r.pc(e);i=i.lt(t,n)}).next(function(){return i})},$h.prototype._c=function(t,e){var r=this,i=ju(),o=new ji(Gi.G);return this.yc(t,e,function(t,e){var n=r.pc(e);o=n?(i=i.lt(t,n),o.lt(t,rc(e))):(i=i.lt(t,null),o.lt(t,0))}).next(function(){return{Ic:i,Tc:o}})},$h.prototype.yc=function(t,e,i){if(e.J())return Ka.resolve();var n=IDBKeyRange.bound(e.first().path.tt(),e.last().path.tt()),o=e.bt(),s=o.Dt();return ec(t).Ss({range:n},function(t,e,n){for(var r=Gi.at(t);s&&Gi.G(s,r)<0;)i(s,null),s=o.Dt();s&&s.isEqual(r)&&(i(s,e),s=o.St()?o.Dt():null),s?n.ys(s.path.tt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.St()?o.Dt():null})},$h.prototype.do=function(t,i,e){var o=this;Fr(!i.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");var s=zu(),u=i.path.length+1,n={};if(e.isEqual(Ui.MIN)){var r=i.path.tt();n.range=IDBKeyRange.lowerBound(r)}else{var a=i.path.tt(),h=this.serializer.Ec(e);n.range=IDBKeyRange.lowerBound([a,h],!0),n.index=Ic.collectionReadTimeIndex}return ec(t).Ss(n,function(t,e,n){if(t.length===u){var r=o.serializer.Dc(e);i.path.$(r.key.path)?r instanceof Ss&&i.matches(r)&&(s=s.lt(r.key,r)):n.done()}}).next(function(){return s})},$h.prototype.Eh=function(t,e){var r=this,i=Gu(),o=this.serializer.Ec(e),n=ec(t),s=IDBKeyRange.lowerBound(o,!0);return n.Ss({index:Ic.readTimeIndex,range:s},function(t,e){var n=r.serializer.Dc(e);i=i.lt(n.key,n),o=e.readTime}).next(function(){return{Dh:i,readTime:r.serializer.Sc(o)}})},$h.prototype.Sh=function(t){var r=this,e=ec(t),i=Ui.MIN;return e.Ss({index:Ic.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.Sc(e.readTime)),n.done()}).next(function(){return i})},$h.prototype.Wo=function(t){return new $h.Rc(this,!!t&&t.zo)},$h.prototype.Cc=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},$h.prototype.getMetadata=function(t){return tc(t).get(Tc.key).next(function(t){return Fr(!!t,"Missing document cache metadata"),t})},$h.prototype.mc=function(t,e){return tc(t).put(Tc.key,e)},$h.prototype.pc=function(t){if(t){var e=this.serializer.Dc(t);return e instanceof Ds&&e.version.isEqual(Ui.q())?null:e}return null},$h.Rc=(t(Zh,Jh=Ja),Zh.prototype.es=function(s){var u=this,a=[],h=0,c=new ro(function(t,e){return jr(t.nt(),e.nt())});return this.Ku.forEach(function(t,e){var n=u.Pc.get(t);if(Fr(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Fr(!u.readTime.isEqual(Ui.MIN),"Cannot add a document with a read time of zero");var r=u.Ac.serializer.kc(e,u.readTime);c=c.add(t.path.H());var i=rc(r);h+=i-n,a.push(u.Ac.Yu(s,t,r))}else if(h-=n,u.zo){var o=u.Ac.serializer.kc(new Ds(t,Ui.q()),u.readTime);a.push(u.Ac.Yu(s,t,o))}else a.push(u.Ac.$u(s,t))}),c.forEach(function(t){a.push(u.Ac.Cs.Ls(s,t))}),a.push(this.Ac.updateMetadata(s,h)),Ka.Wu(a)},Zh.prototype.ts=function(t,e){var n=this;return this.Ac.gc(t,e).next(function(t){return null===t?(n.Pc.set(e,0),null):(n.Pc.set(e,t.size),t.bc)})},Zh.prototype.ns=function(t,e){var n=this;return this.Ac._c(t,e).next(function(t){var e=t.Ic;return t.Tc.forEach(function(t,e){n.Pc.set(t,e)}),e})},Zh),$h);function $h(t,e){this.serializer=t,this.Cs=e}function Zh(t,e){var n=Jh.call(this)||this;return n.Ac=t,n.zo=e,n.Pc=new Ya(function(t){return t.toString()}),n}function tc(t){return Wc.ds(t,Tc.store)}function ec(t){return Wc.ds(t,Ic.store)}function nc(t){return t.path.tt()}function rc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw qr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var ic=(cc.prototype.Ls=function(t,e){return this.Nc.add(e),Ka.resolve()},cc.prototype.po=function(t,e){return Ka.resolve(this.Nc.getEntries(e))},cc),oc=(hc.prototype.add=function(t){Fr(t.length%2==1,"Expected a collection path.");var e=t.X(),n=t.H(),r=this.index[e]||new ro(qi.G),i=!r.has(n);return this.index[e]=r.add(n),i},hc.prototype.has=function(t){var e=t.X(),n=t.H(),r=this.index[e];return r&&r.has(n)},hc.prototype.getEntries=function(t){return(this.index[t]||new ro(qi.G)).tt()},hc),sc=9,uc=(ac.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Fr(t<e&&0<=t&&e<=sc,"Unexpected schema upgrade from v"+t+" to v{toVersion}.");var o,s=new eh(r);t<1&&1<=e&&(n.createObjectStore(lc.store),(o=n).createObjectStore(dc.store,{keyPath:dc.keyPath}),o.createObjectStore(vc.store,{keyPath:vc.keyPath,autoIncrement:!0}).createIndex(vc.userMutationsIndex,vc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(gc.store),Pc(n),n.createObjectStore(Ic.store));var u,a=Ka.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Dc.store),u.deleteObjectStore(Sc.store),u.deleteObjectStore(kc.store),Pc(n)),a=a.next(function(){return t=s.store(kc.store),e=new kc(0,0,Ui.MIN.M(),0),t.put(kc.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(vc.store).Is().next(function(t){r.deleteObjectStore(vc.store),r.createObjectStore(vc.store,{keyPath:vc.keyPath,autoIncrement:!0}).createIndex(vc.userMutationsIndex,vc.userMutationsKeyPath,{unique:!0});var e=i.store(vc.store),n=t.map(function(t){return e.put(t)});return Ka.Wu(n)});var r,i})),a=a.next(function(){n.createObjectStore(_c.store,{keyPath:_c.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Tc.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Ic.store)).createIndex(Ic.readTimeIndex,Ic.readTimeIndexPath,{unique:!1}),t.createIndex(Ic.collectionReadTimeIndex,Ic.collectionReadTimeIndexPath,{unique:!1})})),a},ac.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ic.store).Ss(function(t,e){n+=rc(e)}).next(function(){var t=new Tc(n);return e.store(Tc.store).put(Tc.key,t)})},ac.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(dc.store),e=r.store(vc.store);return t.Is().next(function(t){return Ka.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Is(vc.userMutationsIndex,t).next(function(t){return Ka.forEach(t,function(t){Fr(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.Bs(t);return Eh(r,n.userId,e).next(function(){})})})})})},ac.prototype.ensureSequenceNumbers=function(t){var s=t.store(Dc.store),e=t.store(Ic.store);return Yh(t).next(function(i){var o=[];return e.Ss(function(t,e){var n=new qi(t),r=[0,Va(n)];o.push(s.get(r).next(function(t){return t?Ka.resolve():(e=n,s.put(new Dc(0,Va(e),i)));var e}))}).next(function(){return Ka.Wu(o)})})},ac.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.X(),n=t.H();return r.put({collectionId:e,parent:Va(n)})}}t.createObjectStore(Oc.store,{keyPath:Oc.keyPath});var r=e.store(Oc.store),o=new oc;return e.store(Ic.store).Ss({Ds:!0},function(t,e){var n=new qi(t);return i(n.H())}).next(function(){return e.store(gc.store).Ss({Ds:!0},function(t,e){t[0];var n=t[1],r=(t[2],Ba(n));return i(r.H())})})},ac);function ac(t){this.serializer=t}function hc(){this.index={}}function cc(){this.Nc=new oc}function fc(t,e){this.seconds=t,this.nanoseconds=e}var lc=(pc.store="owner",pc.key="owner",pc);function pc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var dc=(mc.store="mutationQueues",mc.keyPath="userId",mc),vc=(yc.store="mutations",yc.keyPath="batchId",yc.userMutationsIndex="userMutationsIndex",yc.userMutationsKeyPath=["userId","batchId"],yc);function yc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function mc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var gc=(wc.prefixForUser=function(t){return[t]},wc.prefixForPath=function(t,e){return[t,Va(e)]},wc.key=function(t,e,n){return[t,Va(e),n]},wc.store="documentMutations",wc.PLACEHOLDER=new wc,wc);function wc(){}function bc(t,e){this.path=t,this.readTime=e}function Ec(t,e){this.path=t,this.version=e}var Ic=(Ac.store="remoteDocuments",Ac.readTimeIndex="readTimeIndex",Ac.readTimeIndexPath="readTime",Ac.collectionReadTimeIndex="collectionReadTimeIndex",Ac.collectionReadTimeIndexPath=["parentPath","readTime"],Ac),Tc=(Nc.store="remoteDocumentGlobal",Nc.key="remoteDocumentGlobalKey",Nc);function Nc(t){this.byteSize=t}function Ac(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var Sc=(Lc.store="targets",Lc.keyPath="targetId",Lc.queryTargetsIndexName="queryTargetsIndex",Lc.queryTargetsKeyPath=["canonicalId","targetId"],Lc),Dc=(xc.store="targetDocuments",xc.keyPath=["targetId","path"],xc.documentTargetsIndex="documentTargetsIndex",xc.documentTargetsKeyPath=["path","targetId"],xc),kc=(Cc.key="targetGlobalKey",Cc.store="targetGlobal",Cc),Oc=(Rc.store="collectionParents",Rc.keyPath=["collectionId","parent"],Rc);function Rc(t,e){this.collectionId=t,this.parent=e}function Cc(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function xc(t,e,n){this.targetId=t,this.path=e,Fr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function Lc(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function Pc(t){t.createObjectStore(Dc.store,{keyPath:Dc.keyPath}).createIndex(Dc.documentTargetsIndex,Dc.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Sc.store,{keyPath:Sc.keyPath}).createIndex(Sc.queryTargetsIndexName,Sc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(kc.store)}var _c=(Uc.store="clientMetadata",Uc.keyPath="clientId",Uc);function Uc(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var Mc=s(s(s([dc.store,vc.store,gc.store,Ic.store,Sc.store,lc.store,kc.store,Dc.store],[_c.store]),[Tc.store]),[Oc.store]),qc=(Fc.prototype.Ls=function(t,e){var n=this;if(Fr(e.length%2==1,"Expected a collection path."),this.Oc.has(e))return Ka.resolve();var r=e.X(),i=e.H();t.us(function(){n.Oc.add(e)});var o={collectionId:r,parent:Va(i)};return Vc(t).put(o)},Fc.prototype.po=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[zr(i),""],!1,!0);return Vc(t).Is(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ba(r.parent))}return o})},Fc);function Fc(){this.Oc=new oc}function Vc(t){return Wc.ds(t,Oc.store)}var Gc=(jc.prototype.Dc=function(t){if(t.document)return this.Fc.Ke(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Gi.at(t.noDocument.path),n=this.Vc(t.noDocument.readTime);return new Ds(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Gi.at(t.unknownDocument.path),n=this.Vc(t.unknownDocument.version),new ks(e,n)):qr("Unexpected DbRemoteDocument")},jc.prototype.kc=function(t,e){var n=this.Ec(e),r=t.key.path.H().tt();if(t instanceof Ss){var i=t.proto?t.proto:this.Fc.ze(t),o=t.hasCommittedMutations;return new Ic(null,null,i,o,n,r)}if(t instanceof Ds){var s=t.key.path.tt(),u=this.Uc(t.version);return o=t.hasCommittedMutations,new Ic(null,new bc(s,u),null,o,n,r)}if(t instanceof ks){s=t.key.path.tt();var a=this.Uc(t.version);return new Ic(new Ec(s,a),null,null,!0,n,r)}return qr("Unexpected MaybeDocument")},jc.prototype.Ec=function(t){var e=t.M();return[e.seconds,e.nanoseconds]},jc.prototype.Sc=function(t){var e=new _i(t[0],t[1]);return Ui.L(e)},jc.prototype.Uc=function(t){var e=t.M();return new fc(e.seconds,e.nanoseconds)},jc.prototype.Vc=function(t){var e=new _i(t.seconds,t.nanoseconds);return Ui.L(e)},jc.prototype.js=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Fc.ir(t)}),i=e.mutations.map(function(t){return n.Fc.ir(t)});return new vc(t,e.batchId,e.En.toMillis(),r,i)},jc.prototype.Bs=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Fc.sr(t)}),r=t.mutations.map(function(t){return e.Fc.sr(t)}),i=_i.fromMillis(t.localWriteTimeMs);return new za(t.batchId,i,n,r)},jc.prototype.xc=function(t){var e=[];return t.forEach(function(t){e.push(Va(t.path))}),e},jc.prototype.jc=function(t){for(var e=Yu(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Gi(Ba(i)))}return e},jc.prototype.dc=function(t){var e,n=this.Vc(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Vc(t.lastLimboFreeSnapshotVersion):Ui.MIN;return e=void 0!==t.query.documents?this.Fc.vr(t.query):this.Fc.br(t.query),new Pu(e,t.targetId,0,t.lastListenSequenceNumber,n,r,yu.fromBase64String(t.resumeToken))},jc.prototype.vc=function(t){Fr(0===t.fi,"Only queries with purpose 0 may be stored, got "+t.fi);var e,n=this.Uc(t.li),r=this.Uc(t.lastLimboFreeSnapshotVersion);e=t.target.Nn()?this.Fc.dr(t.target):this.Fc.wr(t.target);var i=t.resumeToken.toBase64();return new Sc(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},jc);function jc(t){this.Fc=t}var Bc,zc="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Hc=(t(Yc,Bc=$a),Yc),Wc=(Qc.ds=function(t,e){if(t instanceof Hc)return Za.ds(t.Xs,e);throw qr("IndexedDbPersistence must use instances of IndexedDbTransaction")},Qc.Yc=function(n){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:if(!Qc.cs())throw new Xr(Jr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Qc(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.Xc,n.Lc,n.serializer,n.qc)).start()];case 1:return t.sent(),[2,e]}})})},Qc.prototype.start=function(){var e=this;return Fr(!this.Co,"IndexedDbPersistence double-started!"),Fr(null!==this.window,"Expected 'window' to be defined"),Za.hs(this.Kc,sc,new uc(this.serializer)).then(function(t){return e.$c=t,e.Zc()}).then(function(){return e.ta(),e.na(),e.ia(),e.$c.runTransaction("readonly-idempotent",[kc.store],function(t){return Yh(t)})}).then(function(t){e.ea=new La(t,e.qc)}).then(function(){e.Bc=!0}).catch(function(t){return e.$c&&e.$c.close(),Promise.reject(t)})},Qc.prototype.ra=function(n){var t=this;return this.zc=function(e){return p(t,void 0,void 0,function(){return v(this,function(t){return this.Co?[2,n(e)]:[2]})})},n(this.isPrimary)},Qc.prototype.ua=function(n){var t=this;this.$c.vs(function(e){return p(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Qc.prototype.yh=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Lc.$r(function(){return p(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Co?[4,this.Zc()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Qc.prototype.Zc=function(){var n=this;return this.$c.runTransaction("readwrite-idempotent",Mc,function(e){return Jc(e).put(new _c(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.sa(e).next(function(t){t||(n.isPrimary=!1,n.Lc.$r(function(){return n.zc(!1)}))})}).next(function(){return n.oa(e)}).next(function(t){return n.isPrimary&&!t?n.ha(e).next(function(){return!1}):!!t&&n.ca(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return _r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Lc.$r(function(){return n.zc(t)}),n.isPrimary=t})},Qc.prototype.sa=function(t){var e=this;return Kc(t).get(lc.key).next(function(t){return Ka.resolve(e.aa(t))})},Qc.prototype.fa=function(t){return Jc(t).delete(this.clientId)},Qc.prototype.la=function(){return p(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.da(this.Wc,18e5)?[3,2]:(this.Wc=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=Qc.ds(t,_c.store);return r.Is().next(function(t){var e=i.va(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ka.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.wa(t.clientId))}),t.label=2;case 2:return[2]}})})},Qc.prototype.ia=function(){var t=this;this.Gc=this.Lc.fu("client_metadata_refresh",4e3,function(){return t.Zc().then(function(){return t.la()}).then(function(){return t.ia()})})},Qc.prototype.aa=function(t){return!!t&&t.ownerId===this.clientId},Qc.prototype.oa=function(e){var i=this;return Kc(e).get(lc.key).next(function(t){if(null!==t&&i.da(t.leaseTimestampMs,5e3)&&!i.ma(t.ownerId)){if(i.aa(t)&&i.networkEnabled)return!0;if(!i.aa(t)){if(!t.allowTabSynchronization)throw new Xr(Jr.FAILED_PRECONDITION,zc);return!1}}return!(!i.networkEnabled||!i.inForeground)||Jc(e).Is().next(function(t){return void 0===i.va(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&_r("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Qc.prototype.shutdown=function(){return p(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Bc=!1,this.pa(),this.Gc&&(this.Gc.cancel(),this.Gc=null),this.ga(),this.ba(),[4,this.$c.runTransaction("readwrite-idempotent",[lc.store,_c.store],function(t){return e.ha(t).next(function(){return e.fa(t)})})];case 1:return t.sent(),this.$c.close(),this.ya(),[2]}})})},Qc.prototype.va=function(t,e){var n=this;return t.filter(function(t){return n.da(t.updateTimeMs,e)&&!n.ma(t.clientId)})},Qc.prototype.gh=function(){var e=this;return this.$c.runTransaction("readonly-idempotent",[_c.store],function(t){return Jc(t).Is().next(function(t){return e.va(t,18e5).map(function(t){return t.clientId})})})},Qc.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Qc.cs()?(e=n+Qc.Hc,[4,Za.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Qc.prototype,"Co",{get:function(){return this.Bc},enumerable:!0,configurable:!0}),Qc.prototype.Po=function(t){return Fr(this.Co,"Cannot initialize MutationQueue before persistence is started."),gh.ks(t,this.serializer,this.Cs,this.As)},Qc.prototype.Fo=function(){return Fr(this.Co,"Cannot initialize TargetCache before persistence is started."),this.Oo},Qc.prototype.No=function(){return Fr(this.Co,"Cannot initialize RemoteDocumentCache before persistence is started."),this.so},Qc.prototype.Uo=function(){return Fr(this.Co,"Cannot initialize IndexManager before persistence is started."),this.Cs},Qc.prototype.runTransaction=function(n,t,r){var i=this;_r("IndexedDbPersistence","Starting transaction:",n);var o,e=t.endsWith("idempotent"),s=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.$c.runTransaction(s,Mc,function(e){return o=new Hc(e,i.ea.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.sa(e).next(function(t){return!!t||i.oa(e)}).next(function(t){if(!t)throw Ur("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Lc.$r(function(){return i.zc(!1)}),new Xr(Jr.FAILED_PRECONDITION,Xa);return r(o)}).next(function(t){return i.ca(e).next(function(){return t})}):i._a(e).next(function(){return r(o)})}).then(function(t){return o.ss(),t})},Qc.prototype._a=function(t){var e=this;return Kc(t).get(lc.key).next(function(t){if(null!==t&&e.da(t.leaseTimestampMs,5e3)&&!e.ma(t.ownerId)&&!e.aa(t)&&!t.allowTabSynchronization)throw new Xr(Jr.FAILED_PRECONDITION,zc)})},Qc.prototype.ca=function(t){var e=new lc(this.clientId,this.allowTabSynchronization,Date.now());return Kc(t).put(lc.key,e)},Qc.cs=function(){return Za.cs()},Qc.Ia=function(t){var e=t.s.projectId;return t.s.o||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Qc.prototype.ha=function(t){var e=this,n=Kc(t);return n.get(lc.key).next(function(t){return e.aa(t)?(_r("IndexedDbPersistence","Releasing primary lease."),n.delete(lc.key)):Ka.resolve()})},Qc.prototype.da=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Ur("Detected an update time that is in the future: "+t+" > "+n),1))},Qc.prototype.ta=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qc=function(){t.Lc.$r(function(){return t.inForeground="visible"===t.document.visibilityState,t.Zc()})},this.document.addEventListener("visibilitychange",this.Qc),this.inForeground="visible"===this.document.visibilityState)},Qc.prototype.ga=function(){this.Qc&&(Fr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.Qc),this.Qc=null)},Qc.prototype.na=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Mc=function(){t.pa(),t.Lc.$r(function(){return t.shutdown()})},this.window.addEventListener("unload",this.Mc))},Qc.prototype.ba=function(){this.Mc&&(Fr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Mc),this.Mc=null)},Qc.prototype.ma=function(t){try{var e=null!==this.Jc.getItem(this.wa(t));return _r("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Ur("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Qc.prototype.pa=function(){try{this.Jc.setItem(this.wa(this.clientId),String(Date.now()))}catch(t){Ur("Failed to set zombie client id.",t)}},Qc.prototype.ya=function(){try{this.Jc.removeItem(this.wa(this.clientId))}catch(t){}},Qc.prototype.wa=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Qc.Hc="main",Qc);function Qc(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Lc=o,this.qc=u,this.Bc=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Mc=null,this.inForeground=!1,this.Qc=null,this.Gc=null,this.Wc=Number.NEGATIVE_INFINITY,this.zc=function(t){return Promise.resolve()},this.As=new Xc(this,i),this.Kc=e+Qc.Hc,this.serializer=new Gc(s),this.document=r.document,this.Oo=new Vh(this.As,this.serializer),this.Cs=new qc,this.so=new Xh(this.serializer,this.Cs),!r.window||!r.window.localStorage)throw new Xr(Jr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Jc=this.window.localStorage}function Yc(t,e){var n=Bc.call(this)||this;return n.Xs=t,n.Zo=e,n}function Kc(t){return t.store(lc.store)}function Jc(t){return t.store(_c.store)}var Xc=($c.prototype.$h=function(t){var n=this.Ea(t);return this.db.Fo().wc(t).next(function(e){return n.next(function(t){return e+t})})},$c.prototype.Ea=function(t){var e=0;return this.tc(t,function(t){e++}).next(function(){return e})},$c.prototype.ce=function(t,e){return this.db.Fo().ce(t,e)},$c.prototype.tc=function(t,n){return this.Da(t,function(t,e){return n(e)})},$c.prototype.Ao=function(t){this.Ta=t},$c.prototype.Du=function(t,e){return Zc(t,e)},$c.prototype.Ru=function(t,e){return Zc(t,e)},$c.prototype.nc=function(t,e,n){return this.db.Fo().nc(t,e,n)},$c.prototype.Zs=function(t,e){return Zc(t,e)},$c.prototype.Sa=function(t,e){return this.Ta.Ou(e)?Ka.resolve(!0):(r=e,i=!1,Nh(n=t).Rs(function(t){return bh(n,t,r).next(function(t){return t&&(i=!0),Ka.resolve(!t)})}).next(function(){return i}));var n,r,i},$c.prototype.ic=function(r,i){var o=this,s=this.db.No().Wo(),u=[],a=0;return this.Da(r,function(e,t){if(t<=i){var n=o.Sa(r,e).next(function(t){if(!t)return a++,s.Zu(r,e).next(function(){return s.$u(e),Kh(r).delete([0,Va(e.path)])})});u.push(n)}}).next(function(){return Ka.Wu(u)}).next(function(){return s.apply(r)}).next(function(){return a})},$c.prototype.removeTarget=function(t,e){var n=e.di(t.Zo);return this.db.Fo().nh(t,n)},$c.prototype.ih=function(t,e){return Zc(t,e)},$c.prototype.Da=function(t,o){var s,e=Kh(t),u=La.Mr;return e.Ss({index:Dc.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==La.Mr&&o(new Gi(Ba(s)),u),u=i,s=r):u=La.Mr}).next(function(){u!==La.Mr&&o(new Gi(Ba(s)),u)})},$c.prototype.ec=function(t){return this.db.No().Cc(t)},$c);function $c(t,e){this.db=t,this.Ta=null,this.Wh=new Fh(this,e)}function Zc(t,e){return Kh(t).put((n=e,r=t.Zo,new Dc(0,Va(n.path),r)));var n,r}var tf=(rf.prototype.xo=function(t){this.Ra=t},rf.prototype.do=function(e,r,i,o){var s=this;return Fr(void 0!==this.Ra,"setLocalDocumentsView() not called"),r.Jn()||i.isEqual(Ui.MIN)?this.Ca(e,r):this.Ra.fo(e,o).next(function(t){var n=s.Aa(r,t);return(r.ii()||r.ei())&&s.Pa(r.Fn,n,o,i)?s.Ca(e,r):(Lr()<=0&&_r("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Ra.do(e,r,i).next(function(e){return n.forEach(function(t){e=e.lt(t.key,t)}),e}))})},rf.prototype.Aa=function(n,t){var r=new ro(function(t,e){return n.Xn(t,e)});return t.forEach(function(t,e){e instanceof Ss&&n.matches(e)&&(r=r.add(e))}),r},rf.prototype.Pa=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.h(r))},rf.prototype.Ca=function(t,e){return Lr()<=0&&_r("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Ra.do(t,e,Ui.MIN)},rf),ef=(nf.prototype.Ns=function(t){return Ka.resolve(0===this.oo.length)},nf.prototype.Os=function(t,e,n){var r=e.batchId,i=this.Oa(r,"acknowledged");Fr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.oo[i];return Fr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Ka.resolve()},nf.prototype.Vs=function(t){return Ka.resolve(this.lastStreamToken)},nf.prototype.Us=function(t,e){return this.lastStreamToken=e,Ka.resolve()},nf.prototype.xs=function(t,e,n,r){Fr(0!==r.length,"Mutation batches should not be empty");var i=this.ka;this.ka++,0<this.oo.length&&Fr(this.oo[this.oo.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new za(i,e,n,r);this.oo.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Na=this.Na.add(new Qa(a.key,i)),this.Cs.Ls(t,a.key.path.H())}return Ka.resolve(o)},nf.prototype.qs=function(t,e){return Ka.resolve(this.Fa(e))},nf.prototype.Ms=function(t,e){var n=this.Fa(e);return Fr(null!=n,"Failed to find local mutation batch."),Ka.resolve(n.keys())},nf.prototype.Qs=function(t,e){var n=e+1,r=this.Va(n),i=r<0?0:r;return Ka.resolve(this.oo.length>i?this.oo[i]:null)},nf.prototype.Gs=function(){return Ka.resolve(0===this.oo.length?-1:this.ka-1)},nf.prototype.Ws=function(t){return Ka.resolve(this.oo.slice())},nf.prototype.zs=function(t,n){var r=this,e=new Qa(n,0),i=new Qa(n,Number.POSITIVE_INFINITY),o=[];return this.Na.Lt([e,i],function(t){Fr(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.Fa(t.Fu);Fr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Ka.resolve(o)},nf.prototype.Ks=function(t,e){var r=this,i=new ro(jr);return e.forEach(function(e){var t=new Qa(e,0),n=new Qa(e,Number.POSITIVE_INFINITY);r.Na.Lt([t,n],function(t){Fr(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.Fu)})}),Ka.resolve(this.Ua(i))},nf.prototype.Js=function(t,e){Fr(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Gi.ht(i)||(i=i.child(""));var o=new Qa(new Gi(i),0),s=new ro(jr);return this.Na.qt(function(t){var e=t.key.path;return!!n.$(e)&&(e.length===r&&(s=s.add(t.Fu)),!0)},o),Ka.resolve(this.Ua(s))},nf.prototype.Ua=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Fa(t);null!==e&&r.push(e)}),r},nf.prototype.Ys=function(n,r){var i=this;Fr(0===this.Oa(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.oo.shift();var o=this.Na;return Ka.forEach(r.mutations,function(t){var e=new Qa(t.key,r.batchId);return o=o.delete(e),i.As.Zs(n,t.key)}).next(function(){i.Na=o})},nf.prototype.$s=function(t){},nf.prototype.Ou=function(t,e){var n=new Qa(e,0),r=this.Na.Bt(n);return Ka.resolve(e.isEqual(r&&r.key))},nf.prototype.to=function(t){return 0===this.oo.length&&Fr(this.Na.J(),"Document leak -- detected dangling mutation references when queue is empty."),Ka.resolve()},nf.prototype.Oa=function(t,e){var n=this.Va(t);return Fr(0<=n&&n<this.oo.length,"Batches must exist to be "+e),n},nf.prototype.Va=function(t){return 0===this.oo.length?0:t-this.oo[0].batchId},nf.prototype.Fa=function(t){var e=this.Va(t);if(e<0||e>=this.oo.length)return null;var n=this.oo[e];return Fr(n.batchId===t,"If found batch must match"),n},nf);function nf(t,e){this.Cs=t,this.As=e,this.oo=[],this.ka=1,this.lastStreamToken=yu.ai,this.Na=new ro(Qa.Sn)}function rf(){}var of,sf,uf,af,hf=(Lf.prototype.Yu=function(t,e,n){Fr(!n.isEqual(Ui.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.xa(e);return this.docs=this.docs.lt(r,{bc:e,size:s,readTime:n}),this.size+=s-o,this.Cs.Ls(t,r.path.H())},Lf.prototype.$u=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Lf.prototype.Zu=function(t,e){var n=this.docs.get(e);return Ka.resolve(n?n.bc:null)},Lf.prototype.getEntries=function(t,e){var n=this,r=ju();return e.forEach(function(t){var e=n.docs.get(t);r=r.lt(t,e?e.bc:null)}),Ka.resolve(r)},Lf.prototype.do=function(t,e,n){Fr(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=zu(),i=new Gi(e.path.child("")),o=this.docs.yt(i);o.St();){var s=o.Dt(),u=s.key,a=s.value,h=a.bc,c=a.readTime;if(!e.path.$(u.path))break;c.h(n)<=0||h instanceof Ss&&e.matches(h)&&(r=r.lt(h.key,h))}return Ka.resolve(r)},Lf.prototype.ja=function(t,e){return Ka.forEach(this.docs,function(t){return e(t)})},Lf.prototype.Eh=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},Lf.prototype.Sh=function(t){return Ka.resolve(Ui.MIN)},Lf.prototype.Wo=function(t){return new Lf.Rc(this)},Lf.prototype.Cc=function(t){return Ka.resolve(this.size)},Lf.Rc=(t(Pf,af=Ja),Pf.prototype.es=function(n){var r=this,i=[];return this.Ku.forEach(function(t,e){e?i.push(r.Ac.Yu(n,e,r.readTime)):r.Ac.$u(t)}),Ka.Wu(i)},Pf.prototype.ts=function(t,e){return this.Ac.Zu(t,e)},Pf.prototype.ns=function(t,e){return this.Ac.getEntries(t,e)},Pf),Lf),cf=(xf.prototype.ce=function(t,n){return this.La.forEach(function(t,e){return n(e)}),Ka.resolve()},xf.prototype.Jo=function(t){return Ka.resolve(this.lastRemoteSnapshotVersion)},xf.prototype.hc=function(t){return Ka.resolve(this.qa)},xf.prototype.fh=function(t){var e=this.uc.after(this.highestTargetId);return this.highestTargetId=e,Ka.resolve(e)},xf.prototype.eh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.qa&&(this.qa=e),Ka.resolve()},xf.prototype.cc=function(t){this.La.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.qa&&(this.qa=t.sequenceNumber)},xf.prototype.lh=function(t,e){return Fr(!this.La.has(e.target),"Adding a target that already exists"),this.cc(e),this.targetCount+=1,Ka.resolve()},xf.prototype.nh=function(t,e){return Fr(this.La.has(e.target),"Updating a non-existent target"),this.cc(e),Ka.resolve()},xf.prototype.fc=function(t,e){return Fr(0<this.targetCount,"Removing a target from an empty cache"),Fr(this.La.has(e.target),"Removing a non-existent target from the cache"),this.La.delete(e.target),this.Ba.Pu(e.targetId),this.targetCount-=1,Ka.resolve()},xf.prototype.nc=function(n,r,i){var o=this,s=0,u=[];return this.La.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.La.delete(t),u.push(o.lc(n,e.targetId)),s++)}),Ka.Wu(u).next(function(){return s})},xf.prototype.wc=function(t){return Ka.resolve(this.targetCount)},xf.prototype.ah=function(t,e){var n=this.La.get(e)||null;return Ka.resolve(n)},xf.prototype.ye=function(t,e){return qr("Not yet implemented.")},xf.prototype.$o=function(e,t,n){this.Ba.Su(t,n);var r=this.persistence.As,i=[];return r&&t.forEach(function(t){i.push(r.Du(e,t))}),Ka.Wu(i)},xf.prototype.Xo=function(e,t,n){this.Ba.Au(t,n);var r=this.persistence.As,i=[];return r&&t.forEach(function(t){i.push(r.Ru(e,t))}),Ka.Wu(i)},xf.prototype.lc=function(t,e){return this.Ba.Pu(e),Ka.resolve()},xf.prototype.wh=function(t,e){var n=this.Ba.Nu(e);return Ka.resolve(n)},xf.prototype.Ou=function(t,e){return Ka.resolve(this.Ba.Ou(e))},xf),ff=(Cf.Ga=function(t,e){return new Cf(t,function(t){return new df(t,e)})},Cf.Wa=function(t){return new Cf(t,function(t){return new pf(t)})},Cf.prototype.shutdown=function(){return this.Bc=!1,Promise.resolve()},Object.defineProperty(Cf.prototype,"Co",{get:function(){return this.Bc},enumerable:!0,configurable:!0}),Cf.prototype.gh=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return[2,[this.clientId]]})})},Cf.prototype.ra=function(t){return t(!0)},Cf.prototype.ua=function(){},Cf.prototype.yh=function(t){},Cf.prototype.Uo=function(){return this.Cs},Cf.prototype.Po=function(t){var e=this.Ma[t.v()];return e||(e=new ef(this.Cs,this.As),this.Ma[t.v()]=e),e},Cf.prototype.Fo=function(){return this.Oo},Cf.prototype.No=function(){return this.so},Cf.prototype.runTransaction=function(t,e,n){var r=this;_r("MemoryPersistence","Starting transaction:",t);var i=new lf(this.ea.next());return this.As.za(),n(i).next(function(t){return r.As.Ka(i).next(function(){return t})}).Qu().then(function(t){return i.ss(),t})},Cf.prototype.Ha=function(e,n){return Ka.zu((t=this.Ma,r=[],li(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.Ou(e,n)}}));var t,r},Cf),lf=(t(Rf,uf=$a),Rf),pf=(Object.defineProperty(Of.prototype,"Ya",{get:function(){if(this.Ja)return this.Ja;throw qr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Of.prototype.Ao=function(t){this.Ta=t},Of.prototype.Du=function(t,e){return this.Ya.delete(e),Ka.resolve()},Of.prototype.Ru=function(t,e){return this.Ya.add(e),Ka.resolve()},Of.prototype.Zs=function(t,e){return this.Ya.add(e),Ka.resolve()},Of.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Fo();return r.wh(t,e.targetId).next(function(t){t.forEach(function(t){return n.Ya.add(t)})}).next(function(){return r.fc(t,e)})},Of.prototype.za=function(){this.Ja=new Set},Of.prototype.Ka=function(t){var n=this,r=this.persistence.No().Wo();return Ka.forEach(this.Ya,function(e){return n.Xa(t,e).next(function(t){t||r.$u(e)})}).next(function(){return n.Ja=null,r.apply(t)})},Of.prototype.ih=function(t,e){var n=this;return this.Xa(t,e).next(function(t){t?n.Ya.delete(e):n.Ya.add(e)})},Of.prototype.Qa=function(t){return 0},Of.prototype.Xa=function(t,e){var n=this;return Ka.zu([function(){return n.persistence.Fo().Ou(t,e)},function(){return n.persistence.Ha(t,e)},function(){return Ka.resolve(n.Ta.Ou(e))}])},Of),df=(kf.prototype.za=function(){},kf.prototype.Ka=function(t){return Ka.resolve()},kf.prototype.ce=function(t,e){return this.persistence.Fo().ce(t,e)},kf.prototype.$h=function(t){var n=this.Za(t);return this.persistence.Fo().wc(t).next(function(e){return n.next(function(t){return e+t})})},kf.prototype.Za=function(t){var e=0;return this.tc(t,function(t){e++}).next(function(){return e})},kf.prototype.tc=function(n,r){var i=this;return Ka.forEach(this.$a,function(t,e){return i.Sa(n,t,e).next(function(t){return t?Ka.resolve():r(e)})})},kf.prototype.Ao=function(t){this.Ta=t},kf.prototype.nc=function(t,e,n){return this.persistence.Fo().nc(t,e,n)},kf.prototype.ic=function(t,n){var r=this,i=0,e=this.persistence.No(),o=e.Wo();return e.ja(t,function(e){return r.Sa(t,e,n).next(function(t){t||(i++,o.$u(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},kf.prototype.Zs=function(t,e){return this.$a.set(e,t.Zo),Ka.resolve()},kf.prototype.removeTarget=function(t,e){var n=e.di(t.Zo);return this.persistence.Fo().nh(t,n)},kf.prototype.Du=function(t,e){return this.$a.set(e,t.Zo),Ka.resolve()},kf.prototype.Ru=function(t,e){return this.$a.set(e,t.Zo),Ka.resolve()},kf.prototype.ih=function(t,e){return this.$a.set(e,t.Zo),Ka.resolve()},kf.prototype.Qa=function(t){var e=t.key.toString().length;return t instanceof Ss&&(e+=t.data().bn()),e},kf.prototype.Sa=function(t,e,n){var r=this;return Ka.zu([function(){return r.persistence.Ha(t,e)},function(){return Ka.resolve(r.Ta.Ou(e))},function(){return r.persistence.Fo().Ou(t,e)},function(){var t=r.$a.get(e);return Ka.resolve(void 0!==t&&n<t)}])},kf.prototype.ec=function(t){return this.persistence.No().Cc(t)},kf),vf=(Df.prototype.reset=function(){this.ef=0},Df.prototype.sf=function(){this.ef=this.if},Df.prototype.hf=function(t){var e=this;this.cancel();var n=Math.floor(this.ef+this.cf()),r=Math.max(0,Date.now()-this.uf),i=Math.max(0,n-r);0<this.ef&&_r("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.ef+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.rf=this.Lc.fu(this.Gr,i,function(){return e.uf=Date.now(),t()}),this.ef*=this.nf,this.ef<this.tf&&(this.ef=this.tf),this.ef>this.if&&(this.ef=this.if)},Df.prototype.cancel=function(){null!==this.rf&&(this.rf.cancel(),this.rf=null)},Df.prototype.cf=function(){return(Math.random()-.5)*this.ef},Df),yf=(Sf.prototype.wf=function(){return 1===this.state||2===this.state||4===this.state},Sf.prototype.mf=function(){return 2===this.state},Sf.prototype.start=function(){3!==this.state?(Fr(0===this.state,"Already started"),this.auth()):this.pf()},Sf.prototype.stop=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.wf()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Sf.prototype.gf=function(){Fr(!this.wf(),"Can only inhibit backoff in a stopped state"),this.state=0,this.vf.reset()},Sf.prototype.bf=function(){var t=this;this.mf()&&null===this.df&&(this.df=this.Lc.fu(this.af,6e4,function(){return t.yf()}))},Sf.prototype._f=function(t){this.If(),this.stream.send(t)},Sf.prototype.yf=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return this.mf()?[2,this.close(0)]:[2]})})},Sf.prototype.If=function(){this.df&&(this.df.cancel(),this.df=null)},Sf.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fr(this.wf(),"Only started streams should be closed."),Fr(3===e||Ys(n),"Can't provide an error when not in an error state."),this.If(),this.vf.cancel(),this.lf++,3!==e?this.vf.reset():n&&n.code===Jr.RESOURCE_EXHAUSTED?(Ur(n.toString()),Ur("Using maximum backoff delay to prevent overloading the backend."),this.vf.sf()):n&&n.code===Jr.UNAUTHENTICATED&&this.ff.I(),null!==this.stream&&(this.Tf(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ef(n)];case 1:return t.sent(),[2]}})})},Sf.prototype.Tf=function(){},Sf.prototype.auth=function(){var n=this;Fr(0===this.state,"Must be in initial state to auth"),this.state=1;var t=this.Df(this.lf),e=this.lf;this.ff.getToken().then(function(t){n.lf===e&&n.Sf(t)},function(e){t(function(){var t=new Xr(Jr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Rf(t)})})},Sf.prototype.Sf=function(t){var e=this;Fr(1===this.state,"Trying to start stream in a non-starting state");var n=this.Df(this.lf);this.stream=this.Cf(t),this.stream.Af(function(){n(function(){return Fr(1===e.state,"Expected stream to be in state Starting, but was "+e.state),e.state=2,e.listener.Af()})}),this.stream.Ef(function(t){n(function(){return e.Rf(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Sf.prototype.pf=function(){var t=this;Fr(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.vf.hf(function(){return p(t,void 0,void 0,function(){return v(this,function(t){return Fr(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),Fr(this.wf(),"PersistentStream should have started"),[2]})})})},Sf.prototype.Rf=function(t){return Fr(this.wf(),"Can't handle server close on non-started stream"),_r("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Sf.prototype.Df=function(e){var n=this;return function(t){n.Lc.$r(function(){return n.lf===e?t():(_r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Sf),mf=(t(Af,sf=yf),Af.prototype.Cf=function(t){return this.connection.Pf("Listen",t)},Af.prototype.onMessage=function(t){this.vf.reset();var e=this.serializer.Ze(t),n=this.serializer.nr(t);return this.listener.kf(e,n)},Af.prototype.watch=function(t){var e={};e.database=this.serializer.je,e.addTarget=this.serializer.Yn(t);var n=this.serializer.Tr(t);n&&(e.labels=n),this._f(e)},Af.prototype.Nf=function(t){var e={};e.database=this.serializer.je,e.removeTarget=t,this._f(e)},Af),gf=(t(Nf,of=yf),Object.defineProperty(Nf.prototype,"Ff",{get:function(){return this.Of},enumerable:!0,configurable:!0}),Nf.prototype.start=function(){this.Of=!1,of.prototype.start.call(this)},Nf.prototype.Tf=function(){this.Of&&this.Vf([])},Nf.prototype.Cf=function(t){return this.connection.Pf("Write",t)},Nf.prototype.onMessage=function(t){if(Fr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.Re(t.streamToken),this.Of){this.vf.reset();var e=this.serializer.lr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Uf(n,e)}return Fr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.Of=!0,this.listener.xf()},Nf.prototype.jf=function(){Fr(this.mf(),"Writing handshake requires an opened stream"),Fr(!this.Of,"Handshake already completed");var t={};t.database=this.serializer.je,this._f(t)},Nf.prototype.Vf=function(t){var e=this;Fr(this.mf(),"Writing mutations requires an opened stream"),Fr(this.Of,"Handshake must be complete before writing mutations"),Fr(0<this.lastStreamToken.bn(),"Trying to write mutation without a token");var n={streamToken:this.serializer.Se(this.lastStreamToken),writes:t.map(function(t){return e.serializer.ir(t)})};this._f(n)},Nf),wf=(Tf.prototype.Lf=function(t){return new gf(this.Lc,this.connection,this.credentials,this.serializer,t)},Tf.prototype.qf=function(t){return new mf(this.Lc,this.connection,this.credentials,this.serializer,t)},Tf.prototype.commit=function(t){var e=this,n={database:this.serializer.je,writes:t.map(function(t){return e.serializer.ir(t)})};return this.Bf("Commit",n).then(function(t){return e.serializer.lr(t.writeResults,t.commitTime)})},Tf.prototype.lookup=function(e){var i=this,t={database:this.serializer.je,documents:e.map(function(t){return i.serializer.Oe(t)})};return this.Mf("BatchGetDocuments",t).then(function(t){var n=Gu();t.forEach(function(t){var e=i.serializer.Ye(t);n=n.lt(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Fr(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},Tf.prototype.Bf=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Bf(e,n,t)}).catch(function(t){throw t.code===Jr.UNAUTHENTICATED&&r.credentials.I(),t})},Tf.prototype.Mf=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Mf(e,n,t)}).catch(function(t){throw t.code===Jr.UNAUTHENTICATED&&r.credentials.I(),t})},Tf),bf=(If.documentId=function(){return If.Gf},If.prototype.isEqual=function(t){if(!(t instanceof If))throw ki("isEqual","FieldPath",1,t);return this.Qf.isEqual(t.Qf)},If.Gf=new If(Vi.st().nt()),If),Ef=new RegExp("[~\\*/\\[\\]]");function If(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Ci(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(gi("FieldPath","string",n,t[n]),0===t[n].length)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Qf=new Vi(t)}function Tf(t,e,n,r){this.Lc=t,this.connection=e,this.credentials=n,this.serializer=r}function Nf(t,e,n,r,i){var o=of.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this;return o.serializer=r,o.Of=!1,o.lastStreamToken=yu.ai,o}function Af(t,e,n,r,i){var o=sf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this;return o.serializer=r,o}function Sf(t,e,n,r,i,o){this.Lc=t,this.af=n,this.connection=r,this.ff=i,this.listener=o,this.state=0,this.lf=0,this.df=null,this.stream=null,this.vf=new vf(t,e)}function Df(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Lc=t,this.Gr=e,this.tf=n,this.nf=r,this.if=i,this.ef=0,this.rf=null,this.uf=Date.now(),this.reset()}function kf(t,e){this.persistence=t,this.Ta=null,this.$a=new Ya(function(t){return Va(t.path)}),this.Wh=new Fh(this,e)}function Of(t){this.persistence=t,this.Ta=null,this.Ja=null}function Rf(t){var e=uf.call(this)||this;return e.Zo=t,e}function Cf(t,e){var n=this;this.clientId=t,this.Ma={},this.ea=new La(0),this.Bc=!1,this.Bc=!0,this.As=e(this),this.Oo=new cf(this),this.Cs=new ic,this.so=new hf(this.Cs,function(t){return n.As.Qa(t)})}function xf(t){this.persistence=t,this.La=new Ya(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Ui.MIN,this.highestTargetId=0,this.qa=0,this.Ba=new Wa,this.targetCount=0,this.uc=Ah.ro()}function Lf(t,e){this.Cs=t,this.xa=e,this.docs=new ji(Gi.G),this.size=0}function Pf(t){var e=af.call(this)||this;return e.Ac=t,e}var _f,Uf,Mf,qf,Ff,Vf=(rl.delete=function(){return di("FieldValue.delete",arguments),Gf.instance},rl.serverTimestamp=function(){return di("FieldValue.serverTimestamp",arguments),jf.instance},rl.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yi("FieldValue.arrayUnion",arguments,1),new Bf(t)},rl.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yi("FieldValue.arrayRemove",arguments,1),new zf(t)},rl.increment=function(t){return gi("FieldValue.increment","number",1,t),vi("FieldValue.increment",arguments,1),new Hf(t)},rl.prototype.isEqual=function(t){return this===t},rl),Gf=(t(nl,Ff=Vf),nl.instance=new nl,nl),jf=(t(el,qf=Vf),el.instance=new el,el),Bf=(t(tl,Mf=Vf),tl),zf=(t(Zf,Uf=Vf),Zf),Hf=(t($f,_f=Vf),$f),Wf=Da(Vf,"Use FieldValue.<field>() instead."),Qf=/^__.*__$/,Yf=(Xf.prototype.Hf=function(t,e){var n=[];return null!==this.un?n.push(new Co(t,this.data,this.un,e)):n.push(new Ro(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new xo(t,this.fieldTransforms)),n},Xf),Kf=(Jf.prototype.Hf=function(t,e){var n=[new Co(t,this.data,this.un,e)];return 0<this.fieldTransforms.length&&n.push(new xo(t,this.fieldTransforms)),n},Jf);function Jf(t,e,n){this.data=t,this.un=e,this.fieldTransforms=n}function Xf(t,e,n){this.data=t,this.un=e,this.fieldTransforms=n}function $f(t){var e=_f.call(this,"FieldValue.increment")||this;return e.Kf=t,e}function Zf(t){var e=Uf.call(this,"FieldValue.arrayRemove")||this;return e.zf=t,e}function tl(t){var e=Mf.call(this,"FieldValue.arrayUnion")||this;return e.zf=t,e}function el(){return qf.call(this,"FieldValue.serverTimestamp")||this}function nl(){return Ff.call(this,"FieldValue.delete")||this}function rl(t){this.Wf=t}function il(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw qr("Unexpected case for UserDataSource: "+t)}}var ol=(hl.prototype.$f=function(t){var e=null==this.path?null:this.path.child(t),n=new hl(this.Jf,this.methodName,e,!1,this.fieldTransforms,this.un);return n.Zf(t),n},hl.prototype.tl=function(t){var e=null==this.path?null:this.path.child(t),n=new hl(this.Jf,this.methodName,e,!1,this.fieldTransforms,this.un);return n.Xf(),n},hl.prototype.nl=function(t){return new hl(this.Jf,this.methodName,null,!0,this.fieldTransforms,this.un)},hl.prototype.il=function(t){var e=null===this.path||this.path.J()?"":" (found in field "+this.path.toString()+")";return new Xr(Jr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},hl.prototype.contains=function(e){return void 0!==this.un.find(function(t){return e.$(t)})||void 0!==this.fieldTransforms.find(function(t){return e.$(t.field)})},hl.prototype.Xf=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Zf(this.path.get(t))},hl.prototype.Zf=function(t){if(0===t.length)throw this.il("Document fields must not be empty");if(il(this.Jf)&&Qf.test(t))throw this.il('Document fields cannot begin and end with "__"')},hl),sl=function(t,e){this.s=t,this.key=e},ul=(al.prototype.rl=function(t,e){var n=new ol(0,t,Vi.et);fl("Data must be an object, but it was:",n,e);var r=this.ul(e,n);return new Yf(r,null,n.fieldTransforms)},al.prototype.sl=function(t,e,n){var r=new ol(2,t,Vi.et);fl("Data must be an object, but it was:",r,e);var i,o,s=this.ul(e,r);if(n){for(var u=new ro(Vi.G),a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof bf)f=c.Qf;else{if("string"!=typeof c)throw qr("Expected stringOrFieldPath to be a string or a FieldPath");f=pl(t,c)}if(!r.contains(f))throw new Xr(Jr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");u=u.add(f)}i=So.Jt(u),o=r.fieldTransforms.filter(function(t){return i.Xt(t.field)})}else i=So.Yt(r.un),o=r.fieldTransforms;return new Yf(s,i,o)},al.prototype.ol=function(o,t){var s=this,u=new ol(1,o,Vi.et);fl("Data must be an object, but it was:",u,t);var a=new ro(Vi.G),h=Is.vn();li(t,function(t,e){var n=pl(o,t),r=u.tl(n);if((e=s.hl(e,r))instanceof Gf)a=a.add(n);else{var i=s.ul(e,r);null!=i&&(a=a.add(n),h.set(n,i))}});var e=So.Jt(a);return new Kf(h.cn(),e,u.fieldTransforms)},al.prototype.cl=function(t,e,n,r){var i=new ol(1,t,Vi.et),o=[ll(t,e)],s=[n];if(r.length%2!=0)throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(ll(t,r[u])),s.push(r[u+1]);var a=new ro(Vi.G),h=Is.vn();for(u=0;u<o.length;++u){var c=o[u],f=i.tl(c),l=this.hl(s[u],f);if(l instanceof Gf)a=a.add(c);else{var p=this.ul(l,f);null!=p&&(a=a.add(c),h.set(c,p))}}var d=So.Jt(a);return new Kf(h.cn(),d,i.fieldTransforms)},al.prototype.al=function(t,e,n){void 0===n&&(n=!1);var r=new ol(n?4:3,t,Vi.et),i=this.ul(e,r);return Fr(null!=i,"Parsed data should not be null."),Fr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},al.prototype.hl=function(t,e){try{return this.el(t)}catch(t){var n=dl(t);throw e.il(n)}},al.prototype.ul=function(t,e){if(cl(t=this.hl(t,e)))return fl("Unsupported field value:",e,t),this.fl(t,e);if(t instanceof Vf)return this.ll(t,e),null;if(e.path&&e.un.push(e.path),t instanceof Array){if(e.Yf&&4!==e.Jf)throw e.il("Nested arrays are not supported");return this.dl(t,e)}return this.vl(t,e)},al.prototype.fl=function(t,r){var i=this,o=new ji(jr);return pi(t)?r.path&&0<r.path.length&&r.un.push(r.path):li(t,function(t,e){var n=i.ul(e,r.$f(t));null!=n&&(o=o.lt(t,n))}),new Is(o)},al.prototype.dl=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],u=this.ul(s,e.nl(r));null==u&&(u=Mo.yn),n.push(u),r++}return new Ns(n)},al.prototype.ll=function(t,e){if(!il(e.Jf))throw e.il(t.Wf+"() can only be used with update() and set()");if(null===e.path)throw e.il(t.Wf+"() is not currently supported inside arrays");if(t instanceof Gf){if(2!==e.Jf)throw 1===e.Jf?(Fr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.il("FieldValue.delete() can only appear at the top level of your update data")):e.il("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.un.push(e.path)}else if(t instanceof jf)e.fieldTransforms.push(new Do(e.path,oo.instance));else if(t instanceof Bf){var n=this.wl(t.Wf,t.zf),r=new so(n);e.fieldTransforms.push(new Do(e.path,r))}else if(t instanceof zf){n=this.wl(t.Wf,t.zf);var i=new uo(n);e.fieldTransforms.push(new Do(e.path,i))}else if(t instanceof Hf){var o=this.al("FieldValue.increment",t.Kf),s=new ao(o);e.fieldTransforms.push(new Do(e.path,s))}else qr("Unknown FieldValue type: "+t)},al.prototype.vl=function(t,e){if(null===t)return Mo.yn;if("number"==typeof t)return Ks(t)?new ds(t):new vs(t);if("boolean"==typeof t)return qo.of(t);if("string"==typeof t)return new ys(t);if(t instanceof Date)return new ms(_i.fromDate(t));if(t instanceof _i)return new ms(new _i(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Pi)return new Es(t);if(t instanceof Ca)return new ws(t);if(t instanceof sl)return new bs(t.s,t.key);throw e.il("Unsupported field value: "+Ai(t))},al.prototype.wl=function(r,t){var i=this;return t.map(function(t,e){var n=new ol(3,r,Vi.et);return i.ul(t,n.nl(e))})},al);function al(t){this.el=t}function hl(t,e,n,r,i,o){this.Jf=t,this.methodName=e,this.path=n,this.Yf=r,void 0===i&&this.Xf(),this.Yf=void 0!==r&&r,this.fieldTransforms=i||[],this.un=o||[]}function cl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof _i||t instanceof Pi||t instanceof Ca||t instanceof sl||t instanceof Vf)}function fl(t,e,n){if(!cl(n)||!Ni(n)){var r=Ai(n);throw"an object"===r?e.il(t+" a custom object"):e.il(t+" "+r)}}function ll(t,e){if(e instanceof bf)return e.Qf;if("string"==typeof e)return pl(t,e);throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function pl(e,t){try{return function(e){if(0<=e.search(Ef))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(bf.bind.apply(bf,s([void 0],e.split("."))))}catch(t){throw new Xr(Jr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).Qf}catch(t){var n=dl(t);throw new Xr(Jr.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function dl(t){return t instanceof Error?t.message:t.toString()}var vl=(bl.prototype.lookup=function(r){return p(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this._l(),0<this.mutations.length)throw new Xr(Jr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.ml.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Ds||t instanceof Ss?n.Il(t):qr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},bl.prototype.set=function(t,e){this.write(e.Hf(t,this.in(t))),this.yl.add(t)},bl.prototype.update=function(t,e){try{this.write(e.Hf(t,this.Tl(t)))}catch(t){this.bl=t}this.yl.add(t)},bl.prototype.delete=function(t){this.write([new Lo(t,this.in(t))]),this.yl.add(t)},bl.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this._l(),this.bl)throw this.bl;return e=this.pl,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Po(t,n.in(t)))}),[4,this.ml.commit(this.mutations)];case 1:return t.sent(),this.gl=!0,[2]}})})},bl.prototype.Il=function(t){var e;if(t instanceof Ss)e=t.version;else{if(!(t instanceof Ds))throw qr("Document in a transaction was a "+t.constructor.name);e=Ui.q()}var n=this.pl.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Xr(Jr.ABORTED,"Document version changed between two reads.")}else this.pl=this.pl.lt(t.key,e)},bl.prototype.in=function(t){var e=this.pl.get(t);return!this.yl.has(t)&&e?ko.updateTime(e):ko.NONE},bl.prototype.Tl=function(t){var e=this.pl.get(t);if(this.yl.has(t)||!e)return ko.exists(!0);if(e.isEqual(Ui.q()))throw new Xr(Jr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ko.updateTime(e)},bl.prototype.write=function(t){this._l(),this.mutations=this.mutations.concat(t)},bl.prototype._l=function(){Fr(!this.gl,"A transaction object cannot be used after its update callback has been invoked.")},bl),yl=(wl.prototype.Cl=function(){var t=this;0===this.Dl&&(this.Al("Unknown"),Fr(null===this.Sl,"onlineStateTimer shouldn't be started yet"),this.Sl=this.Qr.fu("online_state_timeout",1e4,function(){return t.Sl=null,Fr("Unknown"===t.state,"Timer should be canceled if we transitioned to a different state."),t.Pl("Backend didn't respond within 10 seconds."),t.Al("Offline"),Promise.resolve()}))},wl.prototype.kl=function(t){"Online"===this.state?(this.Al("Unknown"),Fr(0===this.Dl,"watchStreamFailures must be 0"),Fr(null===this.Sl,"onlineStateTimer must be null")):(this.Dl++,1<=this.Dl&&(this.Nl(),this.Pl("Connection failed 1 times. Most recent error: "+t.toString()),this.Al("Offline")))},wl.prototype.set=function(t){this.Nl(),this.Dl=0,"Online"===t&&(this.Rl=!1),this.Al(t)},wl.prototype.Al=function(t){t!==this.state&&(this.state=t,this.El(t))},wl.prototype.Pl=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Rl?(Ur(e),this.Rl=!1):_r("OnlineStateTracker",e)},wl.prototype.Nl=function(){null!==this.Sl&&(this.Sl.cancel(),this.Sl=null)},wl),ml=(gl.prototype.start=function(){return this.enableNetwork()},gl.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.jl()?(e=this.Wl,[4,this.zh.Vs()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.Jl()?this.Yl():this.ql.set("Unknown"),[4,this.Xl()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},gl.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.$l()];case 1:return t.sent(),this.ql.set("Offline"),[2]}})})},gl.prototype.$l=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.Wl.stop()];case 1:return t.sent(),[4,this.Bl.stop()];case 2:return t.sent(),0<this.Ol.length&&(_r("RemoteStore","Stopping write stream with "+this.Ol.length+" pending writes"),this.Ol=[]),this.Zl(),[2]}})})},gl.prototype.shutdown=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return _r("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.$l()];case 1:return t.sent(),this.Ul.shutdown(),this.ql.set("Unknown"),[2]}})})},gl.prototype.listen=function(t){hi(this.Fl,t.targetId)||(this.Fl[t.targetId]=t,this.Jl()?this.Yl():this.Bl.mf()&&this.td(t))},gl.prototype.nd=function(t){Fr(hi(this.Fl,t),"unlisten called on target no currently watched: "+t),delete this.Fl[t],this.Bl.mf()&&this.ed(t),pi(this.Fl)&&(this.Bl.mf()?this.Bl.bf():this.jl()&&this.ql.set("Unknown"))},gl.prototype.ye=function(t){return this.Fl[t]||null},gl.prototype.be=function(t){return this.rd.be(t)},gl.prototype.td=function(t){this.Vl.Xi(t.targetId),this.Bl.watch(t)},gl.prototype.ed=function(t){this.Vl.Xi(t),this.Bl.Nf(t)},gl.prototype.Yl=function(){Fr(this.Jl(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Vl=new sa(this),this.Bl.start(),this.ql.Cl()},gl.prototype.Jl=function(){return this.jl()&&!this.Bl.wf()&&!pi(this.Fl)},gl.prototype.jl=function(){return this.isPrimary&&this.networkEnabled},gl.prototype.Zl=function(){this.Vl=null},gl.prototype.Ml=function(){return p(this,void 0,void 0,function(){var n=this;return v(this,function(t){return fi(this.Fl,function(t,e){n.td(e)}),[2]})})},gl.prototype.Ql=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){return void 0===e&&Fr(!this.Jl(),"Watch stream was stopped gracefully while still needed."),this.Zl(),this.Jl()?(this.ql.kl(e),this.Yl()):this.ql.set("Unknown"),[2]})})},gl.prototype.Gl=function(n,r){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.ql.set("Online"),n instanceof Zu&&2===n.state&&n.cause?[2,this.ud(n)]:(n instanceof Xu?this.Vl.ue(n):n instanceof $u?this.Vl.de(n):(Fr(n instanceof Zu,"Expected watchChange to be an instance of WatchTargetChange"),this.Vl.he(n)),r.isEqual(Ui.MIN)?[3,3]:[4,this.zh.Jo()]);case 1:return e=t.sent(),0<=r.h(e)?[4,this.sd(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},gl.prototype.sd=function(r){var i=this;Fr(!r.isEqual(Ui.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.Vl.me(r);return fi(t.Si,function(t,e){if(0<e.resumeToken.bn()){var n=i.Fl[t];n&&(i.Fl[t]=n.vi(e.resumeToken,r))}}),t.Ri.forEach(function(t){var e=i.Fl[t];if(e){i.Fl[t]=e.vi(yu.ai,e.li),i.ed(t);var n=new Pu(e.target,t,1,e.sequenceNumber);i.td(n)}}),this.rd.Yo(t)},gl.prototype.ud=function(t){var n=this;Fr(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return v(this,function(t){return hi(this.Fl,e)?(delete this.Fl[e],this.Vl.removeTarget(e),[2,this.rd.od(e,r)]):[2]})})})}),i},gl.prototype.Xl=function(){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.hd()?(e=0<this.Ol.length?this.Ol[this.Ol.length-1].batchId:-1,[4,this.zh.sh(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.Ol.length&&this.Wl.bf(),[3,4]);case 2:return this.ad(n),[4,this.Xl()];case 3:t.sent(),t.label=4;case 4:return this.fd()&&this.ld(),[2]}})})},gl.prototype.hd=function(){return this.jl()&&this.Ol.length<10},gl.prototype.dd=function(){return this.Ol.length},gl.prototype.ad=function(t){Fr(this.hd(),"addToWritePipeline called when pipeline is full"),this.Ol.push(t),this.Wl.mf()&&this.Wl.Ff&&this.Wl.Vf(t.mutations)},gl.prototype.fd=function(){return this.jl()&&!this.Wl.wf()&&0<this.Ol.length},gl.prototype.ld=function(){Fr(this.fd(),"startWriteStream() called when shouldStartWriteStream() is false."),this.Wl.start()},gl.prototype.zl=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return this.Wl.jf(),[2]})})},gl.prototype.Hl=function(){var r=this;return this.zh.Us(this.Wl.lastStreamToken).then(function(){for(var t=0,e=r.Ol;t<e.length;t++){var n=e[t];r.Wl.Vf(n.mutations)}}).catch(Lh)},gl.prototype.Uf=function(t,e){var n=this;Fr(0<this.Ol.length,"Got result for empty write pipeline");var r=this.Ol.shift(),i=Ha.from(r,t,e,this.Wl.lastStreamToken);return this.rd.vd(i).then(function(){return n.Xl()})},gl.prototype.Kl=function(n){return p(this,void 0,void 0,function(){var e=this;return v(this,function(t){return void 0===n&&Fr(!this.fd(),"Write stream was stopped gracefully while still needed."),n&&0<this.Ol.length?[2,(this.Wl.Ff?this.wd(n):this.md(n)).then(function(){e.fd()&&e.ld()})]:[2]})})},gl.prototype.md=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){return qu(e.code)?(_r("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.Wl.lastStreamToken),this.Wl.lastStreamToken=yu.ai,[2,this.zh.Us(yu.ai).catch(Lh)]):[2]})})},gl.prototype.wd=function(i){return p(this,void 0,void 0,function(){var n,r=this;return v(this,function(t){return qu(e=i.code)&&e!==Jr.ABORTED?(n=this.Ol.shift(),this.Wl.gf(),[2,this.rd.pd(n.batchId,i).then(function(){return r.Xl()})]):[2];var e})})},gl.prototype.gd=function(){return new vl(this.ml)},gl.prototype.Ll=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.$l()];case 1:return t.sent(),this.ql.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},gl.prototype.bd=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.jl()?(_r("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.Ll()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},gl.prototype.yd=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.$l()];case 3:t.sent(),this.ql.set("Unknown"),t.label=4;case 4:return[2]}})})},gl);function gl(t,e,n,r,i){var o=this;this.zh=t,this.ml=e,this.Ol=[],this.Fl={},this.Vl=null,this.networkEnabled=!1,this.isPrimary=!1,this.Ul=i,this.Ul.xl(function(t){n.$r(function(){return p(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.jl()?(_r("RemoteStore","Restarting streams for network reachability change."),[4,this.Ll()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.ql=new yl(n,r),this.Bl=this.ml.qf({Af:this.Ml.bind(this),Ef:this.Ql.bind(this),kf:this.Gl.bind(this)}),this.Wl=this.ml.Lf({Af:this.zl.bind(this),Ef:this.Kl.bind(this),xf:this.Hl.bind(this),Uf:this.Uf.bind(this)})}function wl(t,e){this.Qr=t,this.El=e,this.state="Unknown",this.Dl=0,this.Sl=null,this.Rl=!0}function bl(t){this.ml=t,this.pl=Wu(),this.mutations=[],this.gl=!1,this.bl=null,this.yl=new Set}function El(t,e){return Fr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),"firestore_clients_"+t+"_"+e}function Il(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.l()&&(r+="_"+e.uid),r}function Tl(t,e){return"firestore_targets_"+t+"_"+e}var Nl=(_l._d=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Xr(r.error.code,r.error.message)),i?new _l(t,e,r.state,o):(Ur("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},_l.prototype.Id=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},_l),Al=(Pl._d=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Xr(n.error.code,n.error.message)),r?new Pl(t,n.state,i):(Ur("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Pl.prototype.Id=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Pl),Sl=(Ll._d=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Ju(),o=0;r&&o<n.activeTargetIds.length;++o)r=Ks(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Ll(t,i):(Ur("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Ll),Dl=(xl._d=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new xl(e.clientId,e.onlineState):(Ur("SharedClientState","Failed to parse online state: "+t),null)},xl),kl=(Cl.prototype.Td=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Cl.prototype.Ed=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Cl.prototype.Id=function(){var t={activeTargetIds:this.activeTargetIds.tt(),updateTimeMs:Date.now()};return JSON.stringify(t)},Cl),Ol=(Rl.cs=function(t){return!(!t.window||null==t.window.localStorage)},Rl.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return Fr(!this.Co,"WebStorageSharedClientState already started"),Fr(null!==this.rd,"syncEngine property must be set before calling start()"),Fr(null!==this.El,"onlineStateHandler property must be set before calling start()"),[4,this.rd.gh()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Dd&&(o=this.getItem(El(this.persistenceKey,i)))&&(s=Sl._d(i,o))&&(this.Sd[s.clientId]=s);for(this.Ud(),(u=this.storage.getItem(this.Vd))&&(a=this.xd(u))&&this.jd(a),h=0,c=this.Ad;h<c.length;h++)f=c[h],this.Cd(f);return this.Ad=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.Co=!0,[2]}})})},Rl.prototype.Br=function(t){this.setItem(this.kd,JSON.stringify(t))},Rl.prototype.Ld=function(){var n=Ju();return li(this.Sd,function(t,e){n=n.Mt(e.activeTargetIds)}),n},Rl.prototype.qd=function(t){for(var e in this.Sd)if(this.Sd.hasOwnProperty(e)&&this.Sd[e].activeTargetIds.has(t))return!0;return!1},Rl.prototype.Bd=function(t){this.Md(t,"pending")},Rl.prototype.Qd=function(t,e,n){this.Md(t,e,n),this.Gd(t)},Rl.prototype.Wd=function(t){var e="not-current";if(this.qd(t)){var n=this.storage.getItem(Tl(this.persistenceKey,t));if(n){var r=Al._d(t,n);r&&(e=r.state)}}return this.zd.Td(t),this.Ud(),e},Rl.prototype.Kd=function(t){this.zd.Ed(t),this.Ud()},Rl.prototype.Hd=function(t){return this.zd.activeTargetIds.has(t)},Rl.prototype.Jd=function(t){this.removeItem(Tl(this.persistenceKey,t))},Rl.prototype.Yd=function(t,e,n){this.Xd(t,e,n)},Rl.prototype.Lo=function(t,e,n){var r=this;e.forEach(function(t){r.Gd(t)}),this.currentUser=t,n.forEach(function(t){r.Bd(t)})},Rl.prototype.$d=function(t){this.Zd(t)},Rl.prototype.shutdown=function(){this.Co&&(this.platform.window.removeEventListener("storage",this.Rd),this.removeItem(this.Pd),this.Co=!1)},Rl.prototype.getItem=function(t){var e=this.storage.getItem(t);return _r("SharedClientState","READ",t,e),e},Rl.prototype.setItem=function(t,e){_r("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Rl.prototype.removeItem=function(t){_r("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Rl.prototype.Cd=function(u){var t=this;if(u.storageArea===this.storage){if(_r("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Pd)return void Ur("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Lc.$r(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(!this.Co)return this.Ad.push(u),[2];if(null===u.key)return[2];if(this.Nd.test(u.key)){if(null==u.newValue)return n=this.tv(u.key),[2,this.nv(n,null)];if(e=this.iv(u.key,u.newValue))return[2,this.nv(e.clientId,e)]}else if(this.Od.test(u.key)){if(null!==u.newValue&&(r=this.ev(u.key,u.newValue)))return[2,this.rv(r)]}else if(this.Fd.test(u.key)){if(null!==u.newValue&&(i=this.uv(u.key,u.newValue)))return[2,this.sv(i)]}else if(u.key===this.Vd){if(null!==u.newValue&&(o=this.xd(u.newValue)))return[2,this.jd(o)]}else u.key===this.kd&&(Fr(!!this.jr,"Missing sequenceNumberHandler"),(s=function(t){var e=La.Mr;if(null!=t)try{var n=JSON.parse(t);Fr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Ur("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==La.Mr&&this.jr(s));return[2]})})})}},Object.defineProperty(Rl.prototype,"zd",{get:function(){return this.Sd[this.Dd]},enumerable:!0,configurable:!0}),Rl.prototype.Ud=function(){this.setItem(this.Pd,this.zd.Id())},Rl.prototype.Md=function(t,e,n){var r=new Nl(this.currentUser,t,e,n),i=Il(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Id())},Rl.prototype.Gd=function(t){var e=Il(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Rl.prototype.Zd=function(t){var e={clientId:this.Dd,onlineState:t};this.storage.setItem(this.Vd,JSON.stringify(e))},Rl.prototype.Xd=function(t,e,n){var r=Tl(this.persistenceKey,t),i=new Al(t,e,n);this.setItem(r,i.Id())},Rl.prototype.tv=function(t){var e=this.Nd.exec(t);return e?e[1]:null},Rl.prototype.iv=function(t,e){var n=this.tv(t);return Fr(null!==n,"Cannot parse client state key '"+t+"'"),Sl._d(n,e)},Rl.prototype.ev=function(t,e){var n=this.Od.exec(t);Fr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Nl._d(new Kr(i),r,e)},Rl.prototype.uv=function(t,e){var n=this.Fd.exec(t);Fr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Al._d(r,e)},Rl.prototype.xd=function(t){return Dl._d(t)},Rl.prototype.rv=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid!==this.currentUser.uid?(_r("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.rd.ov(e.batchId,e.state,e.error)]})})},Rl.prototype.sv=function(t){return this.rd.hv(t.targetId,t.state,t.error)},Rl.prototype.nv=function(t,e){var n=this,r=this.Ld();e?this.Sd[t]=e:delete this.Sd[t];var i=this.Ld(),o=[],s=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return v(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return v(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.rd.cv(o,s)},Rl.prototype.jd=function(t){this.Sd[t.clientId]&&this.El(t.onlineState)},Rl);function Rl(t,e,n,r,i){if(this.Lc=t,this.platform=e,this.persistenceKey=n,this.Dd=r,this.rd=null,this.El=null,this.jr=null,this.Sd={},this.Rd=this.Cd.bind(this),this.Co=!1,this.Ad=[],!Rl.cs(this.platform))throw new Xr(Jr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Pd=El(this.persistenceKey,this.Dd),this.kd="firestore_sequence_number_"+this.persistenceKey,this.Sd[this.Dd]=new kl,this.Nd=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Od=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Fd=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Vd="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Rd)}function Cl(){this.activeTargetIds=Ju()}function xl(t,e){this.clientId=t,this.onlineState=e}function Ll(t,e){this.clientId=t,this.activeTargetIds=e}function Pl(t,e,n){this.targetId=t,this.state=e,Fr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function _l(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Fr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}function Ul(t){this.key=t}function Ml(t){this.key=t}var ql=(Gl.prototype.Bd=function(t){},Gl.prototype.Qd=function(t,e,n){},Gl.prototype.Wd=function(t){return this.av.Td(t),this.fv[t]||"not-current"},Gl.prototype.Yd=function(t,e,n){this.fv[t]=e},Gl.prototype.Kd=function(t){this.av.Ed(t)},Gl.prototype.Hd=function(t){return this.av.activeTargetIds.has(t)},Gl.prototype.Jd=function(t){delete this.fv[t]},Gl.prototype.Ld=function(){return this.av.activeTargetIds},Gl.prototype.qd=function(t){return this.av.activeTargetIds.has(t)},Gl.prototype.start=function(){return this.av=new kl,Promise.resolve()},Gl.prototype.Lo=function(t,e,n){},Gl.prototype.$d=function(t){},Gl.prototype.shutdown=function(){},Gl.prototype.Br=function(t){},Gl),Fl=(Object.defineProperty(Vl.prototype,"mv",{get:function(){return this.lv},enumerable:!0,configurable:!0}),Vl.prototype.pv=function(t,e){var u=this,a=e?e.gv:new ea,h=e?e.wv:this.wv,c=e?e.Ii:this.Ii,f=h,l=!1,p=this.query.ii()&&h.size===this.query.limit?h.last():null,d=this.query.ei()&&h.size===this.query.limit?h.first():null;if(t.pt(function(t,e){var n=h.get(t),r=e instanceof Ss?e:null;r&&(Fr(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=u.query.matches(r)?r:null);var i=!!n&&u.Ii.has(n.key),o=!!r&&(r.en||u.Ii.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.bv(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.Xn(r,p)||d&&u.query.Xn(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.ii()||this.query.ei())for(;f.size>this.query.limit;){var n=this.query.ii()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),a.track({type:1,doc:n})}return Fr(!l||!e,"View was refilled using docs that themselves needed refilling."),{wv:f,gv:a,Pa:l,Ii:c}},Vl.prototype.bv=function(t,e){return t.en&&e.hasCommittedMutations&&!e.en},Vl.prototype.es=function(t,e,n){var o=this;Fr(!t.Pa,"Cannot apply changes that need a refill");var r=this.wv;this.wv=t.wv,this.Ii=t.Ii;var i=t.gv.yi();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.Xn(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return qr("Unknown ChangeType: "+t)}}var r,i}),this.yv(n);var s=e?this._v():[],u=0===this.vv.size&&this.Ni?1:0,a=u!==this.dv;return this.dv=u,0!==i.length||a?{snapshot:new na(this.query,t.wv,r,i,t.Ii,0==u,a,!1),Iv:s}:{Iv:s}},Vl.prototype.Tv=function(t){return this.Ni&&"Offline"===t?(this.Ni=!1,this.es({wv:this.wv,gv:new ea,Ii:this.Ii,Pa:!1},!1)):{Iv:[]}},Vl.prototype.Ev=function(t){return!this.lv.has(t)&&!!this.wv.has(t)&&!this.wv.get(t).en},Vl.prototype.yv=function(t){var e=this;t&&(t.Oi.forEach(function(t){return e.lv=e.lv.add(t)}),t.Fi.forEach(function(t){return Fr(e.lv.has(t),"Modified document "+t+" not found in view.")}),t.Vi.forEach(function(t){return e.lv=e.lv.delete(t)}),this.Ni=t.Ni)},Vl.prototype._v=function(){var e=this;if(!this.Ni)return[];var n=this.vv;this.vv=Yu(),this.wv.forEach(function(t){e.Ev(t.key)&&(e.vv=e.vv.add(t.key))});var r=[];return n.forEach(function(t){e.vv.has(t)||r.push(new Ml(t))}),this.vv.forEach(function(t){n.has(t)||r.push(new Ul(t))}),r},Vl.prototype.Dv=function(t){this.lv=t.mh,this.vv=Yu();var e=this.pv(t.documents);return this.es(e,!0)},Vl.prototype.Sv=function(){return na.Di(this.query,this.wv,this.Ii,0===this.dv)},Vl);function Vl(t,e){this.query=t,this.lv=e,this.dv=null,this.Ni=!1,this.vv=Yu(),this.Ii=Yu(),this.wv=new ta(t.Xn.bind(t))}function Gl(){this.av=new kl,this.fv={},this.rd=null,this.El=null,this.jr=null}function jl(t,e,n){this.query=t,this.targetId=e,this.view=n}function Bl(t){this.key=t,this.Ov=!1}function zl(){this.aw=null,this.targetId=0,this.listeners=[]}function Hl(){}var Wl=(op.prototype.run=function(){this.Av()},op.prototype.Av=function(){var t=this;this.vf.hf(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.Rv.gd(),(n=this.Pv(e))&&n.then(function(t){r.Qr.$r(function(){return e.commit().then(function(){r.Kr.resolve(t)}).catch(function(t){r.kv(t)})})}).catch(function(t){r.kv(t)}),[2]})})})},op.prototype.Pv=function(t){try{var e=this.updateFunction(t);return!Ys(e)&&e.catch&&e.then?e:(this.Kr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Kr.reject(t),null}},op.prototype.kv=function(t){var e=this;0<this.Cv&&this.Nv(t)?(this.Cv-=1,this.Qr.$r(function(){return e.Av(),Promise.resolve()})):this.Kr.reject(t)},op.prototype.Nv=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!qu(e)},op),Ql=(Object.defineProperty(ip.prototype,"Gv",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),ip.prototype.subscribe=function(t){Fr(null!==t,"SyncEngine listener cannot be null"),Fr(null===this.Vv,"SyncEngine already has a subscriber."),this.Vv=t},ip.prototype.listen=function(s){return p(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.Wv("listen()"),(r=this.Uv.get(s))?(e=r.targetId,this.Fv.Wd(e),n=r.view.Sv(),[3,4]):[3,1];case 1:return[4,this.zh.hh(s.Yn())];case 2:return i=t.sent(),o=this.Fv.Wd(i.targetId),e=i.targetId,[4,this.zv(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.Rv.listen(i),t.label=4;case 4:return this.Vv.kf([n]),[2,e]}})})},ip.prototype.zv=function(u,a,h){return p(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.zh.vh(u,!0)];case 1:return e=t.sent(),n=new Fl(u,e.mh),r=n.pv(e.documents),i=ia.ki(a,h&&"Offline"!==this.onlineState),Fr(0===(o=n.es(r,!0===this.isPrimary,i)).Iv.length,"View returned limbo docs before target ack from the server."),Fr(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new jl(u,a,n),this.Uv.set(u,s),this.xv[a]||(this.xv[a]=[]),this.xv[a].push(u),[2,o.snapshot]}})})},ip.prototype.Kv=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.zh.vh(r.query,!0)];case 1:return e=t.sent(),n=r.view.Dv(e),this.isPrimary&&this.Hv(r.targetId,n.Iv),[2,n]}})})},ip.prototype.nd=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.Wv("unlisten()"),Fr(!!(e=this.Uv.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.xv[e.targetId]).length?(this.xv[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.Uv.delete(i),[2]):this.isPrimary?(this.Fv.Kd(e.targetId),this.Fv.qd(e.targetId)?[3,2]:[4,this.zh.dh(e.targetId,!1).then(function(){r.Fv.Jd(e.targetId),r.Rv.nd(e.targetId),r.Jv(e.targetId)}).catch(Lh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Jv(e.targetId),[4,this.zh.dh(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},ip.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Wv("write()"),[4,this.zh.Qo(n)];case 1:return e=t.sent(),this.Fv.Bd(e.batchId),this.Yv(e.batchId,r),[4,this.Xv(e.Ku)];case 2:return t.sent(),[4,this.Rv.Xl()];case 3:return t.sent(),[2]}})})},ip.prototype.runTransaction=function(t,e,n){new Wl(t,this.Rv,e,n).run()},ip.prototype.Yo=function(n){return p(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.Wv("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.zh.Yo(n)];case 2:return e=t.sent(),li(n.Si,function(t,e){var n=r.Lv[Number(t)];n&&(Fr(e.Oi.size+e.Fi.size+e.Vi.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.Oi.size?n.Ov=!0:0<e.Fi.size?Fr(n.Ov,"Received change for limbo target document without add."):0<e.Vi.size&&(Fr(n.Ov,"Received remove for limbo target document without add."),n.Ov=!1))}),[4,this.Xv(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Lh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},ip.prototype.Tv=function(r,t){if(this.isPrimary&&0===t||!this.isPrimary&&1===t){this.Wv("applyOnlineStateChange()");var i=[];this.Uv.forEach(function(t,e){var n=e.view.Tv(r);Fr(0===n.Iv.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.Vv.$v(r),this.Vv.kf(i),this.onlineState=r,this.isPrimary&&this.Fv.$d(r)}},ip.prototype.od=function(u,a){return p(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.Wv("rejectListens()"),this.Fv.Yd(u,"rejected",a),e=this.Lv[u],(n=e&&e.key)?(this.jv=this.jv.remove(n),delete this.Lv[u],r=(r=new ji(Gi.G)).lt(n,new Ds(n,Ui.q())),i=Yu().add(n),o=new ra(Ui.MIN,{},new ro(jr),r,i),[2,this.Yo(o)]):[3,1];case 1:return[4,this.zh.dh(u,!1).then(function(){return s.Jv(u,a)}).catch(Lh)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},ip.prototype.ov=function(n,r,i){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Wv("applyBatchState()"),[4,this.zh.Go(n)];case 1:return null===(e=t.sent())?(_r("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.Rv.Xl()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Zv(n,i||null),this.zh.bh(n)):qr("Unknown batchState: "+r),t.label=4;case 4:return[4,this.Xv(e)];case 5:return t.sent(),[2]}})})},ip.prototype.vd=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.Wv("applySuccessfulWrite()"),e=r.batch.batchId,this.Zv(e,null),this.tw(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.zh.Os(r)];case 2:return n=t.sent(),this.Fv.Qd(e,"acknowledged"),[4,this.Xv(n)];case 3:return t.sent(),[3,6];case 4:return[4,Lh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},ip.prototype.pd=function(n,r){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Wv("rejectFailedWrite()"),this.Zv(n,r),this.tw(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.zh.Ho(n)];case 2:return e=t.sent(),this.Fv.Qd(n,"rejected",r),[4,this.Xv(e)];case 3:return t.sent(),[3,6];case 4:return[4,Lh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},ip.prototype.nw=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Rv.jl()||_r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.zh.Gs()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.Mv.get(e)||[]).push(r),this.Mv.set(e,n)),[2]}})})},ip.prototype.tw=function(t){(this.Mv.get(t)||[]).forEach(function(t){t.resolve()}),this.Mv.delete(t)},ip.prototype.iw=function(e){this.Mv.forEach(function(t){t.forEach(function(t){t.reject(new Xr(Jr.CANCELLED,e))})}),this.Mv.clear()},ip.prototype.Yv=function(t,e){var n=this.Bv[this.currentUser.v()];n=(n=n||new ji(jr)).lt(t,e),this.Bv[this.currentUser.v()]=n},ip.prototype.Zv=function(t,e){var n=this.Bv[this.currentUser.v()];if(n){var r=n.get(t);r&&(Fr(t===n.vt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.Bv[this.currentUser.v()]=n}},ip.prototype.Jv=function(t,e){var n=this;void 0===e&&(e=null),this.Fv.Kd(t),Fr(this.xv[t]&&0!==this.xv[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.xv[t];r<i.length;r++){var o=i[r];this.Uv.delete(o),e&&this.Vv.ew(o,e)}if(delete this.xv[t],this.isPrimary){var s=this.qv.Nu(t);this.qv.Pu(t),s.forEach(function(t){n.qv.Ou(t)||n.rw(t)})}},ip.prototype.rw=function(t){var e=this.jv.get(t);null!==e&&(this.Rv.nd(e),this.jv=this.jv.remove(t),delete this.Lv[e])},ip.prototype.Hv=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Ul?(this.qv.Du(i.key,t),this.uw(i)):i instanceof Ml?(_r("SyncEngine","Document no longer in limbo: "+i.key),this.qv.Ru(i.key,t),this.qv.Ou(i.key)||this.rw(i.key)):qr("Unknown limbo change: "+JSON.stringify(i))}},ip.prototype.uw=function(t){var e=t.key;if(!this.jv.get(e)){_r("SyncEngine","New document in limbo: "+e);var n=this.Qv.next(),r=ru.jn(e.path);this.Lv[n]=new Bl(e),this.Rv.listen(new Pu(r.Yn(),n,2,La.Mr)),this.jv=this.jv.lt(e,n)}},ip.prototype.sw=function(){return this.jv},ip.prototype.Xv=function(r,a){return p(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Uv.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.pv(r);return n.Pa?u.zh.vh(i.query,!1).then(function(t){var e=t.documents;return i.view.pv(e,n)}):n}).then(function(t){var e=a&&a.Si[i.targetId],n=i.view.es(t,!0===u.isPrimary,e);if(u.Hv(i.targetId,n.Iv),n.snapshot){u.isPrimary&&u.Fv.Yd(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=Dh.Io(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Vv.kf(o),[4,this.zh.uh(s)];case 2:return t.sent(),[2]}})})},ip.prototype.Wv=function(t){Fr(null!==this.Vv,"Trying to call "+t+" before calling subscribe().")},ip.prototype.bd=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.iw("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.zh.Lo(r)]):[3,3];case 1:return n=t.sent(),this.Fv.Lo(r,n.Bo,n.Mo),[4,this.Xv(n.qo)];case 2:t.sent(),t.label=3;case 3:return[4,this.Rv.bd()];case 4:return t.sent(),[2]}})})},ip.prototype.yd=function(a){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,u=this;return v(this,function(t){switch(t.label){case 0:return!0!==a||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Rv.yd(!0)]);case 1:return t.sent(),o=this.Fv.Ld(),[4,this.ow(o.tt())];case 2:for(e=t.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Rv.listen(i);return[3,7];case 3:return!1!==a||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),fi(this.xv,function(t,e){u.Fv.Hd(t)?o.push(t):s=s.then(function(){return u.Jv(t),u.zh.dh(t,!0)}),u.Rv.nd(t)}),[4,s]);case 4:return t.sent(),[4,this.ow(o)];case 5:return t.sent(),this.hw(),[4,this.Rv.yd(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},ip.prototype.hw=function(){var e=this;fi(this.Lv,function(t){e.Rv.nd(t)}),this.qv.ku(),this.Lv=[],this.jv=new ji(Gi.G)},ip.prototype.ow=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.xv[o])&&0!==u.length?[4,this.zh.dh(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.zh.hh(u[0].Yn())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],Fr(!!(f=this.Uv.get(c)),"No query view found for "+c),[4,this.Kv(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return Fr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.zh.Th(o)];case 9:return Fr(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.zh.hh(p)];case 10:return s=t.sent(),[4,this.zv(this.cw(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return this.Vv.kf(n),[2,e]}})})},ip.prototype.cw=function(t){return new ru(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},ip.prototype.gh=function(){return this.zh.gh()},ip.prototype.hv=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(this.isPrimary)return _r("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.xv[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.zh.Eh()];case 2:return e=t.sent(),n=ra.Pi(r,"current"===i),[4,this.Xv(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.zh.dh(r,!0)];case 5:return t.sent(),this.Jv(r,o),[3,7];case 6:qr("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},ip.prototype.cv=function(f,l){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c=this;return v(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=f,t.label=1;case 1:return e<n.length?(h=n[e],Fr(!this.xv[h],"Trying to add an already active target"),[4,this.zh.Th(h)]):[3,6];case 2:return Fr(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.zh.hh(r)];case 3:return i=t.sent(),[4,this.zv(this.cw(r),i.targetId,!1)];case 4:t.sent(),this.Rv.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return v(this,function(t){switch(t.label){case 0:return s.xv[e]?[4,s.zh.dh(e,!1).then(function(){c.Rv.nd(e),c.Jv(e)}).catch(Lh)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,u=0,a=l,t.label=7;case 7:return u<a.length?(h=a[u],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},ip.prototype.enableNetwork=function(){return this.zh.yh(!0),this.Rv.enableNetwork()},ip.prototype.disableNetwork=function(){return this.zh.yh(!1),this.Rv.disableNetwork()},ip.prototype.be=function(t){var e=this.Lv[t];if(e&&e.Ov)return Yu().add(e.key);var n=Yu(),r=this.xv[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.Uv.get(s);Fr(!!u,"No query view found for "+s),n=n.Mt(u.view.mv)}return n},ip),Yl=(rp.prototype.listen=function(t){var e=t.query,n=!1,r=this.fw.get(e);return r||(n=!0,r=new zl,this.fw.set(e,r)),r.listeners.push(t),Fr(!t.Tv(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.aw&&t.dw(r.aw)&&this.vw(),n?this.rd.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},rp.prototype.nd=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.fw.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.fw.delete(e),[2,this.rd.nd(e)]):[2]})})},rp.prototype.kf=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.fw.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].dw(i)&&(e=!0);s.aw=i}}e&&this.vw()},rp.prototype.ew=function(t,e){var n=this.fw.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.fw.delete(t)},rp.prototype.$v=function(i){this.onlineState=i;var o=!1;this.fw.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Tv(i)&&(o=!0)}),o&&this.vw()},rp.prototype.ww=function(t){this.lw.add(t),t.next()},rp.prototype.mw=function(t){this.lw.delete(t)},rp.prototype.vw=function(){this.lw.forEach(function(t){t.next()})},rp),Kl=(np.prototype.dw=function(t){if(Fr(0<t.docChanges.length||t.Ti,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new na(t.query,t.docs,t._i,e,t.Ii,t.fromCache,t.Ti,!0)}var o=!1;return this.gw?this.yw(t)&&(this.pw.next(t),o=!0):this._w(t,this.onlineState)&&(this.Iw(t),o=!0),this.bw=t,o},np.prototype.onError=function(t){this.pw.error(t)},np.prototype.Tv=function(t){this.onlineState=t;var e=!1;return this.bw&&!this.gw&&this._w(this.bw,t)&&(this.Iw(this.bw),e=!0),e},np.prototype._w=function(t,e){if(Fr(!this.gw,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n="Offline"!==e;return this.options.Tw&&n?(Fr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.J()||"Offline"===e},np.prototype.yw=function(t){if(0<t.docChanges.length)return!0;var e=this.bw&&this.bw.hasPendingWrites!==t.hasPendingWrites;return!(!t.Ti&&!e)&&!0===this.options.includeMetadataChanges},np.prototype.Iw=function(t){Fr(!this.gw,"Trying to raise initial events for second time"),t=na.Di(t.query,t.docs,t.Ii,t.fromCache),this.gw=!0,this.pw.next(t)},np),Jl=(ep.prototype.Xc=function(){return Mh.jh(this.cacheSizeBytes)},ep),Xl=(tp.prototype.start=function(t){var n=this;this.Dw();var r=new Ra,i=new Ra,o=!1;return this.credentials.T(function(e){o?n.Qr.$r(function(){return n.bd(e)}):(o=!0,n.Sw(t,i,e).then(function(t){return n.Rw(e,t)}).then(r.resolve,r.reject))}),this.Qr.$r(function(){return r.promise}),i.promise},tp.prototype.enableNetwork=function(){var t=this;return this.Dw(),this.Qr.enqueue(function(){return t.rd.enableNetwork()})},tp.prototype.Sw=function(t,e,n){var r=this;return t instanceof Jl?this.Cw(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.Aw(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.Pw()}):(e.resolve(),this.Pw())},tp.prototype.Aw=function(t){return t instanceof Xr?t.code===Jr.FAILED_PRECONDITION||t.code===Jr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},tp.prototype.Dw=function(){if(this.Qr.uu)throw new Xr(Jr.FAILED_PRECONDITION,"The client has already been terminated.")},tp.prototype.Cw=function(r,i){var t=this,o=Wc.Ia(this.Ew),s=new Ta(this.Ew.s,{Te:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!Ol.cs(this.platform))throw new Xr(Jr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.Xc(),this.Fv=i.synchronizeTabs?new Ol(this.Qr,this.platform,o,this.clientId,r):new ql,[4,Wc.Yc({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,Lc:this.Qr,serializer:s,Xc:e,qc:this.Fv})];case 1:return n=t.sent(),[2,(this.persistence=n).As.Wh]}})})})},tp.prototype.Pw=function(){return this.persistence=ff.Wa(this.clientId),this.Fv=new ql,Promise.resolve(null)},tp.prototype.Rw=function(h,c){var t=this;return _r("FirestoreClient","Initializing. user=",h.uid),this.platform.kw(this.Ew).then(function(a){return p(t,void 0,void 0,function(){var e,n,r,i,o,s,u=this;return v(this,function(t){switch(t.label){case 0:return e=new tf,this.zh=new kh(this.persistence,e,h),[4,this.zh.start()];case 1:return t.sent(),c&&(this.Nw=new qh(c,this.Qr,this.zh)),n=this.platform.Ow(),r=this.platform.Fw(this.Ew.s),i=new wf(this.Qr,a,this.credentials,r),o=function(t){return u.rd.Tv(t,0)},s=function(t){return u.rd.Tv(t,1)},this.Rv=new ml(this.zh,i,this.Qr,o,n),this.rd=new Ql(this.zh,this.Rv,this.Fv,h),this.Fv.El=s,this.Rv.rd=this.rd,this.Fv.rd=this.rd,this.Vw=new Yl(this.rd),[4,this.Fv.start()];case 2:return t.sent(),[4,this.Rv.start()];case 3:return t.sent(),[4,this.persistence.ra(function(e){return p(u,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.rd.yd(e)];case 1:return t.sent(),this.Nw&&(e&&!this.Nw.Co?this.Nw.start():e||this.Nw.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.ua(function(){return p(u,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},tp.prototype.bd=function(t){return this.Qr.du(),_r("FirestoreClient","Credential Changed. Current user: "+t.uid),this.rd.bd(t)},tp.prototype.disableNetwork=function(){var t=this;return this.Dw(),this.Qr.enqueue(function(){return t.rd.disableNetwork()})},tp.prototype.terminate=function(){var t=this;return this.Qr.au(function(){return p(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Nw&&this.Nw.stop(),[4,this.Rv.shutdown()];case 1:return t.sent(),[4,this.Fv.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.D(),[2]}})})})},tp.prototype.waitForPendingWrites=function(){var t=this;this.Dw();var e=new Ra;return this.Qr.$r(function(){return t.rd.nw(e)}),e.promise},tp.prototype.listen=function(t,e,n){var r=this;this.Dw();var i=new Kl(t,e,n);return this.Qr.$r(function(){return r.Vw.listen(i)}),i},tp.prototype.nd=function(t){var e=this;this.Uw||this.Qr.$r(function(){return e.Vw.nd(t)})},tp.prototype.xw=function(t){var e=this;return this.Dw(),this.Qr.enqueue(function(){return e.zh.oh(t)}).then(function(t){if(t instanceof Ss)return t;if(t instanceof Ds)return null;throw new Xr(Jr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},tp.prototype.jw=function(i){var t=this;return this.Dw(),this.Qr.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.zh.vh(i,!0)];case 1:return e=t.sent(),n=new Fl(i,e.mh),r=n.pv(e.documents),[2,n.es(r,!1).snapshot]}})})})},tp.prototype.write=function(t){var e=this;this.Dw();var n=new Ra;return this.Qr.$r(function(){return e.rd.write(t,n)}),n.promise},tp.prototype.s=function(){return this.Ew.s},tp.prototype.ww=function(t){var e=this;this.Dw(),this.Qr.$r(function(){return e.Vw.ww(t),Promise.resolve()})},tp.prototype.mw=function(t){this.Uw||this.Vw.mw(t)},Object.defineProperty(tp.prototype,"Uw",{get:function(){return this.Qr.uu},enumerable:!0,configurable:!0}),tp.prototype.transaction=function(t){var e=this;this.Dw();var n=new Ra;return this.Qr.$r(function(){return e.rd.runTransaction(e.Qr,t,n),Promise.resolve()}),n.promise},tp),$l=(Zl.prototype.next=function(t){this.Lw(this.observer.next,t)},Zl.prototype.error=function(t){this.Lw(this.observer.error,t)},Zl.prototype.qw=function(){this.muted=!0},Zl.prototype.Lw=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Zl);function Zl(t){this.observer=t,this.muted=!1}function tp(t,e,n,r){this.platform=t,this.Ew=e,this.credentials=n,this.Qr=r,this.clientId=Vr.u()}function ep(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}function np(t,e,n){this.query=t,this.pw=e,this.gw=!1,this.bw=null,this.onlineState="Unknown",this.options=n||{}}function rp(t){this.rd=t,this.fw=new Ya(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.lw=new Set,this.rd.subscribe(this)}function ip(t,e,n,r){this.zh=t,this.Rv=e,this.Fv=n,this.currentUser=r,this.Vv=null,this.Uv=new Ya(function(t){return t.canonicalId()}),this.xv={},this.jv=new ji(Gi.G),this.Lv={},this.qv=new Wa,this.Bv={},this.Mv=new Map,this.Qv=Ah.uo(),this.isPrimary=void 0,this.onlineState="Unknown"}function op(t,e,n,r){this.Qr=t,this.Rv=e,this.updateFunction=n,this.Kr=r,this.Cv=5,this.vf=new vf(this.Qr,"retry_transaction")}function sp(i){return function(){if("object"!=typeof i||null===i)return!1;for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}()}var up,ap=Mh.Bh,hp=(kp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},kp),cp=(Dp.prototype.settings=function(t){if(vi("Firestore.settings",arguments,1),gi("Firestore.settings","object",1,t),hi(t,"persistence"))throw new Xr(Jr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new hp(t);if(this.Gw&&!this.Jw.isEqual(e))throw new Xr(Jr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Jw=e).credentials&&(this.Hw=function(t){if(!t)return new $r;switch(t.type){case"gapi":var e=t.O;return Fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ei(e,t.k||"0");case"provider":return t.O;default:throw new Xr(Jr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Dp.prototype.enableNetwork=function(){return this.Qw(),this.Gw.enableNetwork()},Dp.prototype.disableNetwork=function(){return this.Qw(),this.Gw.disableNetwork()},Dp.prototype.enablePersistence=function(t){if(this.Gw)throw new Xr(Jr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Ur("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=ci(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.$w(new Jl(this.Jw.cacheSizeBytes,e))},Dp.prototype.clearPersistence=function(){var t=this,n=Wc.Ia(this.Zw()),r=new Ra;return this.Mw.su(function(){return p(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this.Gw&&!this.Gw.Uw)throw new Xr(Jr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Wc.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},Dp.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Dp.prototype,"tm",{get:function(){return this.Qw(),this.Gw.Uw},enumerable:!0,configurable:!0}),Dp.prototype.waitForPendingWrites=function(){return this.Qw(),this.Gw.waitForPendingWrites()},Dp.prototype.onSnapshotsInSync=function(t){if(this.Qw(),sp(t))return this.nm(t);gi("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.nm(e)},Dp.prototype.nm=function(t){var e=this,n=new $l({next:function(){t.next&&t.next()},error:function(t){throw qr("Uncaught Error in onSnapshotsInSync")}});return this.Gw.ww(n),function(){n.qw(),e.Gw.mw(n)}},Dp.prototype.Qw=function(){return this.Gw||this.$w(new Hl),this.Gw},Dp.prototype.Zw=function(){return new Hr(this.Ww,this.Kw,this.Jw.host,this.Jw.ssl,this.Jw.forceLongPolling)},Dp.prototype.$w=function(t){Fr(!!this.Jw.host,"FirestoreSettings.host is not set"),Fr(!this.Gw,"configureClient() called multiple times");var e=this.Zw();return this.Gw=new Xl(Na.t(),e,this.Hw,this.Mw),this.Gw.start(t)},Dp.prototype.Xw=function(r){return new ul(function(t){if(t instanceof pp){var e=r,n=t.firestore.Ww;if(!n.isEqual(e))throw new Xr(Jr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new sl(r,t.im)}return t})},Dp.zw=function(t){var e=t.options;if(!hi(e,"projectId"))throw new Xr(Jr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Xr(Jr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Yr(n)},Object.defineProperty(Dp.prototype,"app",{get:function(){if(!this.Bw)throw new Xr(Jr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Bw},enumerable:!0,configurable:!0}),Dp.prototype.collection=function(t){return vi("Firestore.collection",arguments,1),gi("Firestore.collection","non-empty string",1,t),this.Qw(),new Rp(qi.it(t),this)},Dp.prototype.doc=function(t){return vi("Firestore.doc",arguments,1),gi("Firestore.doc","non-empty string",1,t),this.Qw(),pp.em(qi.it(t),this)},Dp.prototype.collectionGroup=function(t){if(vi("Firestore.collectionGroup",arguments,1),gi("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Qw(),new mp(new ru(qi.et,t),this)},Dp.prototype.runTransaction=function(e){var n=this;return vi("Firestore.runTransaction",arguments,1),gi("Firestore.runTransaction","function",1,e),this.Qw().transaction(function(t){return e(new fp(n,t))})},Dp.prototype.batch=function(){return this.Qw(),new lp(this)},Object.defineProperty(Dp,"logLevel",{get:function(){switch(Lr()){case 0:return"debug";case 1:return"error";case 2:return"silent";default:return qr("Unknown log level: "+Lr())}},enumerable:!0,configurable:!0}),Dp.setLogLevel=function(t){switch(vi("Firestore.setLogLevel",arguments,1),gi("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Pr(0);break;case"error":Pr(1);break;case"silent":Pr(2);break;default:throw new Xr(Jr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Dp.prototype.rm=function(){return this.Jw.timestampsInSnapshots},Dp),fp=(Sp.prototype.get=function(t){var n=this;vi("Transaction.get",arguments,1);var r=_p("Transaction.get",t,this.um);return this.sm.lookup([r.im]).then(function(t){if(!t||1!==t.length)return qr("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Ds)return new vp(n.um,r.im,null,!1,!1,r.om);if(e instanceof Ss)return new vp(n.um,r.im,e,!1,!1,r.om);throw qr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},Sp.prototype.set=function(t,e,n){mi("Transaction.set",arguments,2,3);var r=_p("Transaction.set",t,this.um);n=xp("Transaction.set",n);var i=Up(r.om,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.um.Yw.sl(s,o,n.mergeFields):this.um.Yw.rl(s,o);return this.sm.set(r.im,u),this},Sp.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof bf?(yi("Transaction.update",arguments,3),r=_p("Transaction.update",t,this.um),this.um.Yw.cl("Transaction.update",e,n,o)):(vi("Transaction.update",arguments,2),r=_p("Transaction.update",t,this.um),this.um.Yw.ol("Transaction.update",e)),this.sm.update(r.im,i),this},Sp.prototype.delete=function(t){vi("Transaction.delete",arguments,1);var e=_p("Transaction.delete",t,this.um);return this.sm.delete(e.im),this},Sp),lp=(Ap.prototype.set=function(t,e,n){mi("WriteBatch.set",arguments,2,3),this.am();var r=_p("WriteBatch.set",t,this.um);n=xp("WriteBatch.set",n);var i=Up(r.om,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.um.Yw.sl(s,o,n.mergeFields):this.um.Yw.rl(s,o);return this.hm=this.hm.concat(u.Hf(r.im,ko.NONE)),this},Ap.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.am(),i="string"==typeof e||e instanceof bf?(yi("WriteBatch.update",arguments,3),r=_p("WriteBatch.update",t,this.um),this.um.Yw.cl("WriteBatch.update",e,n,o)):(vi("WriteBatch.update",arguments,2),r=_p("WriteBatch.update",t,this.um),this.um.Yw.ol("WriteBatch.update",e)),this.hm=this.hm.concat(i.Hf(r.im,ko.exists(!0))),this},Ap.prototype.delete=function(t){vi("WriteBatch.delete",arguments,1),this.am();var e=_p("WriteBatch.delete",t,this.um);return this.hm=this.hm.concat(new Lo(e.im,ko.NONE)),this},Ap.prototype.commit=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return this.am(),this.cm=!0,0<this.hm.length?[2,this.um.Qw().write(this.hm)]:[2]})})},Ap.prototype.am=function(){if(this.cm)throw new Xr(Jr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Ap),pp=(Np.em=function(t,e,n){if(t.length%2!=0)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.nt()+" has "+t.length);return new Np(new Gi(t),e,n)},Object.defineProperty(Np.prototype,"id",{get:function(){return this.im.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(Np.prototype,"parent",{get:function(){return new Rp(this.im.path.H(),this.firestore,this.om)},enumerable:!0,configurable:!0}),Object.defineProperty(Np.prototype,"path",{get:function(){return this.im.path.nt()},enumerable:!0,configurable:!0}),Np.prototype.collection=function(t){if(vi("DocumentReference.collection",arguments,1),gi("DocumentReference.collection","non-empty string",1,t),!t)throw new Xr(Jr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=qi.it(t);return new Rp(this.im.path.child(e),this.firestore)},Np.prototype.isEqual=function(t){if(!(t instanceof Np))throw ki("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.im.isEqual(t.im)&&this.om===t.om},Np.prototype.set=function(t,e){mi("DocumentReference.set",arguments,1,2),e=xp("DocumentReference.set",e);var n=Up(this.om,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.Yw.sl(i,r,e.mergeFields):this.firestore.Yw.rl(i,r);return this.Gw.write(o.Hf(this.im,ko.NONE))},Np.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof bf?(yi("DocumentReference.update",arguments,2),this.firestore.Yw.cl("DocumentReference.update",t,e,r)):(vi("DocumentReference.update",arguments,1),this.firestore.Yw.ol("DocumentReference.update",t)),this.Gw.write(n.Hf(this.im,ko.exists(!0)))},Np.prototype.delete=function(){return vi("DocumentReference.delete",arguments,0),this.Gw.write([new Lo(this.im,ko.NONE)])},Np.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mi("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||sp(t[i])||(Di("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ei("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=sp(t[i])?t[i]:(gi("DocumentReference.onSnapshot","function",i,t[i]),wi("DocumentReference.onSnapshot","function",i+1,t[i+1]),wi("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.fm(o,n)},Np.prototype.fm=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new $l({next:function(t){if(n.next){Fr(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r.im);n.next(new vp(r.firestore,r.im,e,t.fromCache,t.hasPendingWrites,r.om))}},error:e}),o=this.Gw.listen(ru.jn(this.im.path),i,t);return function(){i.qw(),r.Gw.nd(o)}},Np.prototype.get=function(n){var r=this;return mi("DocumentReference.get",arguments,0,1),Pp("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Qw().xw(r.im).then(function(t){e(new vp(r.firestore,r.im,t,!0,t instanceof Ss&&t.en,r.om))},t):r.lm(e,t,n)})},Np.prototype.lm=function(e,n,r){var i=this.fm({includeMetadataChanges:!0,Tw:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Xr(Jr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Xr(Jr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},Np.prototype.withConverter=function(t){return new Np(this.im,this.firestore,t)},Np),dp=(Tp.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Tp),vp=(Ip.prototype.data=function(t){if(mi("DocumentSnapshot.data",arguments,0,1),t=Lp("DocumentSnapshot.data",t),this.dm){if(this.om){var e=new yp(this.um,this.im,this.dm,this.vm,this.wm);return this.om.fromFirestore(e,t)}return this.mm(this.dm.data(),_o.mn(t,this.um.rm()))}},Ip.prototype.get=function(t,e){if(mi("DocumentSnapshot.get",arguments,1,2),e=Lp("DocumentSnapshot.get",e),this.dm){var n=this.dm.data().field(ll("DocumentSnapshot.get",t));if(null!==n)return this.pm(n,_o.mn(e,this.um.rm()))}},Object.defineProperty(Ip.prototype,"id",{get:function(){return this.im.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(Ip.prototype,"ref",{get:function(){return new pp(this.im,this.um,this.om)},enumerable:!0,configurable:!0}),Object.defineProperty(Ip.prototype,"exists",{get:function(){return null!==this.dm},enumerable:!0,configurable:!0}),Object.defineProperty(Ip.prototype,"metadata",{get:function(){return new dp(this.wm,this.vm)},enumerable:!0,configurable:!0}),Ip.prototype.isEqual=function(t){if(!(t instanceof Ip))throw ki("isEqual","DocumentSnapshot",1,t);return this.um===t.um&&this.vm===t.vm&&this.im.isEqual(t.im)&&(null===this.dm?null===t.dm:this.dm.isEqual(t.dm))&&this.om===t.om},Ip.prototype.mm=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.pm(e,n)}),i},Ip.prototype.pm=function(t,e){if(t instanceof Is)return this.mm(t,e);if(t instanceof Ns)return this.gm(t,e);if(t instanceof bs){var n=t.value(e),r=this.um.Qw().s();return t.s.isEqual(r)||Ur("Document "+this.im.path+" contains a document reference within a different database ("+t.s.projectId+"/"+t.s.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new pp(n,this.um,this.om)}return t.value(e)},Ip.prototype.gm=function(t,e){var n=this;return t.Ht.map(function(t){return n.pm(t,e)})},Ip),yp=(t(Ep,up=vp),Ep.prototype.data=function(t){var e=up.prototype.data.call(this,t);return Fr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},Ep),mp=(bp.prototype.where=function(t,e,n){var r;vi("Query.where",arguments,3),Si("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid value "+Ai(r)+" provided to function "+t+"() for its "+Ri(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=ll("Query.where",t),o=iu.it(e);if(i.ut()){if(o===iu.ARRAY_CONTAINS||o===iu.ARRAY_CONTAINS_ANY)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===iu.IN){this.ym(n,o);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this._m(h))}r=new Ns(s)}else r=this._m(n)}else o!==iu.IN&&o!==iu.ARRAY_CONTAINS_ANY||this.ym(n,o),r=this.firestore.Yw.al("Query.where",n,o===iu.IN);var c=ou.create(i,o,r);return this.Im(c),new bp(this.bm.Bn(c),this.firestore,this.om)},bp.prototype.orderBy=function(t,e){var n;if(mi("Query.orderBy",arguments,1,2),wi("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=fu.ASCENDING;else{if("desc"!==e)throw new Xr(Jr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=fu.DESCENDING}if(null!==this.bm.startAt)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.bm.endAt)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=ll("Query.orderBy",t),i=new pu(r,n);return this.Tm(i),new bp(this.bm.Qn(i),this.firestore,this.om)},bp.prototype.limit=function(t){return vi("Query.limit",arguments,1),gi("Query.limit","number",1,t),Oi("Query.limit",1,t),new bp(this.bm.Gn(t),this.firestore,this.om)},bp.prototype.limitToLast=function(t){return vi("Query.limitToLast",arguments,1),gi("Query.limitToLast","number",1,t),Oi("Query.limitToLast",1,t),new bp(this.bm.Wn(t),this.firestore,this.om)},bp.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];yi("Query.startAt",arguments,1);var r=this.Em("Query.startAt",t,e,!0);return new bp(this.bm.zn(r),this.firestore,this.om)},bp.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];yi("Query.startAfter",arguments,1);var r=this.Em("Query.startAfter",t,e,!1);return new bp(this.bm.zn(r),this.firestore,this.om)},bp.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];yi("Query.endBefore",arguments,1);var r=this.Em("Query.endBefore",t,e,!0);return new bp(this.bm.Kn(r),this.firestore,this.om)},bp.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];yi("Query.endAt",arguments,1);var r=this.Em("Query.endAt",t,e,!1);return new bp(this.bm.Kn(r),this.firestore,this.om)},bp.prototype.isEqual=function(t){if(!(t instanceof bp))throw ki("isEqual","Query",1,t);return this.firestore===t.firestore&&this.bm.isEqual(t.bm)},bp.prototype.withConverter=function(t){return new bp(this.bm,this.firestore,t)},bp.prototype.Em=function(t,e,n,r){if(Si(t,1,e),e instanceof vp){if(0<n.length)throw new Xr(Jr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Xr(Jr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Dm(t,i.dm,r)}var o=[e].concat(n);return this.Sm(t,o,r)},bp.prototype.Dm=function(t,e,n){for(var r=[],i=0,o=this.bm.orderBy;i<o.length;i++){var s=o[i];if(s.field.ut())r.push(new bs(this.firestore.Ww,e.key));else{var u=e.field(s.field);if(u instanceof gs)throw new Xr(Jr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var a=s.field.nt();throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}r.push(u)}}return new lu(r,n)},bp.prototype.Sm=function(t,e,n){var r=this.bm.On;if(e.length>r.length)throw new Xr(Jr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.ut()){if("string"!=typeof s)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.bm.ui()&&-1!==s.indexOf("/"))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.bm.path.child(qi.it(s));if(!Gi.ht(u))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Gi(u);i.push(new bs(this.firestore.Ww,a))}else{var h=this.firestore.Yw.al(t,s);i.push(h)}}return new lu(i,n)},bp.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mi("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||sp(t[i])||(Di("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ei("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=sp(t[i])?t[i]:(gi("Query.onSnapshot","function",i,t[i]),wi("Query.onSnapshot","function",i+1,t[i+1]),wi("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Rm(this.bm),this.fm(r,n)},bp.prototype.fm=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new $l({next:function(t){e.next&&e.next(new gp(n.firestore,n.bm,t,n.om))},error:r}),o=this.firestore.Qw(),s=o.listen(this.bm,i,t);return function(){i.qw(),o.nd(s)}},bp.prototype.Rm=function(t){if(t.ei()&&0===t.On.length)throw new Xr(Jr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},bp.prototype.get=function(n){var r=this;return mi("Query.get",arguments,0,1),Pp("Query.get",n),this.Rm(this.bm),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Qw().jw(r.bm).then(function(t){e(new gp(r.firestore,r.bm,t,r.om))},t):r.lm(e,t,n)})},bp.prototype.lm=function(e,n,r){var i=this.fm({includeMetadataChanges:!0,Tw:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Xr(Jr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},bp.prototype._m=function(t){if("string"==typeof t){if(""===t)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.bm.ui()&&-1!==t.indexOf("/"))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.bm.path.child(qi.it(t));if(!Gi.ht(e))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new bs(this.firestore.Ww,new Gi(e))}if(t instanceof pp){var n=t;return new bs(this.firestore.Ww,n.im)}throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ai(t)+".")},bp.prototype.ym=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},bp.prototype.Im=function(t){if(t instanceof ou){var e=[iu.ARRAY_CONTAINS,iu.ARRAY_CONTAINS_ANY],n=[iu.IN,iu.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.Mn()){var o=this.bm.Ln();if(null!==o&&!o.isEqual(t.field))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.bm.qn();null!==s&&this.Cm(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.bm.ri(n)),null===u&&r&&(u=this.bm.ri(e)),null!=u)throw u===t.op?new Xr(Jr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Xr(Jr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},bp.prototype.Tm=function(t){if(null===this.bm.qn()){var e=this.bm.Ln();null!==e&&this.Cm(e,t.field)}},bp.prototype.Cm=function(t,e){if(!e.isEqual(t))throw new Xr(Jr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},bp),gp=(Object.defineProperty(wp.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(wp.prototype,"empty",{get:function(){return this.Pm.docs.J()},enumerable:!0,configurable:!0}),Object.defineProperty(wp.prototype,"size",{get:function(){return this.Pm.docs.size},enumerable:!0,configurable:!0}),wp.prototype.forEach=function(e,n){var r=this;mi("QuerySnapshot.forEach",arguments,1,2),gi("QuerySnapshot.forEach","function",1,e),this.Pm.docs.forEach(function(t){e.call(n,r.Om(t))})},Object.defineProperty(wp.prototype,"query",{get:function(){return new mp(this.Am,this.um,this.om)},enumerable:!0,configurable:!0}),wp.prototype.docChanges=function(t){t&&(Di("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ei("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Pm.Ei)throw new Xr(Jr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.km&&this.Nm===e||(this.km=function(i,e,o,s){if(o._i.J()){var n,r=0;return o.docChanges.map(function(t){var e=new yp(i,t.doc.key,t.doc,o.fromCache,o.Ii.has(t.doc.key),s);return Fr(0===t.type,"Invalid event type for first snapshot"),Fr(!n||o.query.Xn(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var u=o._i;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new yp(i,t.doc.key,t.doc,o.fromCache,o.Ii.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(Fr(0<=(n=u.indexOf(t.doc.key)),"Index for document not found"),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return qr("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.um,e,this.Pm,this.om),this.Nm=e),this.km},wp.prototype.isEqual=function(t){if(!(t instanceof wp))throw ki("isEqual","QuerySnapshot",1,t);return this.um===t.um&&this.Am.isEqual(t.Am)&&this.Pm.isEqual(t.Pm)&&this.om===t.om},wp.prototype.Om=function(t){return new yp(this.um,t.key,t,this.metadata.fromCache,this.Pm.Ii.has(t.key),this.om)},wp);function wp(t,e,n,r){this.um=t,this.Am=e,this.Pm=n,this.om=r,this.km=null,this.Nm=null,this.metadata=new dp(n.hasPendingWrites,n.fromCache)}function bp(t,e,n){this.bm=t,this.firestore=e,this.om=n}function Ep(){return null!==up&&up.apply(this,arguments)||this}function Ip(t,e,n,r,i,o){this.um=t,this.im=e,this.dm=n,this.vm=r,this.wm=i,this.om=o}function Tp(t,e){this.hasPendingWrites=t,this.fromCache=e}function Np(t,e,n){this.im=t,this.firestore=e,this.om=n,this.Gw=this.firestore.Qw()}function Ap(t){this.um=t,this.hm=[],this.cm=!1}function Sp(t,e){this.um=t,this.sm=e}function Dp(t,e){var n=this;if(this.Bw=null,this.Mw=new _a,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Qw(),[4,this.Gw.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.Bw=r,this.Ww=Dp.zw(r),this.Kw=r.name,this.Hw=new Zr(e)}else{var i=t;if(!i.projectId)throw new Xr(Jr.INVALID_ARGUMENT,"Must provide projectId");this.Ww=new Yr(i.projectId,i.database),this.Kw="[DEFAULT]",this.Hw=new $r}this.Jw=new hp({}),this.Yw=this.Xw(this.Ww)}function kp(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Xr(Jr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else bi("settings","non-empty string","host",t.host),this.host=t.host,Ei("settings","boolean","ssl",t.ssl),this.ssl=ci(t.ssl,!0);if(Di("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ei("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ei("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Ur("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Ur("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=ci(t.timestampsInSnapshots,!0),Ei("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Mh.Qh;else{if(t.cacheSizeBytes!==ap&&t.cacheSizeBytes<Mh.Mh)throw new Xr(Jr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Mh.Mh);this.cacheSizeBytes=t.cacheSizeBytes}Ei("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}s(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(gp.prototype.docChanges,t,{get:function(){return function(){throw new Xr(Jr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Op,Rp=(t(Cp,Op=mp),Object.defineProperty(Cp.prototype,"id",{get:function(){return this.bm.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(Cp.prototype,"parent",{get:function(){var t=this.bm.path.H();return t.J()?null:new pp(new Gi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(Cp.prototype,"path",{get:function(){return this.bm.path.nt()},enumerable:!0,configurable:!0}),Cp.prototype.doc=function(t){if(mi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Vr.u()),gi("CollectionReference.doc","non-empty string",1,t),""===t)throw new Xr(Jr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=qi.it(t);return pp.em(this.bm.path.child(e),this.firestore,this.om)},Cp.prototype.add=function(t){vi("CollectionReference.add",arguments,1),gi("CollectionReference.add","object",1,this.om?this.om.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Cp.prototype.withConverter=function(t){return new Cp(this.Fm,this.firestore,t)},Cp);function Cp(t,e,n){var r=Op.call(this,ru.jn(t),e,n)||this;if((r.Fm=t).length%2!=1)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.nt()+" has "+t.length);return r}function xp(t,e){if(void 0===e)return{merge:!1};if(Di(t,e,["merge","mergeFields"]),Ei(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ai(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Xr(Jr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Ai(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof bf}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Xr(Jr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Lp(t,e){return void 0===e?{}:(Di(t,e,["serverTimestamps"]),Ii(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Pp(t,e){wi(t,"object",1,e),e&&(Di(t,e,["source"]),Ii(t,0,"source",e.source,["default","server","cache"]))}function _p(t,e,n){if(e instanceof pp){if(e.firestore!==n)throw new Xr(Jr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw ki(t,"DocumentReference",1,e)}function Up(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Mp=Da(cp,"Use firebase.firestore() instead."),qp=Da(fp,"Use firebase.firestore().runTransaction() instead."),Fp=Da(lp,"Use firebase.firestore().batch() instead."),Vp=Da(pp,"Use firebase.firestore().doc() instead."),Gp=Da(vp),jp=Da(yp),Bp=Da(mp),zp=Da(gp),Hp=Da(Rp,"Use firebase.firestore().collection() instead."),Wp={Firestore:Mp,GeoPoint:Pi,Timestamp:_i,Blob:xa,Transaction:qp,WriteBatch:Fp,DocumentReference:Vp,DocumentSnapshot:Gp,Query:Bp,QueryDocumentSnapshot:jp,QuerySnapshot:zp,CollectionReference:Hp,FieldPath:bf,FieldValue:Wf,setLogLevel:cp.setLogLevel,CACHE_SIZE_UNLIMITED:ap};var Qp,Yp,Kp=(sd.prototype.xl=function(t){},sd.prototype.shutdown=function(){},sd),Jp=(od.prototype.xl=function(t){this.Lm.push(t)},od.prototype.shutdown=function(){window.removeEventListener("online",this.Vm),window.removeEventListener("offline",this.xm)},od.prototype.qm=function(){window.addEventListener("online",this.Vm),window.addEventListener("offline",this.xm)},od.prototype.Um=function(){_r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Lm;t<e.length;t++)(0,e[t])(0)},od.prototype.jm=function(){_r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Lm;t<e.length;t++)(0,e[t])(1)},od.cs=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},od),Xp=(id.prototype.Af=function(t){Fr(!this.Qm,"Called onOpen on stream twice!"),this.Qm=t},id.prototype.Ef=function(t){Fr(!this.Gm,"Called onClose on stream twice!"),this.Gm=t},id.prototype.onMessage=function(t){Fr(!this.Wm,"Called onMessage on stream twice!"),this.Wm=t},id.prototype.close=function(){this.Mm()},id.prototype.send=function(t){this.Bm(t)},id.prototype.zm=function(){Fr(void 0!==this.Qm,"Cannot call onOpen because no callback was set"),this.Qm()},id.prototype.Km=function(t){Fr(void 0!==this.Gm,"Cannot call onClose because no callback was set"),this.Gm(t)},id.prototype.Hm=function(t){Fr(void 0!==this.Wm,"Cannot call onMessage because no callback was set"),this.Wm(t)},id),$p={BatchGetDocuments:"batchGet",Commit:"commit"},Zp="gl-js/ fire/"+Cr,td=(rd.prototype.Ym=function(t,e){if(e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n]);t["X-Goog-Api-Client"]=Zp},rd.prototype.Bf=function(a,r,i){var h=this,c=this.Xm(a);return new Promise(function(o,s){var u=new Rr;u.listenOnce(kr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Dr.NO_ERROR:var t=u.getResponseJson();_r("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Dr.TIMEOUT:_r("Connection",'RPC "'+a+'" timed out'),s(new Xr(Jr.DEADLINE_EXCEEDED,"Request time out"));break;case Dr.HTTP_ERROR:var e=u.getStatus();if(_r("Connection",'RPC "'+a+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Jr).indexOf(i)?i:Jr.UNKNOWN);s(new Xr(r,n.message))}else s(new Xr(Jr.UNKNOWN,"Server responded with status "+u.getStatus()))}else _r("Connection",'RPC "'+a+'" failed'),s(new Xr(Jr.UNAVAILABLE,"Connection failed."));break;default:qr('RPC "'+a+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{_r("Connection",'RPC "'+a+'" completed.')}var i});var t=f({},r);delete t.database;var e=JSON.stringify(t);_r("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Ym(n,i),u.send(c,"POST",e,n,15)})},rd.prototype.Mf=function(t,e,n){return this.Bf(t,e,n)},rd.prototype.Pf=function(t,e){var n=[this.Jm,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Sr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Ym(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||function(){var t=l();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=l().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}_r("Connection","Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),u=!1,h=!1,c=new Xp({Bm:function(t){h?_r("Connection","Not sending because WebChannel is closed:",t):(u||(_r("Connection","Opening WebChannel transport."),a.open(),u=!0),_r("Connection","WebChannel sending:",t),a.send(t))},Mm:function(){return a.close()}});return s(Or.EventType.OPEN,function(){h||_r("Connection","WebChannel transport opened.")}),s(Or.EventType.CLOSE,function(){h||(h=!0,_r("Connection","WebChannel transport closed"),c.Km())}),s(Or.EventType.ERROR,function(t){h||(h=!0,_r("Connection","WebChannel transport errored:",t),c.Km(new Xr(Jr.UNAVAILABLE,"The operation could not be completed")))}),s(Or.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];Fr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){_r("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=xu[o];if(void 0!==t)return Fu(t)}(),u=i.message;void 0===s&&(s=Jr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),h=!0,c.Km(new Xr(s,u)),a.close()}else _r("Connection","WebChannel received:",n),c.Hm(n)}}),setTimeout(function(){c.zm()},0),c},rd.prototype.Xm=function(t){var e=$p[t];return Fr(void 0!==e,"Unknown REST mapping for: "+t),this.Jm+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},rd),ed=(Object.defineProperty(nd.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(nd.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),nd.prototype.kw=function(t){return Promise.resolve(new td(t))},nd.prototype.Ow=function(){return Jp.cs()?new Jp:new Kp},nd.prototype.Fw=function(t){return new Ta(t,{Te:!0})},nd.prototype.i=function(t){return JSON.stringify(t)},nd.prototype.atob=function(t){return atob(t)},nd.prototype.btoa=function(t){return btoa(t)},nd);function nd(){this.xr="undefined"!=typeof atob}function rd(t){this.s=t.s;var e=t.ssl?"https":"http";this.Jm=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function id(t){this.Bm=t.Bm,this.Mm=t.Mm}function od(){var t=this;this.Vm=function(){return t.Um()},this.xm=function(){return t.jm()},this.Lm=[],this.qm()}function sd(){}Na.Ur(new ed),(Yp=ud).INTERNAL.registerComponent(new b("firestore",function(t){var e=t.getProvider("app").getImmediate();return new cp(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps((Fr((Qp=Wp)&&"object"==typeof Qp,"shallowCopy() expects object parameter."),f({},Qp)))),Yp.registerVersion("@firebase/firestore","1.12.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map